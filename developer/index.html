<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <title>Developer - Edit Site Content</title>
  <link rel="stylesheet" href="/assets/css/adaptive-themes.css">
  <!-- Privacy-friendly analytics by Plausible -->
  <script async src="https://plausible.io/js/pa-M5H8HPpMEkcSIPK4fxOhN.js"></script>
  <script>
    window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
    plausible.init()
  </script>
  <!-- JWT decode library for authentication -->
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3/build/jwt-decode.min.js"></script>
  <!-- Shared auth configuration and utilities -->
  <script src="/assets/js/auth-config.js"></script>
  <script src="/assets/js/auth-utils.js"></script>
  <!-- Developer-specific auth guard -->
  <script src="/assets/js/auth-guard-developer.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Extra polish to complement Tailwind */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #e0f2fe;      /* sky-100 */
      color: #0369a1;           /* sky-700 */
      padding: 4px 10px;
      border-radius: 9999px;
      margin: 4px 6px 0 0;
      border: 1px solid #bae6fd;/* sky-200 */
      font-size: 0.85rem;
      line-height: 1.2rem;
      white-space: nowrap;
    }
    .pill button {
      margin: 0 0 0 4px;
      padding: 2px 8px;
      line-height: 1;
      border: 1px solid rgba(2,132,199,0.25);
      border-radius: 9999px;
      color: #0369a1;
      background: white;
    }
    .pill select {
      margin: 0;
      padding: 2px 6px;
      border: 1px solid #93c5fd; /* sky-300 */
      border-radius: 8px;
      background: white;
      color: #0369a1;
    }
    .muted { color: #64748b; } /* slate-500 */
    .timeline-entry {
      background: white;
      border: 1px solid #e2e8f0; /* slate-200 */
      border-radius: 0.75rem;
      padding: 0.75rem;
      box-shadow: 0 1px 1px rgba(2, 6, 23, 0.04);
    }
    .timeline-entry:hover {
      box-shadow: 0 6px 16px rgba(2,132,199,0.12);
      border-color: #93c5fd; /* sky-300 */
      transform: translateY(-1px);
      transition: box-shadow 150ms, border-color 150ms, transform 150ms;
    }
    textarea { min-height: 120px; font-family: inherit; }

    /* Dark mode (system preference) */
    @media (prefers-color-scheme: dark) {
      html, body { color-scheme: dark; }
      body { color: #e5e7eb; } /* slate-200 */

      .muted { color: #94a3b8 !important; } /* slate-400 */

      .pill {
        background: #0c4a6e !important; /* sky-900-ish */
        color: #e0f2fe !important;      /* sky-100 */
        border-color: #075985 !important; /* sky-700 */
      }
      .pill button {
        background: #0b1220 !important;
        color: #e0f2fe !important;
        border-color: #075985 !important;
      }
      .pill select {
        background: #0b1220 !important;
        color: #e5e7eb !important;
        border-color: #0ea5e9 !important;
      }

      .timeline-entry {
        background: #0f172a !important; /* slate-900 */
        border-color: #1f2937 !important; /* slate-800 */
        box-shadow: 0 1px 1px rgba(2, 6, 23, 0.6);
      }
      .timeline-entry:hover {
        border-color: #0ea5e9 !important; /* sky-500 */
        box-shadow: 0 6px 16px rgba(14,165,233,0.18);
      }

      /* Inputs and selects */
      input[type="text"],
      input[type="password"],
      input[type="date"],
      input:not([type]),
      select,
      textarea {
        background: #0b1220 !important;  /* near slate-950 */
        color: #e5e7eb !important;
        border-color: #334155 !important; /* slate-600 */
      }
      input::placeholder { color: #94a3b8 !important; }

      /* Generic border buttons */
      button.border {
        border-color: #374151 !important; /* slate-700 */
        color: #e5e7eb !important;
      }
      button.border:hover {
        background: #1f2937 !important; /* slate-800 */
      }
    }

    /* Toasts: Slide-in + Sound-ready */
    .toast-stack {
      position: fixed;
      right: 1rem;
      top: 1rem;
      display: grid;
      gap: 0.5rem;
      z-index: 1003;
    }
    .toast {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.75rem;
      border-radius: 0.5rem;
      min-width: 240px;
      background: white;
      border: 1px solid #e2e8f0;
      transform: translateX(16px);
      opacity: 0;
      transition: all 200ms ease;
      box-shadow: 0 10px 24px rgba(2,132,199,0.08);
      will-change: opacity, transform;
    }
    .toast.show { transform: translateX(0); opacity: 1; }
    .toast.success { border-color: #bbf7d0; background: #f0fdf4; color: #065f46; }
    .toast.info    { border-color: #bae6fd; background: #eff6ff; color: #075985; }
    .toast.warn    { border-color: #fde68a; background: #fffbea; color: #92400e; }
    .toast.error   { border-color: #fecaca; background: #fef2f2; color: #7f1d1d; }
    @media (prefers-color-scheme: dark) {
      .toast { background: #0f172a; border-color: #1f2937; color: #e5e7eb; box-shadow: 0 10px 24px rgba(14,165,233,.18); }
      .toast.success { border-color: #064e3b; background: #052e2b; color: #bbf7d0; }
      .toast.info    { border-color: #0c4a6e; background: #052335; color: #bae6fd; }
      .toast.warn    { border-color: #78350f; background: #2f1f05; color: #fde68a; }
      .toast.error   { border-color: #7f1d1d; background: #2b0b0b; color: #fecaca; }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 to-white dark:from-slate-900 dark:to-slate-950 font-sans text-slate-800 dark:text-slate-200">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-4">
    <div class="flex items-center gap-3">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-8 w-8"/>
      <div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-sky-800 dark:text-sky-300 leading-snug">Developer Editor</h1>
        <p class="text-sm text-sky-600 dark:text-sky-400">Edit site content and push the data file</p>
      </div>
    </div>
    <p class="muted mt-2">
      To save changes from this page, enter a GitHub Personal Access Token with <code>repo</code> permissions and click <strong>Push to GitHub</strong>.
      The token is used only in your browser and is never stored on the site.
    </p>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-16 space-y-6">
    <!-- Site Content -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200 mb-3">Site Content</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="col-span-1">
          <label for="site-title" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Site Title</label>
          <input id="site-title" type="text" placeholder="Site title"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
        </div>
        <div class="col-span-1">
          <label for="about-heading" class="block text-sm font-medium text-slate-700 dark:text-slate-300">About Heading</label>
          <input id="about-heading" type="text" placeholder="About heading"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
        </div>
      </div>

      <div class="mt-4">
        <label for="about-content" class="block text-sm font-medium text-slate-700 dark:text-slate-300">About Content (HTML allowed)</label>
        <textarea id="about-content" placeholder="<p>About text...</p>"
                  class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500"></textarea>
      </div>
    </section>

    <!-- Timeline -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Timeline</h2>
        <button id="add-timeline"
                class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">+ Add Timeline Event</button>
      </div>
      <div id="timeline-list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <!-- Leadership -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Leadership</h2>

      <!-- Leads -->
      <div class="mt-3">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Leads</label>
        <div id="leads-list" class="mt-2"></div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
          <input id="new-lead" type="text" placeholder="Add lead name"
                 class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
          <select id="new-lead-team" aria-label="Lead team"
                  class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"></select>
          <button id="add-lead"
                  class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add</button>
        </div>
      </div>

      <!-- Drivers -->
      <div class="mt-6">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Drivers</label>
        <div id="drivers-list" class="mt-2"></div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-[1fr_auto] gap-2">
          <input id="new-driver" type="text" placeholder="Add driver name"
                 class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
          <button id="add-driver"
                  class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add</button>
        </div>
      </div>
    </section>

    <!-- Media Manager -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Media Manager</h2>
      <p class="muted mt-1">
        Upload images directly to this repo (using your PAT below) and choose which images appear on the site.
        <span class="ml-1 text-[0.8rem] text-amber-600 dark:text-amber-400">
          Note: Uploading commits the image file, but the site.json reference isn‚Äôt saved until you click ‚ÄúPush to GitHub‚Äù.
        </span>
      </p>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Index Header Image URL</label>
          <div class="flex gap-2">
            <input id="media-indexHeader" type="text" placeholder="/assets/group.png" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
            <button id="btn-upload-indexHeader" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload &amp; Set</button>
            <input id="file-indexHeader" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-indexHeader" alt="Preview" class="mt-2 max-h-36 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Index Team Photo URL</label>
          <div class="flex gap-2">
            <input id="media-indexPhoto" type="text" placeholder="/assets/Shark-Photo.png" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
            <button id="btn-upload-indexPhoto" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload &amp; Set</button>
            <input id="file-indexPhoto" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-indexPhoto" alt="Preview" class="mt-2 max-h-36 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Sponsors Header Image URL</label>
          <div class="flex gap-2">
            <input id="media-sponsorsHeader" type="text" placeholder="/assets/group.png" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
            <button id="btn-upload-sponsorsHeader" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload &amp; Set</button>
            <input id="file-sponsorsHeader" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-sponsorsHeader" alt="Preview" class="mt-2 max-h-36 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Upload Destination Directory</label>
          <input id="media-dest-dir" type="text" value="assets/uploads" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
          <p class="text-xs muted">Relative to repo root. Default: assets/uploads</p>
        </div>
      </div>

      <div class="mt-6">
        <h3 class="text-md font-semibold text-slate-700 dark:text-slate-200 mb-2">Competition Moments Gallery</h3>

        <div class="flex flex-wrap items-center gap-2 mb-3">
          <input id="new-competition-url" type="text" placeholder="https://... or /assets/uploads/your-image.png" class="flex-1 rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
          <button id="add-competition-url" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add URL</button>
          <button id="btn-upload-competition" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload &amp; Add</button>
          <input id="file-competition" type="file" accept="image/*" multiple class="hidden">
        </div>

        <div id="media-competition-list" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
      </div>

      <pre id="media-result" class="muted mt-3 whitespace-pre-wrap text-sm"></pre>
    </section>

    <!-- Sponsors Manager -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Sponsors Manager</h2>
      <p class="muted mt-1">
        Add sponsors shown on sponsors.html. Upload a logo, set the sponsor name (and optional link), reorder, or remove.
        <span class="ml-1 text-[0.8rem] text-amber-600 dark:text-amber-400">
          Note: Uploaded logo files are committed immediately, but changes to the sponsors list are saved when you click ‚ÄúPush to GitHub‚Äù.
        </span>
      </p>

      <!-- Add sponsor form -->
      <div class="mt-4 grid grid-cols-1 lg:grid-cols-[1fr_1fr] gap-4">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Sponsor Name</label>
          <input id="new-sponsor-name" type="text" placeholder="Sponsor name (e.g., Baxter)"
                 class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Optional Link URL</label>
          <input id="new-sponsor-link" type="text" placeholder="https://example.com (optional)"
                 class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Logo URL</label>
          <div class="flex gap-2">
            <input id="new-sponsor-logo" type="text" placeholder="/assets/uploads/logo.png or https://..."
                   class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
            <button id="btn-upload-sponsor-logo" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload Logo</button>
            <input id="file-sponsor-logo" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-sponsor-logo" alt="Logo preview" class="mt-2 max-h-24 rounded-md border border-slate-200 dark:border-slate-700 hidden">
        </div>

        <div class="flex items-end">
          <button id="add-sponsor" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm w-full">
            + Add Sponsor
          </button>
        </div>
      </div>

      <!-- Existing sponsors list -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4" id="sponsors-list"></div>
    </section>

    <!-- Developer Management -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center gap-2 mb-3">
        <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Developer Access Management</h2>
        <span id="dev-pending-indicator" class="hidden inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300">
          Pending changes
        </span>
      </div>
      <p class="muted mb-4">
        Manage who has access to developer pages (Developer Console, UI Lab, Telemetry). 
        The two core developers (<code>blackshocktrooper@gmail.com</code>, <code>palm4215@wths.net</code>) 
        cannot be removed. Changes are saved to <code>assets/data/developers.json</code> when you push to GitHub.
      </p>
      
      <div class="mb-4">
        <label for="dev-email-input" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Add Developer Email</label>
        <div class="flex flex-col sm:flex-row gap-2">
          <input 
            id="dev-email-input" 
            type="email" 
            placeholder="developer@example.com"
            class="flex-1 rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500"
          />
          <button 
            id="add-dev-btn"
            class="w-full sm:w-auto bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm whitespace-nowrap"
          >
            Add Developer
          </button>
        </div>
        <p id="dev-add-message" class="text-xs mt-1 hidden"></p>
      </div>
      
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-sm font-medium text-slate-700 dark:text-slate-300">Current Developers</h3>
          <button 
            id="push-dev-list-btn"
            class="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm whitespace-nowrap"
          >
            üíæ Push Developer List to GitHub
          </button>
        </div>
        <div id="dev-list" class="space-y-2">
          <!-- Developer list will be populated here -->
        </div>
      </div>
    </section>

    <!-- Team Member Access Management -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center gap-2 mb-3">
        <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Team Member Access Management</h2>
        <span id="team-pending-indicator" class="hidden inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300">
          Pending changes
        </span>
      </div>
      <p class="muted mb-4">
        Manage who has access to the task board. Team members can view and manage tasks.
        The two core team members (<code>blackshocktrooper@gmail.com</code>, <code>palm4215@wths.net</code>) 
        cannot be removed. Changes are saved to <code>assets/data/team-members.json</code> when you push to GitHub.
      </p>
      
      <div class="mb-4">
        <label for="team-email-input" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Add Team Member Email</label>
        <div class="flex flex-col sm:flex-row gap-2">
          <input 
            id="team-email-input" 
            type="email" 
            placeholder="teammember@example.com"
            class="flex-1 rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500"
          />
          <button 
            id="add-team-btn"
            class="w-full sm:w-auto bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm whitespace-nowrap"
          >
            Add Team Member
          </button>
        </div>
        <p id="team-add-message" class="text-xs mt-1 hidden"></p>
      </div>
      
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-sm font-medium text-slate-700 dark:text-slate-300">Current Team Members</h3>
          <button 
            id="push-team-list-btn"
            class="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm whitespace-nowrap"
          >
            üíæ Push Team Member List to GitHub
          </button>
        </div>
        <div id="team-list" class="space-y-2">
          <!-- Team member list will be populated here -->
        </div>
      </div>
    </section>

    <!-- Simplified GitHub Push -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center gap-2">
        <h3 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Save Changes to GitHub</h3>
        <!-- Live save status badge -->
        <span id="save-status" class="ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300">
          All changes saved
        </span>
      </div>
      <p class="muted mt-1">
        This editor always saves to
        <code>DarkShockGamer/DarkShockGamer.github.io</code>,
        branch <code>main</code>, file <code>data/site.json</code>.
        Enter a GitHub Personal Access Token (PAT) with permission to push to that repo and click
        <strong>Push to GitHub</strong>.
      </p>

      <div class="mt-4">
        <label for="gh-token" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Personal Access Token (PAT)</label>
        <input id="gh-token" type="password" placeholder="ghp_xxx"
               class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        <p class="text-xs muted mt-1">
          The token is only used in your browser to call the GitHub API. It is not logged or stored by the site.
        </p>
      </div>

      <div class="flex flex-wrap gap-2 mt-4">
        <button id="push-github" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">
          Push to GitHub
        </button>
      </div>
      <pre id="gh-result" class="muted mt-3 whitespace-pre-wrap text-sm"></pre>
    </section>

    <footer class="text-center py-4 border-t border-slate-100 dark:border-slate-800 flex flex-col items-center gap-1">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-6 w-6" />
      <span class="text-sky-600 dark:text-sky-400 text-sm">¬© 2025 Trident Robotics ‚Äî Developer Editor</span>
      <span class="text-xs text-sky-400">Internal content management ‚Ä¢ Edits saved to data/site.json</span>
    </footer>
  </main>

  <!-- Toast stack -->
  <div id="toastStack" class="toast-stack" aria-live="polite" aria-atomic="true"></div>

  <script>
    // ===== Fixed GitHub target (no fields for moderators to edit) =====
    const GH_OWNER  = 'DarkShockGamer';
    const GH_REPO   = 'DarkShockGamer.github.io';
    const GH_BRANCH = 'main';
    const GH_PATH   = 'data/site.json';

    // ===== Base state and helpers =====
    function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }

    let siteData = {
      title: document.getElementById('site-title')?.value || 'Trident Robotics 4296',
      about: { heading: 'About Us', content: '<p>Edit...</p>' },
      timeline: [],
      leadership: {
        teams: [
          { team: "Design Team", role: "Lead", members: [] },
          { team: "Mechanical Team", role: "Lead", members: [] },
          { team: "Electrical Team", role: "Lead", members: [] },
          { team: "Programming Team", role: "Lead", members: [] },
          { team: "Drive Team", role: "Driver", members: [] }
        ],
        leads: [],
        drivers: []
      },
      media: {
        indexHeader: "/assets/group.png",
        indexPhoto: "/assets/Shark-Photo.png",
        sponsorsHeader: "/assets/group.png",
        competitionImages: ["/assets/Compitition-Photo1.png"]
      },
      sponsors: [
        { name: "Baxter", logo: "/assets/Baxter-Logo.png", url: "" },
        { name: "NASA", logo: "/assets/NASA-Logo.png", url: "" },
        { name: "Kubota", logo: "/assets/Kubota-Logo.png", url: "" },
        { name: "WW Displays Inc", logo: "/assets/WWDisplays.png", url: "" },
        { name: "Patel Family", logo: "/assets/PatelFamily.png", url: "" }
      ]
    };

    let isDirty = false;
    function updateSaveStatus() {
      const el = document.getElementById('save-status');
      if (!el) return;
      if (isDirty) {
        el.textContent = 'Unsaved changes';
        el.className = 'ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300';
      } else {
        el.textContent = 'All changes saved';
        el.className = 'ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300';
      }
    }
    function setDirty(reason) {
      isDirty = true;
      updateSaveStatus();
      if (reason) {
        const res = document.getElementById('media-result');
        if (res) res.textContent = reason + ' ‚Äî Remember to click "Push to GitHub" to save site.json.';
      }
    }

    async function loadExisting() {
      try {
        const r = await fetch('/data/site.json?_=' + Date.now());
        if (r.ok) siteData = await r.json();
      } catch (e) { /* ignore */ }
      // Normalize leads
      if (siteData && siteData.leadership) {
        const leads = siteData.leadership.leads || [];
        siteData.leadership.leads = leads.map(l => {
          if (typeof l === 'string') return { name: l, team: '' };
          if (l && typeof l === 'object') return { name: l.name || '', team: l.team || '' };
          return { name: String(l || ''), team: '' };
        });
      }
      ensureMediaDefaults();
      ensureSponsorsDefaults();
      renderEditor();
      bindMediaManager();
      bindSponsorAddControls();
      renderSponsorsList();

      // Loaded from disk -> clean state
      isDirty = false;
      updateSaveStatus();
      const res = document.getElementById('media-result');
      if (res) res.textContent = '';
    }

    function ensureMediaDefaults() {
      siteData.media = siteData.media || {};
      siteData.media.indexHeader = siteData.media.indexHeader || '/assets/group.png';
      siteData.media.indexPhoto = siteData.media.indexPhoto || '/assets/Shark-Photo.png';
      siteData.media.sponsorsHeader = siteData.media.sponsorsHeader || '/assets/group.png';
      let imgs = siteData.media.competitionImages;
      if (!Array.isArray(imgs)) imgs = imgs ? [imgs] : [];
      if (!imgs.length) imgs = ['/assets/Compitition-Photo1.png'];
      siteData.media.competitionImages = imgs;
    }

    function ensureSponsorsDefaults() {
      if (!Array.isArray(siteData.sponsors)) {
        siteData.sponsors = [
          { name: "Baxter", logo: "/assets/Baxter-Logo.png", url: "" },
          { name: "NASA", logo: "/assets/NASA-Logo.png", url: "" },
          { name: "Kubota", logo: "/assets/Kubota-Logo.png", url: "" },
          { name: "WW Displays Inc", logo: "/assets/WWDisplays.png", url: "" },
          { name: "Patel Family", logo: "/assets/PatelFamily.png", url: "" }
        ];
      } else {
        // Coerce to expected shape
        siteData.sponsors = siteData.sponsors.map(s => ({
          name: (s && s.name) || '',
          logo: (s && s.logo) || '',
          url: (s && s.url) || ''
        }));
      }
    }

    function teamOptionsHtml(selectedTeam) {
      const teams = (siteData.leadership && siteData.leadership.teams) ? siteData.leadership.teams : [];
      const options = [''].concat(teams.map(t => t.team));
      return options.map(t => {
        const sel = (t === (selectedTeam || '')) ? ' selected' : '';
        const label = t || '‚Äî Select team ‚Äî';
        return `<option value="${t.replace(/"/g, '&quot;')}"${sel}>${label}</option>`;
      }).join('');
    }

    function renderEditor(){
      // top-level fields
      document.getElementById('site-title').value = siteData.title || '';
      document.getElementById('about-heading').value = (siteData.about && siteData.about.heading) || '';
      document.getElementById('about-content').value = (siteData.about && siteData.about.content) || '';

      // Timeline
      const tl = document.getElementById('timeline-list'); tl.innerHTML = '';
      (siteData.timeline || []).forEach((ev, idx) => {
        const card = document.createElement('div'); card.className='timeline-entry';
        card.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <h3 class="text-base font-semibold text-slate-700 dark:text-slate-200">Event ${idx+1}</h3>
            <div class="flex gap-2">
              <button type="button" class="up border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-2 py-1 text-xs hover:bg-slate-50 dark:hover:bg-slate-800">‚Üë</button>
              <button type="button" class="down border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-2 py-1 text-xs hover:bg-slate-50 dark:hover:bg-slate-800">‚Üì</button>
              <button type="button" class="del border border-red-200 dark:border-red-900 rounded-md px-2 py-1 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950">Delete</button>
            </div>
          </div>
          <div class="grid grid-cols-1 gap-2 mt-2">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">When</label>
              <input class="ev-date mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                     value="${(ev.date||ev.year||'').replace(/"/g, '&quot;')}">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Title</label>
              <input class="ev-title mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                     value="${(ev.title||'').replace(/"/g, '&quot;')}">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Description (HTML)</label>
              <textarea class="ev-desc mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">${ev.description||''}</textarea>
            </div>
          </div>
        `;
        tl.appendChild(card);

        // actions
        card.querySelector('.del').addEventListener('click',()=>{ siteData.timeline.splice(idx,1); setDirty('Timeline updated'); renderEditor(); });
        card.querySelector('.up').addEventListener('click',()=>{
          if(idx>0){
            const a=siteData.timeline[idx-1];
            siteData.timeline[idx-1]=siteData.timeline[idx];
            siteData.timeline[idx]=a;
            setDirty('Timeline updated');
            renderEditor();
          }
        });
        card.querySelector('.down').addEventListener('click',()=>{
          if(idx<siteData.timeline.length-1){
            const a=siteData.timeline[idx+1];
            siteData.timeline[idx+1]=siteData.timeline[idx];
            siteData.timeline[idx]=a;
            setDirty('Timeline updated');
            renderEditor();
          }
        });
        card.querySelector('.ev-date').addEventListener('input',(e)=> { siteData.timeline[idx].date = e.target.value; setDirty('Timeline updated'); });
        card.querySelector('.ev-title').addEventListener('input',(e)=> { siteData.timeline[idx].title = e.target.value; setDirty('Timeline updated'); });
        card.querySelector('.ev-desc').addEventListener('input',(e)=> { siteData.timeline[idx].description = e.target.value; setDirty('Timeline updated'); });
      });

      // Leads with team selection
      const leadsC = document.getElementById('leads-list'); leadsC.innerHTML = '';
      (siteData.leadership.leads || []).forEach((lead, i) => {
        const item = (typeof lead === 'string') ? { name: lead, team: '' } : (lead || { name: '', team: '' });
        const span = document.createElement('span'); span.className='pill';
        span.innerHTML = `
          <strong>${(item.name||'').replace(/</g,'&lt;')}</strong>
          <span class="text-slate-400">‚Äî</span>
          <select class="lead-team" aria-label="Lead team">${teamOptionsHtml(item.team)}</select>
          <button type="button" class="remove" aria-label="Remove lead">√ó</button>
        `;
        leadsC.appendChild(span);
        span.querySelector('.lead-team').addEventListener('change',(e)=>{
          siteData.leadership.leads[i] = { name: item.name, team: e.target.value };
          setDirty('Leadership updated');
        });
        span.querySelector('.remove').addEventListener('click',()=>{
          siteData.leadership.leads.splice(i,1);
          setDirty('Leadership updated');
          renderEditor();
        });
      });

      // Populate the "new lead team" select
      const newLeadTeam = document.getElementById('new-lead-team');
      newLeadTeam.innerHTML = teamOptionsHtml('');

      // Drivers (simple list of strings)
      const driversC = document.getElementById('drivers-list'); driversC.innerHTML = '';
      (siteData.leadership.drivers || []).forEach((n,i)=> {
        const span = document.createElement('span'); span.className='pill';
        span.textContent=n;
        const btn = document.createElement('button'); btn.textContent='√ó'; btn.addEventListener('click',()=>{ siteData.leadership.drivers.splice(i,1); setDirty('Leadership updated'); renderEditor(); });
        span.appendChild(btn); driversC.appendChild(span);
      });

      // Sync media previews
      const f1 = document.getElementById('media-indexHeader');
      const f2 = document.getElementById('media-indexPhoto');
      const f3 = document.getElementById('media-sponsorsHeader');
      if (f1) f1.value = siteData.media.indexHeader || '';
      if (f2) f2.value = siteData.media.indexPhoto || '';
      if (f3) f3.value = siteData.media.sponsorsHeader || '';
      const p1 = document.getElementById('preview-indexHeader'); if (p1) p1.src = siteData.media.indexHeader || '';
      const p2 = document.getElementById('preview-indexPhoto'); if (p2) p2.src = siteData.media.indexPhoto || '';
      const p3 = document.getElementById('preview-sponsorsHeader'); if (p3) p3.src = siteData.media.sponsorsHeader || '';
      renderCompetitionList();
    }

    // ===== Add handlers (top-level add buttons) =====
    document.getElementById('add-timeline').addEventListener('click', ()=>{
      siteData.timeline.push({id:uid(), date:new Date().toLocaleDateString(), title:'New event', description:''});
      setDirty('Timeline updated');
      renderEditor();
    });

    document.getElementById('add-lead').addEventListener('click', ()=>{
      const name = document.getElementById('new-lead').value.trim();
      const team = document.getElementById('new-lead-team').value.trim();
      if (name){
        siteData.leadership.leads.push({ name, team });
        document.getElementById('new-lead').value = '';
        document.getElementById('new-lead-team').value = '';
        setDirty('Leadership updated');
        renderEditor();
      }
    });

    document.getElementById('add-driver').addEventListener('click', ()=>{
      const v=document.getElementById('new-driver').value.trim();
      if(v){
        siteData.leadership.drivers.push(v);
        document.getElementById('new-driver').value='';
        setDirty('Leadership updated');
        renderEditor();
      }
    });

    // ===== Live updates => mark dirty =====
    document.getElementById('site-title').addEventListener('input',(e)=> { siteData.title = e.target.value; setDirty('Content changed'); });
    document.getElementById('about-heading').addEventListener('input',(e)=> { siteData.about.heading = e.target.value; setDirty('Content changed'); });
    document.getElementById('about-content').addEventListener('input',(e)=> { siteData.about.content = e.target.value; setDirty('Content changed'); });

    // ===== GitHub push (text/json) =====
    async function getSha(owner, repo, path, branch, token){
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;
      const r = await fetch(url, { headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github+json' }});
      if (r.status === 404) return null;
      if (!r.ok) throw new Error(await r.text());
      const j = await r.json(); return j.sha;
    }
    async function pushFile(owner, repo, path, branch, token, content, message){
      const base64 = btoa(unescape(encodeURIComponent(content)));
      const sha = await getSha(owner, repo, path, branch, token);
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
      const body = { message: message||'Update site content via developer.html', content: base64, branch };
      if (sha) body.sha = sha;
      const r = await fetch(url, {
        method:'PUT',
        headers:{ Authorization: 'token ' + token, Accept:'application/vnd.github+json', 'Content-Type':'application/json' },
        body: JSON.stringify(body)
      });
      return await r.json();
    }

    // ===== Toasts (Slide-in + Sound hooks) with fade-out and reliable auto-dismiss =====
    const toastStack = document.getElementById('toastStack');
    function showToast(type, message, timeout = 10000) {
      if (!toastStack) return;
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.setAttribute('role', 'status');
      el.innerHTML = `
        <span aria-hidden="true">
          ${type === 'success' ? '‚úî' : type === 'info' ? '‚ÑπÔ∏è' : type === 'warn' ? '‚ö†Ô∏è' : '‚úñ'}
        </span>
        <div class="text-sm">${message}</div>
        <button class="p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-800" title="Dismiss">‚úñ</button>
      `;
      toastStack.appendChild(el);
      requestAnimationFrame(() => el.classList.add('show'));

      try {
        if (window.Sound) {
          if (type === 'success' && Sound.success) Sound.success();
          else if (type === 'info' && Sound.info) Sound.info();
          else if (type === 'warn' && Sound.warn) Sound.warn();
          else if (type === 'error' && Sound.error) Sound.error();
        }
      } catch {}

      const removeAfterTransition = () => {
        const onEnd = (e) => {
          if (e.target === el) {
            el.removeEventListener('transitionend', onEnd);
            el.remove();
          }
        };
        el.addEventListener('transitionend', onEnd);
        el.classList.remove('show'); // fade out
      };

      // Dismiss on click
      el.querySelector('button')?.addEventListener('click', removeAfterTransition);

      // Auto-dismiss with hover pause/resume
      let start = Date.now();
      let remaining = timeout;
      let timer = setTimeout(removeAfterTransition, remaining);

      const pause = () => { clearTimeout(timer); remaining -= (Date.now() - start); };
      const resume = () => { start = Date.now(); clearTimeout(timer); timer = setTimeout(removeAfterTransition, Math.max(0, remaining)); };

      el.addEventListener('mouseenter', pause);
      el.addEventListener('mouseleave', resume);

      window.showToast = showToast;
    }

    // ===== Push handler (no dry run, no owner/repo fields) =====
    document.getElementById('push-github').addEventListener('click', async ()=>{
      const token = document.getElementById('gh-token').value.trim();

      if (!token) {
        document.getElementById('gh-result').textContent = 'Token required';
        showToast('warn', 'Please enter a Personal Access Token (PAT).');
        return;
      }

      try {
        // Ensure latest edits captured (including media & sponsors)
        siteData.title = document.getElementById('site-title').value;
        siteData.about.heading = document.getElementById('about-heading').value;
        siteData.about.content = document.getElementById('about-content').value;
        siteData.media.indexHeader = document.getElementById('media-indexHeader')?.value?.trim() || siteData.media.indexHeader;
        siteData.media.indexPhoto = document.getElementById('media-indexPhoto')?.value?.trim() || siteData.media.indexPhoto;
        siteData.media.sponsorsHeader = document.getElementById('media-sponsorsHeader')?.value?.trim() || siteData.media.sponsorsHeader;

        document.getElementById('gh-result').textContent = 'Pushing...';
        showToast('info', 'Pushing to GitHub‚Ä¶');

        const res = await pushFile(GH_OWNER, GH_REPO, GH_PATH, GH_BRANCH, token, JSON.stringify(siteData,null,2), 'Update site data via developer.html');
        if (res && res.commit && res.commit.sha) {
          const msg = 'Success. Commit: ' + res.commit.sha;
          document.getElementById('gh-result').textContent = msg;
          showToast('success', 'site.json saved ‚Ä¢ ' + res.commit.sha);
          isDirty = false; updateSaveStatus();
          const note = document.getElementById('media-result');
          if (note) note.textContent = 'site.json saved. Your image and sponsor changes are now live.';
        } else {
          const msg = 'Response: ' + JSON.stringify(res);
          document.getElementById('gh-result').textContent = msg;
          showToast('error', msg);
        }
      } catch (e) {
        const msg = 'Error: ' + e.message;
        document.getElementById('gh-result').textContent = msg;
        showToast('error', msg);
      }
    });

    // ===== Media Manager: upload binary files to repo =====
    function sanitizeFileName(name) { return name.replace(/[^a-zA-Z0-9._-]/g, '_'); }
    function base64FromFile(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const bytes = new Uint8Array(reader.result);
            let binary = '';
            const chunk = 0x8000;
            for (let i = 0; i < bytes.length; i += chunk) {
              binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunk));
            }
            resolve(btoa(binary));
          } catch (e) { reject(e); }
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }
    async function pushBinaryFile(owner, repo, path, branch, token, base64, message) {
      const sha = await getSha(owner, repo, path, branch, token);
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
      const body = { message: message || 'Upload image via developer.html', content: base64, branch };
      if (sha) body.sha = sha;
      const r = await fetch(url, {
        method: 'PUT',
        headers: {
          Authorization: 'token ' + token,
          Accept: 'application/vnd.github+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j.message || JSON.stringify(j));
      return j;
    }
    async function uploadOneImage(file) {
      const token = document.getElementById('gh-token').value.trim();
      const destDir = (document.getElementById('media-dest-dir').value.trim() || 'assets/uploads').replace(/\/+$/,'');
      if (!token) throw new Error('Token required (set in the "Save Changes to GitHub" section).');

      const safeName = `${Date.now()}-${sanitizeFileName(file.name)}`;
      const path = `${destDir}/${safeName}`.replace(/^\/+/,'');
      const b64 = await base64FromFile(file);
      const res = await pushBinaryFile(GH_OWNER, GH_REPO, path, GH_BRANCH, token, b64, `Upload image ${safeName} via developer.html`);
      return `/${res.content.path}`; // site-relative URL
    }

    // Generic helper to safely show/hide preview <img> when URL is valid/invalid
    function setPreview(imgEl, url) {
      if (!imgEl) return;
      if (url) {
        imgEl.classList.remove('hidden');
        // set handlers before src so they apply to this load
        imgEl.onload = () => { imgEl.classList.remove('hidden'); };
        imgEl.onerror = () => { imgEl.classList.add('hidden'); };
        imgEl.src = url;
      } else {
        imgEl.classList.add('hidden');
        imgEl.removeAttribute('src');
      }
    }

    function bindImageField(fieldId, fileInputId, buttonId, previewId, getter, setter) {
      const field = document.getElementById(fieldId);
      const fileInput = document.getElementById(fileInputId);
      const button = document.getElementById(buttonId);
      const preview = document.getElementById(previewId);
      if (!field || !fileInput || !button || !preview) return;

      // initialize
      field.value = getter() || '';
      preview.src = getter() || '';

      field.addEventListener('input', () => {
        setter(field.value.trim());
        preview.src = field.value.trim() || '';
        setDirty('Media link changed');
      });

      button.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', async (e) => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        try {
          document.getElementById('media-result').textContent = 'Uploading...';
          const url = await uploadOneImage(f);
          setter(url);
          field.value = url;
          preview.src = url;
          setDirty('Image uploaded to repository ‚úì (reference pending in site.json)');
          document.getElementById('media-result').textContent = `Uploaded: ${url}\nImage file is committed. Reference will be saved to site.json when you click "Push to GitHub".`;
        } catch (err) {
          document.getElementById('media-result').textContent = 'Error: ' + err.message;
        } finally {
          fileInput.value = '';
        }
      });
    }

    function renderCompetitionList() {
      const list = document.getElementById('media-competition-list');
      if (!list || !siteData.media) return;
      list.innerHTML = '';
      (siteData.media.competitionImages || []).forEach((url, idx) => {
        const card = document.createElement('div');
        card.className = 'rounded-lg border border-slate-200 dark:border-slate-800 overflow-hidden bg-white dark:bg-slate-900';
        card.innerHTML = `
          <img src="${url}" alt="Competition ${idx+1}" class="w-full aspect-[4/3] object-cover">
          <div class="p-2 flex items-center justify-between gap-2">
            <span class="text-xs truncate" title="${url}">${url}</span>
            <div class="flex gap-1">
              <button class="border border-slate-300 dark:border-slate-700 rounded px-2 text-xs" data-act="up">‚Üë</button>
              <button class="border border-slate-300 dark:border-slate-700 rounded px-2 text-xs" data-act="down">‚Üì</button>
              <button class="border border-red-300 dark:border-red-900 text-red-600 dark:text-red-400 rounded px-2 text-xs" data-act="del">‚úï</button>
            </div>
          </div>
        `;
        card.querySelector('[data-act="up"]').addEventListener('click', () => {
          if (idx > 0) {
            const a = siteData.media.competitionImages[idx-1];
            siteData.media.competitionImages[idx-1] = siteData.media.competitionImages[idx];
            siteData.media.competitionImages[idx] = a;
            setDirty('Competition gallery updated');
            renderCompetitionList();
          }
        });
        card.querySelector('[data-act="down"]').addEventListener('click', () => {
          if (idx < siteData.media.competitionImages.length - 1) {
            const a = siteData.media.competitionImages[idx+1];
            siteData.media.competitionImages[idx+1] = siteData.media.competitionImages[idx];
            siteData.media.competitionImages[idx] = a;
            setDirty('Competition gallery updated');
            renderCompetitionList();
          }
        });
        card.querySelector('[data-act="del"]').addEventListener('click', () => {
          siteData.media.competitionImages.splice(idx, 1);
          setDirty('Competition gallery updated');
          renderCompetitionList();
        });
        list.appendChild(card);
      });
    }

    function bindCompetitionControls() {
      const addBtn = document.getElementById('add-competition-url');
      const urlInput = document.getElementById('new-competition-url');
      const btn = document.getElementById('btn-upload-competition');
      const fileInput = document.getElementById('file-competition');

      if (addBtn && urlInput) {
        addBtn.addEventListener('click', () => {
          const v = urlInput.value.trim();
          if (!v) return;
          siteData.media.competitionImages.push(v);
          urlInput.value = '';
          setDirty('Competition gallery updated');
          renderCompetitionList();
        });
      }

      if (btn && fileInput) {
        btn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', async (e) => {
          const files = Array.from(e.target.files || []);
          if (!files.length) return;
          try {
            document.getElementById('media-result').textContent = 'Uploading competition images...';
            for (const f of files) {
              const url = await uploadOneImage(f);
              siteData.media.competitionImages.push(url);
            }
            setDirty('Competition gallery updated (uploads committed, references pending in site.json).');
            renderCompetitionList();
            document.getElementById('media-result').textContent = 'Competition images uploaded. Remember to click "Push to GitHub" to save site.json references.';
          } catch (err) {
            document.getElementById('media-result').textContent = 'Error: ' + err.message;
          } finally {
            fileInput.value = '';
          }
        });
      }
    }

    function bindMediaManager() {
      bindImageField(
        'media-indexHeader','file-indexHeader','btn-upload-indexHeader','preview-indexHeader',
        () => siteData.media.indexHeader,
        (v) => { siteData.media.indexHeader = v; }
      );
      bindImageField(
        'media-indexPhoto','file-indexPhoto','btn-upload-indexPhoto','preview-indexPhoto',
        () => siteData.media.indexPhoto,
        (v) => { siteData.media.indexPhoto = v; }
      );
      bindImageField(
        'media-sponsorsHeader','file-sponsorsHeader','btn-upload-sponsorsHeader','preview-sponsorsHeader',
        () => siteData.media.sponsorsHeader,
        (v) => { siteData.media.sponsorsHeader = v; }
      );
      bindCompetitionControls();
    }

    // ===== Sponsors manager =====
    function bindSponsorAddControls() {
      const nameInput = document.getElementById('new-sponsor-name');
      const linkInput = document.getElementById('new-sponsor-link');
      const logoInput = document.getElementById('new-sponsor-logo');
      const addBtn = document.getElementById('add-sponsor');
      const uploadBtn = document.getElementById('btn-upload-sponsor-logo');
      const fileInput = document.getElementById('file-sponsor-logo');
      const logoPreview = document.getElementById('preview-sponsor-logo');

      if (logoInput && logoPreview) {
        logoInput.addEventListener('input', () => {
          setPreview(logoPreview, logoInput.value.trim());
        });
      }

      if (uploadBtn && fileInput) {
        uploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', async (e) => {
          const f = e.target.files && e.target.files[0];
          if (!f) return;
          try {
            document.getElementById('media-result').textContent = 'Uploading sponsor logo...';
            const url = await uploadOneImage(f);
            logoInput.value = url;
            setPreview(logoPreview, url);
            setDirty('Sponsor logo uploaded (reference pending in site.json).');
            document.getElementById('media-result').textContent = `Uploaded sponsor logo: ${url}\nRemember to click "Push to GitHub" to save the sponsor list.`;
          } catch (err) {
            document.getElementById('media-result').textContent = 'Error: ' + err.message;
          } finally {
            fileInput.value = '';
          }
        });
      }

      if (addBtn) {
        addBtn.addEventListener('click', () => {
          const name = nameInput.value.trim();
          const logo = logoInput.value.trim();
          const url = linkInput.value.trim();
          if (!name || !logo) return;
          siteData.sponsors.push({ name, logo, url });
          nameInput.value = '';
          logoInput.value = '';
          linkInput.value = '';
          setPreview(logoPreview, '');
          setDirty('Sponsors updated');
          renderSponsorsList();
        });
      }
    }

    function renderSponsorsList() {
      const list = document.getElementById('sponsors-list');
      if (!list) return;
      list.innerHTML = '';
      (siteData.sponsors || []).forEach((s, idx) => {
        const card = document.createElement('div');
        card.className = 'rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 p-3 flex flex-col gap-2';
        card.innerHTML = `
          <div class="flex items-center gap-3">
            <img src="${s.logo}" alt="${s.name}" class="h-12 w-12 rounded object-contain bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
            <div class="min-w-0">
              <div class="font-semibold text-sm text-slate-800 dark:text-slate-100 truncate">${s.name}</div>
              <div class="text-xs text-slate-500 dark:text-slate-400 truncate" title="${s.url || ''}">${s.url || ''}</div>
            </div>
          </div>
          <div class="flex flex-wrap gap-2 mt-1">
            <button class="border border-slate-300 dark:border-slate-700 rounded px-2 py-1 text-xs edit">Edit</button>
            <button class="border border-red-300 dark:border-red-900 text-red-600 dark:text-red-400 rounded px-2 py-1 text-xs remove">Remove</button>
            <button class="border border-slate-300 dark:border-slate-700 rounded px-2 py-1 text-xs up">‚Üë</button>
            <button class="border border-slate-300 dark:border-slate-700 rounded px-2 py-1 text-xs down">‚Üì</button>
          </div>
        `;
        list.appendChild(card);

        card.querySelector('.remove').addEventListener('click', () => {
          siteData.sponsors.splice(idx, 1);
          setDirty('Sponsors updated');
          renderSponsorsList();
        });
        card.querySelector('.up').addEventListener('click', () => {
          if (idx > 0) {
            const a = siteData.sponsors[idx-1];
            siteData.sponsors[idx-1] = siteData.sponsors[idx];
            siteData.sponsors[idx] = a;
            setDirty('Sponsors updated');
            renderSponsorsList();
          }
        });
        card.querySelector('.down').addEventListener('click', () => {
          if (idx < siteData.sponsors.length - 1) {
            const a = siteData.sponsors[idx+1];
            siteData.sponsors[idx+1] = siteData.sponsors[idx];
            siteData.sponsors[idx] = a;
            setDirty('Sponsors updated');
            renderSponsorsList();
          }
        });
        card.querySelector('.edit').addEventListener('click', () => {
          const name = prompt('Sponsor name', s.name);
          if (name === null) return;
          const logo = prompt('Logo URL', s.logo);
          if (logo === null) return;
          const url = prompt('Optional link URL', s.url || '');
          if (url === null) return;
          siteData.sponsors[idx] = { name: name.trim(), logo: logo.trim(), url: url.trim() };
          setDirty('Sponsors updated');
          renderSponsorsList();
        });
      });
    }

    // ===== Developer Management =====
    // Current developer list state (loaded from JSON file)
    let currentDeveloperData = null;
    let hasDevPendingChanges = false;
    
    /**
     * Update the pending changes indicator
     */
    function updateDevPendingIndicator() {
      const indicator = document.getElementById('dev-pending-indicator');
      if (!indicator) return;
      
      if (hasDevPendingChanges) {
        indicator.classList.remove('hidden');
      } else {
        indicator.classList.add('hidden');
      }
    }
    
    /**
     * Load developer list from the JSON file
     */
    async function loadDeveloperList(bustCache = false) {
      try {
        const url = bustCache 
          ? '/assets/data/developers.json?v=' + Date.now()
          : '/assets/data/developers.json';
        const response = await fetch(url);
        if (!response.ok) {
          showToast('warn', 'Could not load developer list from server');
          return null;
        }
        const data = await response.json();
        currentDeveloperData = data;
        return data;
      } catch (err) {
        console.error('[Developer Page] Error loading developer list:', err);
        showToast('error', 'Error loading developer list: ' + err.message);
        return null;
      }
    }
    
    async function renderDeveloperList() {
      const devList = document.getElementById('dev-list');
      if (!devList) return;
      
      // If we have in-memory data, use it (for immediate UI updates)
      if (currentDeveloperData && Array.isArray(currentDeveloperData.developers)) {
        const developers = currentDeveloperData.developers.map(e => e.trim().toLowerCase());
        renderDeveloperListUI(developers);
        return;
      }
      
      // Otherwise, load from JSON file
      devList.innerHTML = '<p class="text-sm text-slate-500 dark:text-slate-400">Loading...</p>';
      const data = await loadDeveloperList();
      if (!data || !Array.isArray(data.developers)) {
        // Fallback to auth-utils function (if available)
        if (typeof getAllDevelopersSync === 'function') {
          const developers = getAllDevelopersSync();
          if (developers.length === 0) {
            devList.innerHTML = '<p class="text-sm text-slate-500 dark:text-slate-400">No developers found.</p>';
            return;
          }
          renderDeveloperListUI(developers);
          return;
        } else {
          devList.innerHTML = '<p class="text-sm text-red-500 dark:text-red-400">Error: Auth utilities not loaded.</p>';
          return;
        }
      }
      
      const developers = data.developers.map(e => e.trim().toLowerCase());
      renderDeveloperListUI(developers);
    }
    
    function renderDeveloperListUI(developers) {
      const devList = document.getElementById('dev-list');
      if (!devList) return;
      
      if (!developers || developers.length === 0) {
        devList.innerHTML = '<p class="text-sm text-slate-500 dark:text-slate-400">No developers found.</p>';
        return;
      }
      
      devList.innerHTML = developers.map(email => {
        const isHardcoded = isHardcodedDeveloper(email);
        const badgeClass = isHardcoded 
          ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300' 
          : 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300';
        
        return `
          <div class="flex items-center justify-between p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-slate-700 dark:text-slate-200">${escapeHtml(email)}</span>
              ${isHardcoded ? `<span class="text-xs px-2 py-0.5 rounded-full ${badgeClass}">Core Developer</span>` : ''}
            </div>
            ${!isHardcoded ? `
              <button 
                class="remove-dev text-sm text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium"
                data-email="${escapeHtml(email)}"
              >
                Remove
              </button>
            ` : ''}
          </div>
        `;
      }).join('');
      
      // Attach remove handlers
      devList.querySelectorAll('.remove-dev').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const email = e.target.getAttribute('data-email');
          if (confirm(`Remove developer access for ${email}?\n\nThis will be saved when you click "Push to GitHub".`)) {
            if (removeDevFromList(email)) {
              showMessage('Developer removed. Remember to push to GitHub!', 'success');
              showToast('info', 'Developer removed. Click "Push Developer List to GitHub" to save changes');
              hasDevPendingChanges = true;
              updateDevPendingIndicator();
              renderDeveloperList();
            } else {
              showMessage('Failed to remove developer', 'error');
            }
          }
        });
      });
    }
    
    /**
     * Add developer to the current list (updates local state and JSON structure)
     */
    function addDevToList(email) {
      if (!email) return { success: false, message: 'Email is required' };
      
      const normalized = email.trim().toLowerCase();
      
      // Email validation (format: something@something.something)
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(normalized)) {
        return { success: false, message: 'Invalid email format' };
      }
      
      // Ensure we have current data
      if (!currentDeveloperData) {
        currentDeveloperData = {
          version: 1,
          updatedAt: new Date().toISOString(),
          developers: ['blackshocktrooper@gmail.com', 'palm4215@wths.net']
        };
      }
      
      // Check if already exists
      const currentList = currentDeveloperData.developers.map(e => e.trim().toLowerCase());
      if (currentList.includes(normalized)) {
        return { success: false, message: 'Developer already exists' };
      }
      
      // Add to list
      currentDeveloperData.developers.push(normalized);
      currentDeveloperData.updatedAt = new Date().toISOString();
      
      return { success: true, message: 'Developer added successfully' };
    }
    
    /**
     * Remove developer from the current list (updates local state and JSON structure)
     */
    function removeDevFromList(email) {
      if (!email) return false;
      
      const normalized = email.trim().toLowerCase();
      
      // Cannot remove hardcoded developers
      if (isHardcodedDeveloper(normalized)) {
        return false;
      }
      
      // Ensure we have current data
      if (!currentDeveloperData || !Array.isArray(currentDeveloperData.developers)) {
        return false;
      }
      
      // Find and remove
      const index = currentDeveloperData.developers.findIndex(e => 
        e.trim().toLowerCase() === normalized
      );
      
      if (index === -1) {
        return false; // Not found
      }
      
      currentDeveloperData.developers.splice(index, 1);
      currentDeveloperData.updatedAt = new Date().toISOString();
      
      return true;
    }
    
    /**
     * Push developer list to GitHub
     */
    async function pushDeveloperList() {
      const token = document.getElementById('gh-token').value.trim();
      
      if (!token) {
        showToast('warn', 'Please enter a Personal Access Token (PAT) in the "Save Changes to GitHub" section below.');
        return;
      }
      
      if (!currentDeveloperData) {
        showToast('error', 'No developer data to push. Please reload the page.');
        return;
      }
      
      try {
        showToast('info', 'Pushing developer list to GitHub‚Ä¶');
        
        // Update the timestamp to reflect the actual commit time
        currentDeveloperData.updatedAt = new Date().toISOString();
        
        const content = JSON.stringify(currentDeveloperData, null, 2);
        const res = await pushFile(
          GH_OWNER, 
          GH_REPO, 
          'assets/data/developers.json', 
          GH_BRANCH, 
          token, 
          content, 
          'Update developers list'
        );
        
        if (res && res.commit && res.commit.sha) {
          showToast('success', 'Developer list saved ‚Ä¢ ' + res.commit.sha);
          showMessage('Developer list saved successfully! Commit: ' + res.commit.sha, 'success');
          
          // Reset pending changes indicator
          hasDevPendingChanges = false;
          updateDevPendingIndicator();
          
          // Clear the cache and re-fetch to confirm
          if (typeof clearDeveloperCache === 'function') {
            clearDeveloperCache();
          }
          
          // Clear legacy localStorage key if present
          try {
            localStorage.removeItem('developer_emails');
          } catch (e) {
            console.warn('[Developer Page] Could not clear legacy developer_emails key:', e);
          }
          
          // Re-fetch the developer list with cache-busting and update UI
          await loadDeveloperList(true);
          // currentDeveloperData is now set by loadDeveloperList, so renderDeveloperList will use it
          await renderDeveloperList();
          
        } else if (res && res.message) {
          // GitHub returned an error
          const msg = 'GitHub API error: ' + res.message;
          showToast('error', msg);
          showMessage(msg, 'error');
        } else {
          const msg = 'Unexpected response: ' + JSON.stringify(res);
          showToast('error', msg);
          showMessage('Error saving: ' + msg, 'error');
        }
      } catch (e) {
        const msg = 'Error: ' + e.message;
        showToast('error', msg);
        showMessage(msg, 'error');
      }
    }
    
    function showMessage(text, type = 'info') {
      const msgEl = document.getElementById('dev-add-message');
      if (!msgEl) return;
      
      msgEl.textContent = text;
      msgEl.classList.remove('hidden', 'text-green-600', 'text-red-600', 'text-slate-600');
      
      if (type === 'success') {
        msgEl.classList.add('text-green-600');
      } else if (type === 'error') {
        msgEl.classList.add('text-red-600');
      } else {
        msgEl.classList.add('text-slate-600');
      }
      
      // Auto-hide after 3 seconds
      setTimeout(() => {
        msgEl.classList.add('hidden');
      }, 3000);
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Initialize developer management
    function initDeveloperManagement() {
      const addBtn = document.getElementById('add-dev-btn');
      const emailInput = document.getElementById('dev-email-input');
      
      if (addBtn && emailInput) {
        addBtn.addEventListener('click', () => {
          const email = emailInput.value.trim();
          
          if (!email) {
            showMessage('Please enter an email address', 'error');
            showToast('warn', 'Please enter an email address');
            return;
          }
          
          const result = addDevToList(email);
          
          if (result.success) {
            showMessage(result.message + ' Remember to push to GitHub!', 'success');
            showToast('info', 'Developer added. Click "Push Developer List to GitHub" to save changes');
            emailInput.value = '';
            hasDevPendingChanges = true;
            updateDevPendingIndicator();
            renderDeveloperList();
          } else {
            showMessage(result.message, 'error');
            showToast('error', result.message);
          }
        });
        
        // Allow Enter key to add
        emailInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            addBtn.click();
          }
        });
      }
      
      // Push developer list button
      const pushDevBtn = document.getElementById('push-dev-list-btn');
      if (pushDevBtn) {
        pushDevBtn.addEventListener('click', pushDeveloperList);
      }
      
      // Initial render
      renderDeveloperList();
    }

    // ===== Team Member Management =====
    // Current team member list state (loaded from JSON file)
    let currentTeamMemberData = null;
    let hasTeamPendingChanges = false;
    
    /**
     * Update the pending changes indicator
     */
    function updateTeamPendingIndicator() {
      const indicator = document.getElementById('team-pending-indicator');
      if (!indicator) return;
      
      if (hasTeamPendingChanges) {
        indicator.classList.remove('hidden');
      } else {
        indicator.classList.add('hidden');
      }
    }
    
    /**
     * Load team member list from the JSON file
     */
    async function loadTeamMemberList(bustCache = false) {
      try {
        const url = bustCache 
          ? '/assets/data/team-members.json?v=' + Date.now()
          : '/assets/data/team-members.json';
        const response = await fetch(url);
        if (!response.ok) {
          showToast('warn', 'Could not load team member list from server');
          return null;
        }
        const data = await response.json();
        currentTeamMemberData = data;
        return data;
      } catch (err) {
        console.error('[Developer Page] Error loading team member list:', err);
        showToast('error', 'Error loading team member list: ' + err.message);
        return null;
      }
    }
    
    async function renderTeamMemberList() {
      const teamList = document.getElementById('team-list');
      if (!teamList) return;
      
      // If we have in-memory data, use it (for immediate UI updates)
      if (currentTeamMemberData && Array.isArray(currentTeamMemberData.teamMembers)) {
        const teamMembers = currentTeamMemberData.teamMembers.map(e => e.trim().toLowerCase());
        renderTeamMemberListUI(teamMembers);
        return;
      }
      
      // Otherwise, load from JSON file
      teamList.innerHTML = '<p class="text-sm text-slate-500 dark:text-slate-400">Loading...</p>';
      const data = await loadTeamMemberList();
      if (!data || !Array.isArray(data.teamMembers)) {
        // Fallback to auth-utils function (if available)
        if (typeof getAllTeamMembersSync === 'function') {
          const teamMembers = getAllTeamMembersSync();
          if (teamMembers.length === 0) {
            teamList.innerHTML = '<p class="text-sm text-slate-500 dark:text-slate-400">No team members found.</p>';
            return;
          }
          renderTeamMemberListUI(teamMembers);
          return;
        } else {
          teamList.innerHTML = '<p class="text-sm text-red-500 dark:text-red-400">Error: Auth utilities not loaded.</p>';
          return;
        }
      }
      
      const teamMembers = data.teamMembers.map(e => e.trim().toLowerCase());
      renderTeamMemberListUI(teamMembers);
    }
    
    function renderTeamMemberListUI(teamMembers) {
      const teamList = document.getElementById('team-list');
      if (!teamList) return;
      
      if (!teamMembers || teamMembers.length === 0) {
        teamList.innerHTML = '<p class="text-sm text-slate-500 dark:text-slate-400">No team members found.</p>';
        return;
      }
      
      teamList.innerHTML = teamMembers.map(email => {
        const isHardcoded = isHardcodedTeamMember(email);
        const badgeClass = isHardcoded 
          ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300' 
          : 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300';
        
        return `
          <div class="flex items-center justify-between p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-slate-700 dark:text-slate-200">${escapeHtml(email)}</span>
              ${isHardcoded ? `<span class="text-xs px-2 py-0.5 rounded-full ${badgeClass}">Core Team Member</span>` : ''}
            </div>
            ${!isHardcoded ? `
              <button 
                class="remove-team text-sm text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium"
                data-email="${escapeHtml(email)}"
              >
                Remove
              </button>
            ` : ''}
          </div>
        `;
      }).join('');
      
      // Attach remove handlers
      teamList.querySelectorAll('.remove-team').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const email = e.target.getAttribute('data-email');
          if (confirm(`Remove team member access for ${email}?\n\nThis will be saved when you click "Push to GitHub".`)) {
            if (removeTeamFromList(email)) {
              showTeamMessage('Team member removed. Remember to push to GitHub!', 'success');
              showToast('info', 'Team member removed. Click "Push Team Member List to GitHub" to save changes');
              hasTeamPendingChanges = true;
              updateTeamPendingIndicator();
              renderTeamMemberList();
            } else {
              showTeamMessage('Failed to remove team member', 'error');
            }
          }
        });
      });
    }
    
    /**
     * Add team member to the current list (updates local state and JSON structure)
     */
    function addTeamToList(email) {
      if (!email) return { success: false, message: 'Email is required' };
      
      const normalized = email.trim().toLowerCase();
      
      // Email validation (format: something@something.something)
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(normalized)) {
        return { success: false, message: 'Invalid email format' };
      }
      
      // Ensure we have current data
      if (!currentTeamMemberData) {
        currentTeamMemberData = {
          version: 1,
          updatedAt: new Date().toISOString(),
          teamMembers: ['blackshocktrooper@gmail.com', 'palm4215@wths.net']
        };
      }
      
      // Check if already exists
      const currentList = currentTeamMemberData.teamMembers.map(e => e.trim().toLowerCase());
      if (currentList.includes(normalized)) {
        return { success: false, message: 'Team member already exists' };
      }
      
      // Add to list
      currentTeamMemberData.teamMembers.push(normalized);
      currentTeamMemberData.updatedAt = new Date().toISOString();
      
      return { success: true, message: 'Team member added successfully' };
    }
    
    /**
     * Remove team member from the current list (updates local state and JSON structure)
     */
    function removeTeamFromList(email) {
      if (!email) return false;
      
      const normalized = email.trim().toLowerCase();
      
      // Cannot remove hardcoded team members
      if (isHardcodedTeamMember(normalized)) {
        return false;
      }
      
      // Ensure we have current data
      if (!currentTeamMemberData || !Array.isArray(currentTeamMemberData.teamMembers)) {
        return false;
      }
      
      // Find and remove
      const index = currentTeamMemberData.teamMembers.findIndex(e => 
        e.trim().toLowerCase() === normalized
      );
      
      if (index === -1) {
        return false; // Not found
      }
      
      currentTeamMemberData.teamMembers.splice(index, 1);
      currentTeamMemberData.updatedAt = new Date().toISOString();
      
      return true;
    }
    
    /**
     * Push team member list to GitHub
     */
    async function pushTeamMemberList() {
      const token = document.getElementById('gh-token').value.trim();
      
      if (!token) {
        showToast('warn', 'Please enter a Personal Access Token (PAT) in the "Save Changes to GitHub" section below.');
        return;
      }
      
      if (!currentTeamMemberData) {
        showToast('error', 'No team member data to push. Please reload the page.');
        return;
      }
      
      try {
        showToast('info', 'Pushing team member list to GitHub‚Ä¶');
        
        // Update the timestamp to reflect the actual commit time
        currentTeamMemberData.updatedAt = new Date().toISOString();
        
        const content = JSON.stringify(currentTeamMemberData, null, 2);
        const res = await pushFile(
          GH_OWNER, 
          GH_REPO, 
          'assets/data/team-members.json', 
          GH_BRANCH, 
          token, 
          content, 
          'Update team members list'
        );
        
        if (res && res.commit && res.commit.sha) {
          showToast('success', 'Team member list saved ‚Ä¢ ' + res.commit.sha);
          showTeamMessage('Team member list saved successfully! Commit: ' + res.commit.sha, 'success');
          
          // Reset pending changes indicator
          hasTeamPendingChanges = false;
          updateTeamPendingIndicator();
          
          // Clear the cache and re-fetch to confirm
          if (typeof clearTeamMemberCache === 'function') {
            clearTeamMemberCache();
          }
          
          // Clear legacy localStorage key if present
          try {
            localStorage.removeItem('team_member_emails');
          } catch (e) {
            console.warn('[Developer Page] Could not clear legacy team_member_emails key:', e);
          }
          
          // Re-fetch the team member list with cache-busting and update UI
          await loadTeamMemberList(true);
          await renderTeamMemberList();
          
        } else if (res && res.message) {
          // GitHub returned an error
          const msg = 'GitHub API error: ' + res.message;
          showToast('error', msg);
          showTeamMessage(msg, 'error');
        } else {
          const msg = 'Unexpected response: ' + JSON.stringify(res);
          showToast('error', msg);
          showTeamMessage('Error saving: ' + msg, 'error');
        }
      } catch (e) {
        const msg = 'Error: ' + e.message;
        showToast('error', msg);
        showTeamMessage(msg, 'error');
      }
    }
    
    function showTeamMessage(text, type = 'info') {
      const msgEl = document.getElementById('team-add-message');
      if (!msgEl) return;
      
      msgEl.textContent = text;
      msgEl.classList.remove('hidden', 'text-green-600', 'text-red-600', 'text-slate-600');
      
      if (type === 'success') {
        msgEl.classList.add('text-green-600');
      } else if (type === 'error') {
        msgEl.classList.add('text-red-600');
      } else {
        msgEl.classList.add('text-slate-600');
      }
      
      // Auto-hide after 3 seconds
      setTimeout(() => {
        msgEl.classList.add('hidden');
      }, 3000);
    }
    
    // Initialize team member management
    function initTeamMemberManagement() {
      const addBtn = document.getElementById('add-team-btn');
      const emailInput = document.getElementById('team-email-input');
      
      if (addBtn && emailInput) {
        addBtn.addEventListener('click', () => {
          const email = emailInput.value.trim();
          
          if (!email) {
            showTeamMessage('Please enter an email address', 'error');
            showToast('warn', 'Please enter an email address');
            return;
          }
          
          const result = addTeamToList(email);
          
          if (result.success) {
            showTeamMessage(result.message + ' Remember to push to GitHub!', 'success');
            showToast('info', 'Team member added. Click "Push Team Member List to GitHub" to save changes');
            emailInput.value = '';
            hasTeamPendingChanges = true;
            updateTeamPendingIndicator();
            renderTeamMemberList();
          } else {
            showTeamMessage(result.message, 'error');
            showToast('error', result.message);
          }
        });
        
        // Allow Enter key to add
        emailInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            addBtn.click();
          }
        });
      }
      
      // Push team member list button
      const pushTeamBtn = document.getElementById('push-team-list-btn');
      if (pushTeamBtn) {
        pushTeamBtn.addEventListener('click', pushTeamMemberList);
      }
      
      // Initial render
      renderTeamMemberList();
    }

    // ===== Initialize =====
    window.addEventListener('DOMContentLoaded', () => {
      loadExisting();
      initDeveloperManagement();
      initTeamMemberManagement();
    });
  </script>
  <script src="/assets/js/theme.js"></script>
</body>
</html>
