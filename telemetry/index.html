<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Site Telemetry & Monitoring — DarkShockGamer</title>
  <!-- Privacy-friendly analytics by Plausible -->
  <script async src="https://plausible.io/js/pa-M5H8HPpMEkcSIPK4fxOhN.js"></script>
  <script>
    window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
    plausible.init()
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(to bottom, #f0f9ff, white); font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    @media (prefers-color-scheme: dark) {
      html, body { color-scheme: dark; }
      body { background: linear-gradient(to bottom, #0b1220, #0a0f1a); color: #e5e7eb; }
    }
    .panel { background: white; border: 1px solid #e2e8f0; border-radius: 1rem; box-shadow: 0 1px 2px rgba(2, 6, 23, 0.05); }
    @media (prefers-color-scheme: dark) {
      .panel { background: #0f172a; border-color: #1f2937; box-shadow: 0 1px 2px rgba(2, 6, 23, 0.30); }
    }
    .stat-card {
      border-radius: 0.9rem;
      border: 1px solid rgba(148,163,184,0.55);
      background: radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 50%), rgba(15,23,42,0.98);
      color: #e5e7eb;
      box-shadow: 0 14px 40px rgba(15,23,42,0.9);
      transform-origin: center;
      transition: transform 160ms cubic-bezier(.2,0.9,.3,1.3), box-shadow 160ms cubic-bezier(.2,0.9,.3,1.3);
    }
    .stat-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 55px rgba(15,23,42,0.95);
    }
    .stat-spark {
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg,#38bdf8,#22c55e,#eab308);
      opacity: 0.9;
    }
    .btn-ripple { position: relative; overflow: hidden; }
    .btn-ripple:focus-visible { outline: 2px solid #93c5fd; outline-offset: 2px; }
    .ripple {
      position: absolute;
      border-radius: 9999px;
      transform: translate(-50%, -50%) scale(0);
      pointer-events: none;
      opacity: 0.25;
      background: currentColor;
      animation: ripple 650ms ease-out forwards;
      mix-blend-mode: multiply;
    }
    @keyframes ripple {
      to { transform: translate(-50%, -50%) scale(6); opacity: 0; }
    }
    .hover-lift {
      transition: transform 200ms cubic-bezier(.23,1.14,.81,1.03), box-shadow 200ms cubic-bezier(.23,1.14,.81,1.03), border-color 200ms;
      will-change: transform;
    }
    .hover-lift:hover {
      transform: translateY(-4px) scale(1.03);
      box-shadow: 0 12px 28px rgba(2,132,199,0.15);
      border-color: #93c5fd;
    }
  </style>
</head>
<body class="min-h-screen">
  <header class="border-b border-slate-200/80 dark:border-slate-800 bg-white/70 dark:bg-slate-950/70 backdrop-blur-sm">
    <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
      <div>
        <h1 class="text-xl font-semibold tracking-tight text-slate-900 dark:text-slate-100">
          Site Telemetry &amp; Monitoring
        </h1>
        <p class="text-xs text-slate-500 dark:text-slate-400">
          Snapshots and event stream for this website.
        </p>
      </div>
      <a href="/" class="btn-ripple px-3 py-1.5 rounded-full border border-slate-300 dark:border-slate-700 bg-white/70 dark:bg-slate-900/70 text-[11px] text-slate-700 dark:text-slate-200 hover-lift">
        Home
      </a>
    </div>
  </header>
  <main class="max-w-4xl mx-auto px-4 py-6 space-y-6">
    <!-- Telemetry Snapshots, UI Lab style -->
    <section class="panel p-5 hover-lift reveal">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-slate-800 dark:text-slate-200">Telemetry Snapshots</h2>
        <span class="text-[11px] text-slate-400 dark:text-slate-500">Realtime tiles</span>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <button class="stat-card px-4 py-3 text-left btn-ripple" data-sound="info" id="tile-status">
          <p class="text-[11px] uppercase tracking-[0.16em] text-sky-300/80">Site Status</p>
          <p class="text-2xl font-semibold mt-1" id="telemetry-status">Online</p>
          <p class="text-[11px] text-slate-400 mt-1" id="telemetry-status-msg">GitHub Pages active</p>
          <div class="stat-spark mt-2"></div>
        </button>
        <button class="stat-card px-4 py-3 text-left btn-ripple" data-sound="success" id="tile-uptime">
          <p class="text-[11px] uppercase tracking-[0.16em] text-emerald-300/80">Last Commit</p>
          <p class="text-2xl font-semibold mt-1" id="telemetry-uptime">...</p>
          <p class="text-[11px] text-slate-400 mt-1" id="telemetry-commit-date">...</p>
          <div class="stat-spark mt-2"></div>
        </button>
        <button class="stat-card px-4 py-3 text-left btn-ripple" data-sound="warn" id="tile-views" disabled>
          <p class="text-[11px] uppercase tracking-[0.16em] text-amber-300/80">Unique Views</p>
          <p class="text-2xl font-semibold mt-1" id="telemetry-views" title="Unique viewers today, Plausible.io">–</p>
          <p class="text-[11px] text-slate-400 mt-1">Today (via Plausible)</p>
          <div class="stat-spark mt-2"></div>
        </button>
      </div>
    </section>
    <!-- Notification/Event Timeline, UI Lab style -->
    <section class="panel p-5 hover-lift reveal">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-slate-800 dark:text-slate-200">Notification Stream</h2>
        <button id="demoTimelineToast" class="btn-ripple text-xs px-2.5 py-1.5 rounded-full border border-slate-300 dark:border-slate-700">Ping Latest</button>
      </div>
      <ol class="relative border-l border-slate-200 dark:border-slate-700 pl-4 space-y-3 text-sm" id="event-timeline">
        <li class="flex gap-3 items-start">
          <span class="mt-1 w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_0_3px_rgba(16,185,129,0.18)]"></span>
          <div>
            <p class="text-slate-800 dark:text-slate-100 font-medium">Loading events&hellip;</p>
            <p class="text-[11px] text-slate-500 dark:text-slate-400">&nbsp;</p>
          </div>
          <span class="ml-auto text-[11px] text-slate-400 dark:text-slate-500"></span>
        </li>
      </ol>
    </section>
    <footer class="pt-10 text-center text-xs text-gray-400">
      Telemetry dashboard &copy; 2025 DarkShockGamer &middot; <a class="underline text-sky-500" href="/">Back to Home</a>
    </footer>
  </main>
  <script>
    // --- UI Lab Sound and Ripple ---
    const Sound = (() => {
      const state = {
        ctx: null, master: null, enabled: true,
        prefersReduced: window.matchMedia('(prefers-reduced-motion: reduce)').matches
      };
      function ensureCtx() {
        if (!state.ctx) {
          const ctx = new (window.AudioContext||window.webkitAudioContext)();
          const master = ctx.createGain();
          master.gain.value = 0.6;
          master.connect(ctx.destination);
          state.ctx = ctx; state.master = master;
          const resume = () => { if (ctx.state==='suspended') ctx.resume(); document.removeEventListener('pointerdown',resume,true);};
          document.addEventListener('pointerdown', resume, true);
        }
      }
      function tone({freq=440,type='sine',duration=0.12,attack=0.005,decay=0.08,gain=0.3,detune=0}) {
        if (!state.enabled) return;
        ensureCtx();
        const t0 = state.ctx.currentTime;
        const osc = state.ctx.createOscillator();
        const g = state.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, t0);
        if (detune) osc.detune.setValueAtTime(detune, t0);
        g.gain.setValueAtTime(0, t0);
        g.gain.linearRampToValueAtTime(gain, t0 + attack);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + attack + decay);
        osc.connect(g).connect(state.master);
        osc.start(t0); osc.stop(t0 + Math.max(duration, attack+decay));
      }
      return {
        click:()=>tone({freq:240,type:'triangle',duration:0.08,attack:0.002,decay:0.06,gain:0.22}),
        success:()=>{tone({freq:660,type:'sine',attack:0.004,decay:0.10,gain:0.25});setTimeout(()=>tone({freq:880,type:'sine',attack:0.004,decay:0.12,gain:0.23}),90);},
        warn:()=>tone({freq:320,type:'square',attack:0.003,decay:0.15,gain:0.2}),
        error:()=>{tone({freq:220,type:'square',attack:0.002,decay:0.2,gain:0.25});setTimeout(()=>tone({freq:180,type:'square',attack:0.002,decay:0.22,gain:0.22}), 90);},
        info:()=>tone({freq:520,type:'triangle',attack:0.004,decay:0.12,gain:0.22}),
      };
    })();
    function addRipple(e) {
      const btn = e.currentTarget;
      const rect = btn.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const span = document.createElement('span');
      span.className = 'ripple';
      span.style.width = span.style.height = size + 'px';
      span.style.left = (e.clientX - rect.left) + 'px';
      span.style.top = (e.clientY - rect.top) + 'px';
      btn.appendChild(span);
      span.addEventListener('animationend', () => span.remove());
    }
    document.querySelectorAll('.btn-ripple').forEach(btn => {
      btn.addEventListener('click', addRipple);
      const soundType = btn.getAttribute('data-sound');
      if (soundType) {
        btn.addEventListener('click', () => {
          if(soundType==='click') Sound.click();
          if(soundType==='success') Sound.success();
          if(soundType==='warn') Sound.warn();
          if(soundType==='error') Sound.error();
          if(soundType==='info') Sound.info();
        });
      }
    });
    // Reveal entry motion
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in');
          Sound.info();
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.2 });
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    // --- GitHub API Data (status, commit, events) ---
    async function fetchCommit() {
      const res = await fetch("https://api.github.com/repos/DarkShockGamer/DarkShockGamer.github.io/commits/main");
      if(!res.ok) return;
      const data = await res.json();
      document.getElementById('telemetry-uptime').textContent = data.sha ? data.sha.substring(0, 7) : '—';
      document.getElementById('telemetry-commit-date').textContent = data.commit?.committer?.date ? "Pushed: " + new Date(data.commit.committer.date).toLocaleString() : '';
    }
    async function fetchEvents() {
      const res = await fetch("https://api.github.com/repos/DarkShockGamer/DarkShockGamer.github.io/events");
      if(!res.ok) return;
      const events = await res.json();
      if (!Array.isArray(events)) return;
      const timeline = document.getElementById("event-timeline");
      timeline.innerHTML = events.slice(0, 6).map(ev => {
        let color = ev.type.includes('Push') ? 'bg-sky-400' :
                    ev.type.includes('Create') ? 'bg-emerald-400' :
                    ev.type.includes('Delete') ? 'bg-red-400' :
                    'bg-amber-400';
        let desc = '';
        if (ev.type === 'PushEvent') {
          desc = ev.payload.commits && ev.payload.commits.length
            ? `${ev.payload.commits[0].message}`
            : 'Push to ' + ev.repo.name;
        } else if (ev.type === 'CreateEvent') {
          desc = `Created ${ev.payload.ref_type}: ${ev.payload.ref || ""}`;
        } else if (ev.type === 'DeleteEvent') {
          desc = `Deleted ${ev.payload.ref_type}: ${ev.payload.ref || ""}`;
        } else if (ev.type === 'IssuesEvent') {
          desc = `${ev.payload.action} issue #${ev.payload.issue?.number || ""}`;
        } else if (ev.type === 'PullRequestEvent') {
          desc = `${ev.payload.action} PR #${ev.payload.pull_request?.number || ""}`;
        } else {
          desc = ev.type.replace(/Event$/, '');
        }
        return `
      <li class="flex gap-3 items-start">
        <span class="mt-1 w-2 h-2 rounded-full ${color} shadow-[0_0_0_3px_rgba(56,189,248,0.12)]"></span>
        <div>
          <p class="text-slate-800 dark:text-slate-100 font-medium">${ev.type.replace(/Event$/,'')}</p>
          <p class="text-[11px] text-slate-500 dark:text-slate-400">${desc}</p>
        </div>
        <span class="ml-auto text-[11px] text-slate-400 dark:text-slate-500" title="${ev.created_at}">${new Date(ev.created_at).toLocaleString()}</span>
      </li>`;
      }).join('');
    }
    // "Ping Latest" button adds a fake event (not from GitHub)
    document.getElementById('demoTimelineToast').addEventListener('click', () => {
      Sound.info();
      const timeline = document.getElementById('event-timeline');
      const now = new Date().toISOString();
      const li = document.createElement('li');
      li.className = 'flex gap-3 items-start';
      li.innerHTML = `
        <span class="mt-1 w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_0_3px_rgba(16,185,129,0.18)]"></span>
        <div>
          <p class="text-slate-800 dark:text-slate-100 font-medium">Manual site check pinged</p>
          <p class="text-[11px] text-slate-500 dark:text-slate-400">Check at ${new Date().toLocaleTimeString()}, status ok</p>
        </div>
        <span class="ml-auto text-[11px] text-slate-400 dark:text-slate-500" title="${now}">Now</span>
      `;
      timeline.insertBefore(li, timeline.firstChild);
    });

    fetchCommit();
    fetchEvents();
    setInterval(fetchCommit, 120000);
    setInterval(fetchEvents, 120000);
  </script>
  <!-- Plausible Unique Visitors API Fetch -->
  <!-- 
    IMPORTANT: For security, this example assumes you have a proxy endpoint at /api/plausible-visitors
    that returns the Plausible API stats JSON. Never expose your Plausible API key publicly!
    For testing only, you may use the direct API endpoint if you understand the risk.
    Replace '/api/plausible-visitors' with your own endpoint.
  -->
  <script>
    fetch('/api/plausible-visitors')
      .then(res => res.json())
      .then(data => {
        if (data.results && data.results.visitors)
          document.getElementById("telemetry-views").textContent = data.results.visitors.value;
      })
      .catch(() => {
        document.getElementById("telemetry-views").textContent = "–";
      });
  </script>
</body>
</html>
