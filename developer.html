<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <title>Developer - Edit Site Content</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Extra polish to complement Tailwind */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #e0f2fe;      /* sky-100 */
      color: #0369a1;           /* sky-700 */
      padding: 4px 10px;
      border-radius: 9999px;
      margin: 4px 6px 0 0;
      border: 1px solid #bae6fd;/* sky-200 */
      font-size: 0.85rem;
      line-height: 1.2rem;
      white-space: nowrap;
    }
    .pill button {
      margin: 0 0 0 4px;
      padding: 2px 8px;
      line-height: 1;
      border: 1px solid rgba(2,132,199,0.25);
      border-radius: 9999px;
      color: #0369a1;
      background: white;
    }
    .pill select {
      margin: 0;
      padding: 2px 6px;
      border: 1px solid #93c5fd; /* sky-300 */
      border-radius: 8px;
      background: white;
      color: #0369a1;
    }
    .muted { color: #64748b; } /* slate-500 */
    .timeline-entry {
      background: white;
      border: 1px solid #e2e8f0; /* slate-200 */
      border-radius: 0.75rem;
      padding: 0.75rem;
      box-shadow: 0 1px 1px rgba(2, 6, 23, 0.04);
    }
    .timeline-entry:hover {
      box-shadow: 0 6px 16px rgba(2,132,199,0.12);
      border-color: #93c5fd; /* sky-300 */
      transform: translateY(-1px);
      transition: box-shadow 150ms, border-color 150ms, transform 150ms;
    }
    textarea { min-height: 120px; font-family: inherit; }

    /* Dark mode (system preference) */
    @media (prefers-color-scheme: dark) {
      html, body { color-scheme: dark; }
      body { color: #e5e7eb; } /* slate-200 */

      .muted { color: #94a3b8 !important; } /* slate-400 */

      .pill {
        background: #0c4a6e !important; /* sky-900-ish */
        color: #e0f2fe !important;      /* sky-100 */
        border-color: #075985 !important; /* sky-700 */
      }
      .pill button {
        background: #0b1220 !important;
        color: #e0f2fe !important;
        border-color: #075985 !important;
      }
      .pill select {
        background: #0b1220 !important;
        color: #e5e7eb !important;
        border-color: #0ea5e9 !important;
      }

      .timeline-entry {
        background: #0f172a !important; /* slate-900 */
        border-color: #1f2937 !important; /* slate-800 */
        box-shadow: 0 1px 1px rgba(2, 6, 23, 0.6);
      }
      .timeline-entry:hover {
        border-color: #0ea5e9 !important; /* sky-500 */
        box-shadow: 0 6px 16px rgba(14,165,233,0.18);
      }

      /* Inputs and selects */
      input[type="text"],
      input[type="password"],
      input[type="date"],
      input:not([type]),
      select,
      textarea {
        background: #0b1220 !important;  /* near slate-950 */
        color: #e5e7eb !important;
        border-color: #334155 !important; /* slate-600 */
      }
      input::placeholder { color: #94a3b8 !important; }

      /* Generic border buttons */
      button.border {
        border-color: #374151 !important; /* slate-700 */
        color: #e5e7eb !important;
      }
      button.border:hover {
        background: #1f2937 !important; /* slate-800 */
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 to-white dark:from-slate-900 dark:to-slate-950 font-sans text-slate-800 dark:text-slate-200">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-4">
    <div class="flex items-center gap-3">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-8 w-8"/>
      <div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-sky-800 dark:text-sky-300 leading-snug">Developer Editor</h1>
        <p class="text-sm text-sky-600 dark:text-sky-400">Edit site content and download or push the data file</p>
      </div>
    </div>
    <p class="muted mt-2">Pushing directly requires a GitHub Personal Access Token with repo write permissions. You can also download the file and commit via GitHub.</p>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-16 space-y-6">
    <!-- Site Content -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200 mb-3">Site Content</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="col-span-1">
          <label for="site-title" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Site Title</label>
          <input id="site-title" type="text" placeholder="Site title"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
        <div class="col-span-1">
          <label for="about-heading" class="block text-sm font-medium text-slate-700 dark:text-slate-300">About Heading</label>
          <input id="about-heading" type="text" placeholder="About heading"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
      </div>

      <div class="mt-4">
        <label for="about-content" class="block text-sm font-medium text-slate-700 dark:text-slate-300">About Content (HTML allowed)</label>
        <textarea id="about-content" placeholder="<p>About text...</p>"
                  class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:focus:ring-sky-800"></textarea>
      </div>
    </section>

    <!-- Timeline -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Timeline</h2>
        <button id="add-timeline"
                class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">+ Add Timeline Event</button>
      </div>
      <div id="timeline-list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <!-- Leadership -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Leadership</h2>

      <!-- Leads -->
      <div class="mt-3">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Leads</label>
        <div id="leads-list" class="mt-2"></div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
          <input id="new-lead" type="text" placeholder="Add lead name"
                 class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
          <select id="new-lead-team" aria-label="Lead team"
                  class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:focus:ring-sky-800"></select>
          <button id="add-lead"
                  class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add</button>
        </div>
      </div>

      <!-- Drivers -->
      <div class="mt-6">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Drivers</label>
        <div id="drivers-list" class="mt-2"></div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-[1fr_auto] gap-2">
          <input id="new-driver" type="text" placeholder="Add driver name"
                 class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
          <button id="add-driver"
                  class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add</button>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2">Data Actions</h2>
      <div class="flex flex-wrap gap-2">
        <button id="download-json" class="border border-slate-300 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800 px-4 py-2 rounded-md font-semibold shadow-sm">
          Download data/site.json
        </button>
        <button id="preview-json" class="border border-slate-300 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800 px-4 py-2 rounded-md font-semibold shadow-sm">
          Preview JSON
        </button>
      </div>
    </section>

    <!-- GitHub Push -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h3 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Optional: Push to GitHub</h3>
      <p class="muted mt-1">Provide owner/repo/branch/path and a PAT with repo permissions to push directly.
        The token is only used in your browser.</p>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="gh-owner" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Owner</label>
          <input id="gh-owner" type="text" placeholder="owner" value="DarkShockGamer"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
        <div>
          <label for="gh-repo" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Repo</label>
          <input id="gh-repo" type="text" placeholder="repo" value="DarkShockGamer.github.io"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
        <div>
          <label for="gh-branch" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Branch</label>
          <input id="gh-branch" type="text" placeholder="branch" value="main"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
        <div>
          <label for="gh-path" class="block text-sm font-medium text-slate-700 dark:text-slate-300">File path</label>
          <input id="gh-path" type="text" placeholder="path" value="data/site.json"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
        <div class="md:col-span-2">
          <label for="gh-token" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Personal Access Token (PAT)</label>
          <input id="gh-token" type="password" placeholder="ghp_xxx"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-sky-800"/>
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mt-4">
        <button id="dry-run" class="border border-slate-300 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800 px-4 py-2 rounded-md font-semibold shadow-sm">
          Dry run (get SHA)
        </button>
        <button id="push-github" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">
          Push to GitHub
        </button>
      </div>
      <pre id="gh-result" class="muted mt-3 whitespace-pre-wrap text-sm"></pre>
    </section>

    <footer class="text-center py-4 border-t border-slate-100 dark:border-slate-800 flex flex-col items-center gap-1">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-6 w-6" />
      <span class="text-sky-600 dark:text-sky-400 text-sm">© 2025 Trident Robotics — Developer Editor</span>
      <span class="text-xs text-sky-400">Internal content management • Edits saved to data/site.json</span>
    </footer>
  </main>

  <script>
    // Minimal editor logic (unchanged functionality)
    function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }
    let siteData = {
      title: document.getElementById('site-title')?.value || 'Trident Robotics 4296',
      about: { heading: 'About Us', content: '<p>Edit...</p>' },
      timeline: [],
      leadership: {
        teams: [
          { team: "Design Team", role: "Lead", members: [] },
          { team: "Mechanical Team", role: "Lead", members: [] },
          { team: "Electrical Team", role: "Lead", members: [] },
          { team: "Programming Team", role: "Lead", members: [] },
          { team: "Drive Team", role: "Driver", members: [] }
        ],
        // leads supports objects: { name, team }
        leads: [],
        drivers: []
      }
    };

    async function loadExisting() {
      try {
        const r = await fetch('/data/site.json?_=' + Date.now());
        if (r.ok) siteData = await r.json();
      } catch (e) { /* ignore */ }
      // Backward-compat: normalize leads [string] -> [{name, team:""}]
      if (siteData && siteData.leadership) {
        const leads = siteData.leadership.leads || [];
        siteData.leadership.leads = leads.map(l => {
          if (typeof l === 'string') return { name: l, team: '' };
          if (l && typeof l === 'object') return { name: l.name || '', team: l.team || '' };
          return { name: String(l || ''), team: '' };
        });
      }
      renderEditor();
    }

    function teamOptionsHtml(selectedTeam) {
      const teams = (siteData.leadership && siteData.leadership.teams) ? siteData.leadership.teams : [];
      const options = [''].concat(teams.map(t => t.team));
      return options.map(t => {
        const sel = (t === (selectedTeam || '')) ? ' selected' : '';
        const label = t || '— Select team —';
        return `<option value="${t.replace(/"/g, '&quot;')}"${sel}>${label}</option>`;
      }).join('');
    }

    function renderEditor(){
      // top-level fields
      document.getElementById('site-title').value = siteData.title || '';
      document.getElementById('about-heading').value = (siteData.about && siteData.about.heading) || '';
      document.getElementById('about-content').value = (siteData.about && siteData.about.content) || '';

      // Timeline
      const tl = document.getElementById('timeline-list'); tl.innerHTML = '';
      (siteData.timeline || []).forEach((ev, idx) => {
        const card = document.createElement('div'); card.className='timeline-entry';
        card.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <h3 class="text-base font-semibold text-slate-700 dark:text-slate-200">Event ${idx+1}</h3>
            <div class="flex gap-2">
              <button type="button" class="up border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-2 py-1 text-xs hover:bg-slate-50 dark:hover:bg-slate-800">↑</button>
              <button type="button" class="down border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-2 py-1 text-xs hover:bg-slate-50 dark:hover:bg-slate-800">↓</button>
              <button type="button" class="del border border-red-200 dark:border-red-900 rounded-md px-2 py-1 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950">Delete</button>
            </div>
          </div>
          <div class="grid grid-cols-1 gap-2 mt-2">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">When</label>
              <input class="ev-date mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:focus:ring-sky-800"
                     value="${(ev.date||ev.year||'').replace(/"/g, '&quot;')}">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Title</label>
              <input class="ev-title mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:focus:ring-sky-800"
                     value="${(ev.title||'').replace(/"/g, '&quot;')}">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Description (HTML)</label>
              <textarea class="ev-desc mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:focus:ring-sky-800">${ev.description||''}</textarea>
            </div>
          </div>
        `;
        tl.appendChild(card);

        // actions
        card.querySelector('.del').addEventListener('click',()=>{ siteData.timeline.splice(idx,1); renderEditor(); });
        card.querySelector('.up').addEventListener('click',()=>{
          if(idx>0){
            const a=siteData.timeline[idx-1];
            siteData.timeline[idx-1]=siteData.timeline[idx];
            siteData.timeline[idx]=a;
            renderEditor();
          }
        });
        card.querySelector('.down').addEventListener('click',()=>{
          if(idx<siteData.timeline.length-1){
            const a=siteData.timeline[idx+1];
            siteData.timeline[idx+1]=siteData.timeline[idx];
            siteData.timeline[idx]=a;
            renderEditor();
          }
        });
        card.querySelector('.ev-date').addEventListener('input',(e)=> siteData.timeline[idx].date = e.target.value);
        card.querySelector('.ev-title').addEventListener('input',(e)=> siteData.timeline[idx].title = e.target.value);
        card.querySelector('.ev-desc').addEventListener('input',(e)=> siteData.timeline[idx].description = e.target.value);
      });

      // Leads with team selection
      const leadsC = document.getElementById('leads-list'); leadsC.innerHTML = '';
      (siteData.leadership.leads || []).forEach((lead, i) => {
        const item = (typeof lead === 'string') ? { name: lead, team: '' } : (lead || { name: '', team: '' });
        const span = document.createElement('span'); span.className='pill';
        span.innerHTML = `
          <strong>${(item.name||'').replace(/</g,'&lt;')}</strong>
          <span class="text-slate-400">—</span>
          <select class="lead-team" aria-label="Lead team">${teamOptionsHtml(item.team)}</select>
          <button type="button" class="remove" aria-label="Remove lead">×</button>
        `;
        leadsC.appendChild(span);
        span.querySelector('.lead-team').addEventListener('change',(e)=>{
          siteData.leadership.leads[i] = { name: item.name, team: e.target.value };
        });
        span.querySelector('.remove').addEventListener('click',()=>{
          siteData.leadership.leads.splice(i,1);
          renderEditor();
        });
      });

      // Populate the "new lead team" select
      const newLeadTeam = document.getElementById('new-lead-team');
      newLeadTeam.innerHTML = teamOptionsHtml('');

      // Drivers (simple list of strings)
      const driversC = document.getElementById('drivers-list'); driversC.innerHTML = '';
      (siteData.leadership.drivers || []).forEach((n,i)=> {
        const span = document.createElement('span'); span.className='pill';
        span.textContent=n;
        const btn = document.createElement('button'); btn.textContent='×'; btn.addEventListener('click',()=>{ siteData.leadership.drivers.splice(i,1); renderEditor(); });
        span.appendChild(btn); driversC.appendChild(span);
      });
    }

    // Add handlers
    document.getElementById('add-timeline').addEventListener('click', ()=>{
      siteData.timeline.push({id:uid(), date:new Date().toLocaleDateString(), title:'New event', description:''});
      renderEditor();
    });

    document.getElementById('add-lead').addEventListener('click', ()=>{
      const name = document.getElementById('new-lead').value.trim();
      const team = document.getElementById('new-lead-team').value.trim();
      if (name){
        siteData.leadership.leads.push({ name, team });
        document.getElementById('new-lead').value = '';
        document.getElementById('new-lead-team').value = '';
        renderEditor();
      }
    });

    document.getElementById('add-driver').addEventListener('click', ()=>{
      const v=document.getElementById('new-driver').value.trim();
      if(v){
        siteData.leadership.drivers.push(v);
        document.getElementById('new-driver').value='';
        renderEditor();
      }
    });

    // Live updates
    document.getElementById('site-title').addEventListener('input',(e)=> siteData.title = e.target.value);
    document.getElementById('about-heading').addEventListener('input',(e)=> siteData.about.heading = e.target.value);
    document.getElementById('about-content').addEventListener('input',(e)=> siteData.about.content = e.target.value);

    // Download/preview
    document.getElementById('download-json').addEventListener('click', ()=>{
      const b = new Blob([JSON.stringify(siteData,null,2)], {type:'application/json'});
      const u = URL.createObjectURL(b);
      const a = document.createElement('a'); a.href = u; a.download = 'site.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(u);
    });
    document.getElementById('preview-json').addEventListener('click', ()=> alert(JSON.stringify(siteData,null,2)));

    // GitHub push (optional)
    async function getSha(owner, repo, path, branch, token){
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;
      const r = await fetch(url, { headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github+json' }});
      if (r.status === 404) return null;
      if (!r.ok) throw new Error(await r.text());
      const j = await r.json(); return j.sha;
    }
    async function pushFile(owner, repo, path, branch, token, content, message){
      const base64 = btoa(unescape(encodeURIComponent(content)));
      const sha = await getSha(owner, repo, path, branch, token);
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
      const body = { message: message||'Update site content via developer.html', content: base64, branch };
      if (sha) body.sha = sha;
      const r = await fetch(url, {
        method:'PUT',
        headers:{ Authorization: 'token ' + token, Accept:'application/vnd.github+json', 'Content-Type':'application/json' },
        body: JSON.stringify(body)
      });
      return await r.json();
    }

    document.getElementById('dry-run').addEventListener('click', async ()=>{
      const owner = document.getElementById('gh-owner').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const branch = document.getElementById('gh-branch').value.trim() || 'main';
      const path = document.getElementById('gh-path').value.trim() || 'data/site.json';
      const token = document.getElementById('gh-token').value.trim();
      if (!owner || !repo || !token) { document.getElementById('gh-result').textContent = 'owner/repo/token required'; return; }
      try {
        document.getElementById('gh-result').textContent = 'Checking...';
        const sha = await getSha(owner, repo, path, branch, token);
        document.getElementById('gh-result').textContent = sha ? ('Found existing file. SHA: ' + sha) : 'No existing file (will create new).';
      } catch (e) {
        document.getElementById('gh-result').textContent = 'Error: ' + e.message;
      }
    });

    document.getElementById('push-github').addEventListener('click', async ()=>{
      const owner = document.getElementById('gh-owner').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const branch = document.getElementById('gh-branch').value.trim() || 'main';
      const path = document.getElementById('gh-path').value.trim() || 'data/site.json';
      const token = document.getElementById('gh-token').value.trim();
      if (!owner || !repo || !token) { document.getElementById('gh-result').textContent = 'owner/repo/token required'; return; }
      try {
        // Ensure latest edits captured
        siteData.title = document.getElementById('site-title').value;
        siteData.about.heading = document.getElementById('about-heading').value;
        siteData.about.content = document.getElementById('about-content').value;
        document.getElementById('gh-result').textContent = 'Pushing...';
        const res = await pushFile(owner, repo, path, branch, token, JSON.stringify(siteData,null,2), 'Update site data via developer.html');
        if (res && res.commit && res.commit.sha) document.getElementById('gh-result').textContent = 'Success. Commit: ' + res.commit.sha;
        else document.getElementById('gh-result').textContent = 'Response: ' + JSON.stringify(res);
      } catch (e) { document.getElementById('gh-result').textContent = 'Error: ' + e.message; }
    });

    loadExisting();
  </script>
</body>
</html>
