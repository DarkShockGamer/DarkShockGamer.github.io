<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <link rel="shortcut icon" type="image/png" href="/assets/logo.png">
  <title>Trident Robotics 4296</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Include JWT decode library -->
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3/build/jwt-decode.min.js"></script>

  <!-- Firebase SDKs -->
  <script type="module">
    // Import the Firebase functions you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC7k3xdqmsuYOEBBDbDfnrmuaebLaHFWZI",
      authDomain: "tridenttaskboard.firebaseapp.com",
      projectId: "tridenttaskboard",
      storageBucket: "tridenttaskboard.firebasestorage.app",
      messagingSenderId: "143400263387",
      appId: "1:143400263387:web:66ed521ae75af588e836fe",
      measurementId: "G-F12DDQCX87"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Example: Write data
    function writeExampleData() {
      set(ref(db, 'test/message'), {
        text: "Hello from Trident Robotics!"
      });
    }

    // Example: Read data
    async function readExampleData() {
      const snapshot = await get(child(ref(db), 'test/message'));
      if (snapshot.exists()) {
        console.log(snapshot.val());
      } else {
        console.log("No data available");
      }
    }

    // Test it
    writeExampleData();
    readExampleData();
  </script>
  
  <script>
  // Helper: storage key for the credential
  const G_CRED_KEY = 'g_credential_v1';

  // Toggle tasks visibility based on email allowed list/domains
  function updateTasksVisibility(email) {
    const tasksDesktop = document.getElementById("tasksLink");
    const tasksMobile = document.getElementById("tasksLinkMobile");
    if (!email) {
      if (tasksDesktop) tasksDesktop.style.display = "none";
      if (tasksMobile) tasksMobile.style.display = "none";
      return;
    }
    const allowedDomains = ["wths.net"];
    const allowedEmails = ["blackshocktrooper@gmail.com"];
    const allowed = allowedDomains.some(domain => email.endsWith(`@${domain}`)) || allowedEmails.includes(email);
    if (allowed) {
      if (tasksDesktop) tasksDesktop.style.display = "inline-block";
      if (tasksMobile) tasksMobile.style.display = "block";
    } else {
      if (tasksDesktop) tasksDesktop.style.display = "none";
      if (tasksMobile) tasksMobile.style.display = "none";
    }
  }

  // Set UI for signed-in user
  function setSignedInUI(profile, rawCredential) {
    const signInContainer = document.getElementById('googleSignIn');
    const signedContainer = document.getElementById('googleSignedIn');
    const emailSpan = document.getElementById('googleEmail');
    const avatarImg = document.getElementById('googleAvatar');

    // Hide sign-in button and show signed-in UI
    if (signInContainer) signInContainer.style.display = 'none';
    if (signedContainer) signedContainer.style.display = 'flex';

    if (emailSpan) emailSpan.textContent = profile.email || profile.name || 'Signed in';
    if (avatarImg) avatarImg.src = profile.picture || '/assets/icon.png';

    // Update tasks visibility
    updateTasksVisibility(profile.email);
  }

  // Set UI for signed-out state
  function setSignedOutUI() {
    const signInContainer = document.getElementById('googleSignIn');
    const signedContainer = document.getElementById('googleSignedIn');

    if (signInContainer) signInContainer.style.display = 'block';
    if (signedContainer) signedContainer.style.display = 'none';

    // Hide tasks link if needed
    updateTasksVisibility(null);
  }

  // Handle the credential response when user signs in
  function handleCredentialResponse(response) {
    try {
      const data = jwt_decode(response.credential);
      const email = data.email;
      // Save credential to localStorage for persistence
      localStorage.setItem(G_CRED_KEY, response.credential);
      // Update UI
      setSignedInUI(data, response.credential);
    } catch (err) {
      console.error('Error decoding credential:', err);
      alert('Sign-in failed (invalid token).');
    }
  }

  // Sign out user: remove local storage, optionally revoke and disable auto select
  function signOut() {
    const raw = localStorage.getItem(G_CRED_KEY);
    if (raw) {
      try {
        const decoded = jwt_decode(raw);
        const email = decoded.email;
        // Ask Google to revoke the credential (best-effort)
        if (google && google.accounts && google.accounts.id && email) {
          try {
            google.accounts.id.revoke(email, (done) => {
              console.log('revoke callback:', done);
            });
          } catch (e) {
            console.warn('revoke call failed', e);
          }
        }
      } catch (e) {
        // ignore decode errors
      }
    }

    // Clear stored credential and update UI
    localStorage.removeItem(G_CRED_KEY);
    if (google && google.accounts && google.accounts.id) {
      // Prevent automatic selection on next page load
      try { google.accounts.id.disableAutoSelect(); } catch(e){/* ignore */ }
    }
    setSignedOutUI();
  }

  // Initialize Google Sign-In, render button if not already signed in
  window.onload = function() {
    // Initialize the client (always do this so revoke/disableAutoSelect are available)
    google.accounts.id.initialize({
      client_id: "635936985251-tj5uq36b5altf4qmk7019r3u504mm1fs.apps.googleusercontent.com",
      callback: handleCredentialResponse,
      auto_select: false
    });

    // Wire up sign out button (exists in DOM)
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'googleSignOut') {
        signOut();
      }
    });

    // If credential saved in localStorage, restore UI
    const saved = localStorage.getItem(G_CRED_KEY);
    if (saved) {
      try {
        const data = jwt_decode(saved);
        setSignedInUI(data, saved);
        try { google.accounts.id.disableAutoSelect(); } catch(e){/* ignore */ }
      } catch (err) {
        console.warn('Stored credential invalid, clearing', err);
        localStorage.removeItem(G_CRED_KEY);
        // render sign-in button below
        google.accounts.id.renderButton(
          document.getElementById("googleSignIn"),
          { theme: "outline", size: "medium", text: "signin_with" }
        );
      }
    } else {
      // Not signed in: render the button
      google.accounts.id.renderButton(
        document.getElementById("googleSignIn"),
        { theme: "outline", size: "medium", text: "signin_with" }
      );
      // optional: prompt can be used to show One Tap - leaving commented out if undesired
      // google.accounts.id.prompt();
    }
  };
  </script>

  <style>
    /* ====== Colors ====== */
    :root {
      --dark-blue: #0a1f44;
      --medium-blue: #1f4d7a;
      --light-blue: #4fa3d1;
      --white: #f4f8fb;
      --accent: #ffd700;
    }

    @font-face {
      font-family: 'Ethnocentric';
      src: url('/assets/fonts/Ethnocentric Rg.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }

    /* ====== Global Styles ====== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(-45deg, #050c24, #0a1f44);
      color: var(--white);
    }
    a { text-decoration: none; color: inherit; }

    /* Global image reset (content images) */
    img { display: block; max-width: 100%; height: auto; }

    /* IMPORTANT: Do not let the global img rule distort the Google Sign-In button */
    #googleSignIn img, #googleSignIn svg {
      display: inline-block !important;
      max-width: none !important;
      width: auto !important;
      height: auto !important;
      vertical-align: middle !important;
    }
    /* Keep the Google sign-in container compact */
    #googleSignIn { display: inline-block; }

    @media (max-width: 768px) {
      /* Avoid stretching the Google sign-in button on mobile */
      .nav-login #googleSignIn { width: auto; }
    }

    /* ====== Header ====== */
    header {
      position: relative;
      height: 70vh;
      min-height: 450px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: var(--white);
      overflow: hidden;
      border-bottom: 3px solid var(--light-blue);
    }
    header img {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      filter: brightness(0.55);
      z-index: -1;
    }
    header h1 {
      font-family: 'Ethnocentric', sans-serif;
      font-size: 2.8rem;
      font-weight: 800;
      letter-spacing: 1px;
      margin-bottom: 0.8rem;
      text-shadow: 0 4px 12px rgba(0,0,0,0.6);
      animation: fadeInUp 1s ease forwards;
    }
    header p {
      font-size: 1.3rem;
      font-weight: 400;
      color: #e0f2ff;
      opacity: 0.9;
      animation: fadeInUp 1.4s ease forwards;
    }
    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(25px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* ====== Google Login in Nav ===== */
    .nav-login { justify-self: end; display: flex; align-items: center; gap: .5rem; }
    .nav-login .google-btn {
      display: flex;
      align-items: center;
      background: var(--medium-blue);
      color: var(--white);
      border: 2px solid var(--accent);
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      font-weight: bold;
      font-size: 0.9rem;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
    }
    .nav-login .google-btn:hover {
      background: var(--light-blue);
      color: var(--dark-blue);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    }
    .nav-login .google-btn img {
      height: 18px;
      margin-right: 6px;
    }

    /* small inline signed-in UI */
    #googleSignedIn {
      display: none;
      align-items: center;
      gap: 0.5rem;
    }
    #googleSignedIn img { height: 28px; width: 28px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,255,255,0.08); }
    #googleEmail { font-weight: 600; font-size: 0.95rem; color: var(--white); max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* ====== Responsive adjustments ===== */
    @media (max-width: 768px) {
      /* Adjust layout order so sign-in appears left of hamburger */
      .nav-login {
        order: 1;
        margin: 0.5rem 0.5rem 0.5rem auto;
      }

      .nav-toggle { order: 2; }

      .nav-login .google-btn {
        width: 90%;
        justify-content: center;
      }
    }

    /* ====== Navigation ===== */
    .site-nav {
      background: var(--medium-blue);
      display: flex;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 3px solid var(--light-blue);
      box-shadow: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .nav-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      padding: 0.6rem 1rem;
      width: 100%;
    }
    .nav-logo { justify-self: start; }
    .nav-logo img { height: 50px; width: auto; }
    .nav-logo img:hover { filter: drop-shadow(0 0 6px var(--accent)); }

    .nav-links {
      display: flex;
      justify-content: center;
      gap: 1rem;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    .nav-links a {
      font-weight: bold;
      text-transform: uppercase;
      padding: 0.25rem 0.5rem;
      border-bottom: 2px solid transparent;
      transition: 0.25s;
    }
    .nav-links a:hover {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    .nav-toggle {
      justify-self: end;
      display: none;
      width: 40px;
      height: 40px;
      background: none;
      border: none;
      cursor: pointer;
      position: relative;
      z-index: 1002;
    }
    .nav-toggle .hamburger,
    .nav-toggle .hamburger::before,
    .nav-toggle .hamburger::after {
      display: block;
      width: 22px;
      height: 2px;
      background: var(--white);
      border-radius: 2px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translateX(-50%);
      content: "";
    }
    .nav-toggle .hamburger::before { top: -7px; }
    .nav-toggle .hamburger::after { top: 7px; }

    /* Hide mobile dropdown on desktop */
    .nav-links-mobile {
      display: none;
      flex-direction: column;
      background: var(--medium-blue);
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      border-top: 3px solid var(--light-blue);
      z-index: 1001;
    }
    .nav-links-mobile a {
      padding: 0.8rem 0;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    @media (max-width: 768px) {
      .nav-links-mobile { display: none; /* hidden by default */ }
      .nav-links-mobile.show { display: flex; /* show when toggled */ }
    }

    /* ====== Sections ====== */
    section { padding: 3rem 1.5rem; max-width: 1100px; margin: auto; }
    h2 {
      color: var(--light-blue);
      font-size: 2rem;
      border-bottom: 3px solid var(--light-blue);
      display: inline-block;
      margin-bottom: 1.5rem;
      padding-bottom: 0.25rem;
    }
    p, li { font-size: 1.1rem; margin-bottom: 1rem; }
    ul { list-style: none; padding-left: 0; }

    /* ====== Team Grid ====== */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      max-width: 1000px;
      margin: 0 auto;
      gap: 2rem;
      justify-items: center;
    }

    .card {
      background: linear-gradient(135deg, #0a1f44, #1f4d7a, #4fa3d1);
      padding: 1.5rem;
      border-radius: 15px;
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 280px;
      color: var(--white);
      position: relative;
    }

    .card:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,0,0,0.35); }

    .card-icon {
      position: absolute;
      top: 10px;
      left: 10px;
      color: var(--light-blue);
      width: 28px;
      height: 28px;
      transition: color 0.3s, transform 0.3s;
    }

    .card-icon:hover { color: var(--accent); transform: scale(1.15); }

    .card-icon svg { width: 100%; height: 100%; }

    #team-photo img {
      max-width: 900px;
      width: 100%;
      margin: 2rem auto 0;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    }

    /* ====== Footer ===== */
    footer {
      background: var(--medium-blue);
      color: #dcdcdc;
      text-align: center;
      padding: 1rem 1.5rem;
      font-size: 0.8rem !important;
      line-height: 1.4;
      border-top: 3px solid var(--light-blue);
      margin: 0 auto;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
    }

    footer p { margin: 0.25rem 0; font-weight: 400; font-size: 0.8rem; }

    /* ====== Timeline ====== */
    .timeline {
      position: relative;
      max-width: 800px;
      margin: 3rem auto;
      padding: 0 1rem;
      z-index: 1;
    }

    .timeline::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--light-blue), var(--medium-blue));
      border-radius: 2px;
      opacity: 0.6;
    }

    .timeline-item {
      position: relative;
      margin: 2.5rem 0;
      width: 50%;
      padding: 1rem 2rem;
      background: rgba(10, 31, 68, 0.85);
      border: 2px solid var(--light-blue);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 2;
      outline: none;
    }

    .timeline-item:nth-child(odd) {
      left: 0;
      transform-origin: right center;
    }

    .timeline-item:nth-child(even) {
      left: 50%;
      transform-origin: left center;
    }

    .timeline-item:hover {
      transform: scale(1.03);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }

    .timeline-item::before {
      content: "";
      position: absolute;
      top: 20px;
      width: 18px;
      height: 18px;
      border: 3px solid var(--accent);
      background: var(--medium-blue);
      border-radius: 50%;
      box-shadow: 0 0 12px var(--accent);
      z-index: 2;
    }

    .timeline-item:nth-child(odd)::before { right: -11px; }

    .timeline-item:nth-child(even)::before { left: -11px; }

    .timeline-date {
      font-weight: 700;
      color: var(--accent);
      font-size: 1.05rem;
      margin-bottom: 0.4rem;
    }

    .timeline-text {
      color: var(--white);
      font-size: 1.05rem;
      opacity: 0.95;
    }

    /* Hover bubble for more info (and tap on mobile) */
    .timeline-item:hover,
    .timeline-item.open,
    .timeline-item:focus-within {
      z-index: 10000;
    }

    .timeline-item:hover::after,
    .timeline-item.open::after,
    .timeline-item:focus-within::after {
      content: attr(data-info);
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translate(-50%, 10px);
      background: var(--light-blue);
      color: var(--white);
      padding: 0.8rem 1rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      font-size: 0.9rem;
      width: 220px;
      text-align: center;
      animation: fadeIn 0.3s ease forwards;
      z-index: 9999 !important; /* fixed invalid !important placement */
      white-space: normal;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, 20px); }
      to   { opacity: 1; transform: translate(-50%, 10px); }
    }

    /* ====== Mobile Timeline ====== */
    @media (max-width: 768px) {
      .timeline::before {
        left: 15px;
      }

      .timeline-item {
        width: 100%;
        left: 0 !important;
        margin-left: 2rem;
      }

      .timeline-item::before {
        left: -28px;
      }

      .timeline-item:hover::after,
      .timeline-item.open::after,
      .timeline-item:focus-within::after {
        left: 50% !important;
        transform: translateX(-50%) translateY(10px) !important;
        width: 90vw;
        max-width: 320px;
        box-sizing: border-box;
        z-index: 9999 !important;
      }
    }

  </style>
</head>
<body>

  <!-- ====== Header ====== -->
  <header>
    <img src="assets/group.png" alt="Team Group Photo">
    <h1>Trident Robotics 4296</h1>
    <p>Engineering Innovation | Driving the Future</p>
  </header>

  <!-- ====== Navigation ====== -->
  <nav class="site-nav">
    <div class="nav-inner">
      <a class="nav-logo" href="#">
        <img src="assets/icon.png" alt="Trident Robotics Logo">
      </a>

      <div class="nav-links" id="navLinks">
        <a href="#about">About</a>
        <a href="#team">Team</a>
        <a href="#updates">Updates</a>
        <a href="#contact">Contact</a>
        <a href="sponsors.html">Sponsors</a>
        <!-- Tasks link will appear here dynamically -->
        <a href="tasks.html" id="tasksLink" style="display:none;">Tasks</a>
      </div>

      <!-- Mobile-only nav links -->
      <div class="nav-links-mobile" id="navLinksMobile">
        <a href="#about">About</a>
        <a href="#team">Team</a>
        <a href="#updates">Updates</a>
        <a href="#contact">Contact</a>
        <a href="sponsors.html">Sponsors</a>
        <a href="tasks.html" id="tasksLinkMobile" style="display:none;">Tasks</a>
      </div>

      <div class="nav-login">
        <!-- Container where Google renders Sign-in button -->
        <div id="googleSignIn"></div>

        <!-- Signed-in UI (hidden by default; shown when signed in) -->
        <div id="googleSignedIn" aria-live="polite">
          <img id="googleAvatar" src="" alt="Avatar">
          <span id="googleEmail">Not signed in</span>
          <button id="googleSignOut" class="google-btn" title="Sign out">Sign out</button>
        </div>
      </div>

      <button class="nav-toggle" aria-expanded="false" aria-label="Toggle navigation">
        <span class="hamburger"></span>
      </button>
    </div>
  </nav>

  <!-- ====== About Section ====== -->
  <section id="about">
    <h2>About Us</h2>
    <p>
      We are <strong>Trident Robotics Team 4296</strong>, a student-led high school robotics team dedicated to 
      designing, building, and competing with innovative robots. Our mission is to spark curiosity, 
      foster collaboration, and push the boundaries of technology through hands-on engineering experiences.  
    </p>
    <p>
      Founded in 2012, our team has grown into a community where students gain real-world skills in 
      <em>design, mechanical engineering, electrical systems, and programming</em>. We don’t just build robots—
      we build future engineers, problem-solvers, and leaders.  
    </p>
    <p>
      Every season, our team comes together with one goal: to turn imagination into innovation and 
      prove that when teamwork meets technology, the possibilities are endless.
    </p>
  </section>

  <!-- ====== Team Section ====== -->
  <section id="team">
    <h2>Meet the Team</h2>
    <div class="team-grid">
      <!-- populated dynamically from data/site.json -->
    </div>
  </section>

  <!-- ====== Extra Image Section ====== -->
  <section id="team-photo">
    <img src="assets/Shark-Photo.png" alt="Team Members">
  </section>

  <!-- ====== Updates Section ====== -->
  <section id="updates">
    <h2>Team Updates</h2>
    <div class="timeline">
      <!-- populated dynamically from data/site.json -->
    </div>
  </section>

  <!-- ====== Contact Section ====== -->
  <section id="contact">
    <h2>Contact Us</h2>
    <div class="contact-links">
      <a href="mailto:sveselack@wths.net" target="_blank" class="contact-icon" aria-label="Email">
        <!-- Mail Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path fill="currentColor" d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2m0 4-8 5-8-5V6l8 5 8-5z"/>
        </svg>
      </a>
      <a href="https://www.youtube.com/c/WarrenRobotics" target="_blank" class="contact-icon" aria-label="YouTube">
        <!-- YouTube Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M10 15V9l5 3m9-3c0-2.21-1.79-4-4-4H5c-2.21 
        0-4 1.79-4 4v6c0 2.21 1.79 4 4 4h15c2.21 0 4-1.79 4-4V9z"/></svg>
      </a>
      <a href="https://www.instagram.com/trident_robotics" target="_blank" class="contact-icon" aria-label="Instagram">
        <!-- Instagram Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 
        2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm10 2a3 3 0 0 1 3 3v10a3 3 
        0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10zm-5 3a5 5 0 1 0 0 
        10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-2a1.5 
        1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/></svg>
      </a>
      <a href="https://www.facebook.com/Team4296/" target="_blank" class="contact-icon" aria-label="Facebook">
        <!-- Facebook Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-3h2v-2.3c0-2 
        1.2-3.1 3-3.1.9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.6-1.3 
        1.2V12h2.3l-.4 3h-1.9v7A10 10 0 0 0 22 12"/></svg>
      </a>
    </div>
  </section>

  <style>
    .contact-links {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .contact-icon {
      color: var(--light-blue);
      font-size: 2.2rem;
      display: inline-flex;
      transition: color 0.3s, transform 0.3s;
    }
    .contact-icon:hover {
      color: var(--accent);
      transform: scale(1.15);
    }
    .contact-icon svg {
      width: 40px;
      height: 40px;
    }
  </style>

  <!-- ====== Footer ====== -->
  <footer>
    <p>© 2025 Trident Robotics 4296. All rights reserved.</p>
    <p>
      This website and its content are independently created and maintained by Lucas Palmquist and members of Trident Robotics 4296. 
      Trident Robotics, the Trident Robotics logo, and all related materials are intellectual property of the team 
      and/or Warren Township High School.
    </p>
    <p>
      All media, graphics, and interactive content are developed for educational and community engagement purposes.
    </p>
  </footer>

  <script src="assets/js/main.js"></script>
  <script>
    // ====== Dynamic Content from /data/site.json ======

    function escapeHtml(s) {
      return String(s || '').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    async function getSiteData() {
      try {
        const r = await fetch('/data/site.json?_=' + Date.now());
        if (!r.ok) throw new Error('Fetch failed: ' + r.status);
        return await r.json();
      } catch (e) {
        console.warn('Could not load /data/site.json, using fallback:', e);
        return null;
      }
    }

    function mergeLeadsIntoTeams(site) {
      if (!site || !site.leadership) return;
      const teams = site.leadership.teams || [];
      const leads = site.leadership.leads || [];
      leads.forEach(lead => {
        const name = typeof lead === 'string' ? lead : (lead && lead.name) || '';
        const teamName = typeof lead === 'string' ? '' : (lead && lead.team) || '';
        if (!name || !teamName) return;
        const t = teams.find(x => x.team === teamName);
        if (!t) return;
        if (!Array.isArray(t.members)) t.members = [];
        if (!t.members.includes(name)) t.members.push(name);
      });
    }

    function iconForTeam(teamName) {
      // minimal: provide inline SVGs per team key
      const map = {
        'Design Team': `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            role="img" aria-label="Design Team wireframe cube"
            fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4a2 2 0 0 0 1-1.73z"/>
          <path d="M3.27 7L12 12l8.73-5"/>
          <path d="M12 22V12"/>
        </svg>
        `,
        'Mechanical Team': `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
           role="img" aria-label="Mechanical Team gear"
           fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
          <!-- outer ring -->
          <circle cx="12" cy="12" r="8"/>
          <!-- hub -->
          <circle cx="12" cy="12" r="3.25"/>
          <!-- teeth (short ticks rotated around center) -->
          <g>
            <line x1="12" y1="1.5" x2="12" y2="4"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(45 12 12)"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(90 12 12)"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(135 12 12)"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(180 12 12)"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(225 12 12)"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(270 12 12)"/>
            <line x1="12" y1="1.5" x2="12" y2="4" transform="rotate(315 12 12)"/>
          </g>
        </svg>
        `,
        'Electrical Team': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2 3 14h7v8l11-14h-8V2z"/></svg>`,
        'Programming Team': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="m8.59 16.59 4.58-4.59-4.58-4.59L10 6l6 6-6 6-1.41-1.41z"/></svg>`,
        'Drive Team': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" role="img" aria-label="Drive Team Controller"><path fill="currentColor" d="M7,6H17A4,4 0 0,1 21,10V14A4,4 0 0,1 17,18H16A3,3 0 0,1 13,15H11A3,3 0 0,1 8,18H7A4,4 0 0,1 3,14V10A4,4 0 0,1 7,6M7,9V11H5V13H7V15H9V13H11V11H9V9H7M15.5,9A1.5,1.5 0 1,0 17,10.5A1.5,1.5 0 0,0 15.5,9Z"/></svg>`,
      };
      return map[teamName] || map['Design Team'];
    }

    function renderTeams(site) {
      const grid = document.querySelector('.team-grid');
      const fallbackTeamData = [
        { team: "Design Team", role: "Lead", members: ["Alice Smith", "Bob Johnson"] },
        { team: "Mechanical Team", role: "Lead", members: ["Charlie Brown", "Dana White"] },
        { team: "Electrical Team", role: "Lead", members: ["Evan Lee", "Fiona Green"] },
        { team: "Programming Team", role: "Lead", members: ["George Hall", "Hannah King"] },
        { team: "Drive Team", role: "Driver", members: ["Ian Scott", "Jane Adams"] }
      ];
      let teams = (site && site.leadership && Array.isArray(site.leadership.teams) && site.leadership.teams.length)
        ? JSON.parse(JSON.stringify(site.leadership.teams))
        : fallbackTeamData;

      // Merge leads into teams so developer.html -> leads shows up here
      if (site && site.leadership) {
        const temp = { leadership: { teams, leads: site.leadership.leads || [] } };
        mergeLeadsIntoTeams(temp);
        teams = temp.leadership.teams;
      }

      const cards = teams.map(t => {
        const icon = iconForTeam(t.team);
        const role = escapeHtml(t.role || 'Lead');
        const members = Array.isArray(t.members) ? t.members : [];
        const membersHtml = members.length
          ? members.map(m => `<p><strong>${role}:</strong> ${escapeHtml(m)}</p>`).join('')
          : `<p><em>No ${role.toLowerCase()}s yet</em></p>`;
        return `
          <div class="card">
            <div class="card-icon">${icon}</div>
            <h3>${escapeHtml(t.team)}</h3>
            ${membersHtml}
          </div>
        `;
      }).join('');

      grid.innerHTML = cards;
    }

    function renderTimeline(site) {
      const tl = document.querySelector('#updates .timeline');
      if (!tl) return;
      const items = (site && Array.isArray(site.timeline) && site.timeline.length) ? site.timeline : null;
      if (!items) { return; }
      tl.innerHTML = items.map(ev => {
        const date = escapeHtml(ev.date || ev.year || '');
        const title = escapeHtml(ev.title || '');
        const desc = (ev.description || '').replace(/"/g, '&quot;');
        return `<div class="timeline-item" tabindex="0" role="button" aria-expanded="false" data-info="${desc}">
                  <p class="timeline-date">${date}</p>
                  <p class="timeline-text">${title}</p>
                </div>`;
      }).join('');

      enhanceTimelineInteractivity();
    }

    // Mobile-friendly timeline interactivity
    function enhanceTimelineInteractivity() {
      const tl = document.querySelector('#updates .timeline');
      if (!tl) return;

      // Make items focusable (for :focus-within and keyboard users)
      tl.querySelectorAll('.timeline-item').forEach(item => {
        if (!item.hasAttribute('tabindex')) item.setAttribute('tabindex', '0');
      });

      // Toggle open on click/tap; ensure only one is open
      document.addEventListener('click', (e) => {
        const item = e.target.closest('.timeline-item');
        const timelineRoot = e.target.closest('.timeline');

        // Click outside any timeline item: close all
        if (!timelineRoot) {
          document.querySelectorAll('.timeline-item.open').forEach(i => {
            i.classList.remove('open');
            i.setAttribute('aria-expanded', 'false');
          });
          return;
        }

        // Inside timeline: toggle the clicked one, close others
        if (item) {
          const alreadyOpen = item.classList.contains('open');
          timelineRoot.querySelectorAll('.timeline-item.open').forEach(i => {
            i.classList.remove('open');
            i.setAttribute('aria-expanded', 'false');
          });
          if (!alreadyOpen) {
            item.classList.add('open');
            item.setAttribute('aria-expanded', 'true');
          }
        }
      }, { passive: true });

      // Close popups on Escape + keyboard toggle
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          document.querySelectorAll('.timeline-item.open').forEach(i => {
            i.classList.remove('open');
            i.setAttribute('aria-expanded', 'false');
          });
        }
        if ((e.key === 'Enter' || e.key === ' ') && document.activeElement?.classList?.contains('timeline-item')) {
          e.preventDefault();
          const item = document.activeElement;
          const tlRoot = item.closest('.timeline');
          const already = item.classList.contains('open');
          tlRoot.querySelectorAll('.timeline-item.open').forEach(i => {
            i.classList.remove('open');
            i.setAttribute('aria-expanded', 'false');
          });
          if (!already) {
            item.classList.add('open');
            item.setAttribute('aria-expanded', 'true');
          }
        }
      });
    }

    (async function initDynamicContent(){
      const site = await getSiteData();
      if (site) {
        // About content (allowed HTML from site.json)
        if (site.about) {
          const aboutSection = document.getElementById('about');
          const heading = escapeHtml(site.about.heading || 'About Us');
          const contentHtml = (site.about.content || '').trim();
          if (contentHtml) {
            aboutSection.innerHTML = `<h2>${heading}</h2>` + contentHtml;
          }
        }
        // Team and timeline
        renderTeams(site);
        renderTimeline(site);
      }
    })();
  </script>

  <!-- Media overrides from site.json: header image and team photo -->
  <script>
  (async function(){
    try {
      const r = await fetch('/data/site.json?_=' + Date.now());
      if (!r.ok) return;
      const site = await r.json();
      const media = site.media || {};
      const headerImg = document.querySelector('header img');
      if (headerImg && media.indexHeader) headerImg.src = media.indexHeader;
      const teamPhoto = document.querySelector('#team-photo img');
      if (teamPhoto && media.indexPhoto) teamPhoto.src = media.indexPhoto;
    } catch(e) { /* ignore */ }
  })();
  </script>
</body>
</html>
