<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trident Robotics Admin Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; background: #f0f2f5; padding: 2rem; }
h1 { color: #0a1f44; }
section { background: #fff; padding: 1rem 2rem; margin-bottom: 2rem; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
textarea, input[type="text"] { width: 100%; margin: 0.5rem 0; padding: 0.5rem; border-radius: 5px; border: 1px solid #ccc; font-family: monospace; }
button { padding: 0.5rem 1rem; margin: 0.5rem 0; background: #1f4d7a; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
button:hover { background: #4fa3d1; }
h3 { margin-top: 1rem; color: #1f4d7a; }
hr { border: none; border-top: 1px solid #eee; margin: 0.5rem 0; }
</style>
</head>
<body>

<h1>Trident Robotics Content Editor</h1>

<section id="about-editor">
  <h2>About Us Section</h2>
  <div id="about-list"></div>
  <button onclick="addAboutParagraph()">Add Paragraph</button>
</section>

<section id="team-editor">
  <h2>Team Leads</h2>
  <div id="team-list"></div>
  <button onclick="addTeam()">Add Team</button>
</section>

<section id="timeline-editor">
  <h2>Timeline Events</h2>
  <div id="timeline-list"></div>
  <button onclick="addTimelineEvent()">Add Event</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, addDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "AIzaSyC7k3xdqmsuYOEBBDbDfnrmuaebLaHFWZI",
  authDomain: "tridenttaskboard.firebaseapp.com",
  projectId: "tridenttaskboard",
  storageBucket: "tridenttaskboard.firebasestorage.app",
  messagingSenderId: "143400263387",
  appId: "1:143400263387:web:66ed521ae75af588e836fe",
  measurementId: "G-F12DDQCX87"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== Firestore collections =====
const aboutCol = collection(db, "about");
const teamCol = collection(db, "team");
const timelineCol = collection(db, "timeline");

// ===== Local state =====
let aboutContent = [];
let teamData = [];
let timelineEvents = [];

// ===== Render Functions =====
function renderAbout() {
  const container = document.getElementById('about-list');
  container.innerHTML = '';
  aboutContent.forEach((p, i) => {
    const textarea = document.createElement('textarea');
    textarea.value = p.text || "";
    textarea.oninput = async e => {
      aboutContent[i].text = e.target.value;
      await setDoc(doc(db, "about", p.id), { text: e.target.value });
    };
    container.appendChild(textarea);
    const delBtn = document.createElement('button');
    delBtn.textContent = "Delete Paragraph";
    delBtn.onclick = async () => { await deleteDoc(doc(db,"about",p.id)); }
    container.appendChild(delBtn);
  });
}

function renderTeam() {
  const container = document.getElementById('team-list');
  container.innerHTML = '';
  teamData.forEach((t, i) => {
    const div = document.createElement('div');
    div.innerHTML = `<h3>${t.team} (${t.role})</h3>` +
      t.members.map((m,j) => `<input type="text" value="${m}" placeholder="Member" oninput="updateTeamMember('${t.id}', ${j}, this.value)">`).join('');
    const delBtn = document.createElement('button');
    delBtn.textContent = "Delete Team";
    delBtn.onclick = async () => { await deleteDoc(doc(db,"team",t.id)); }
    div.appendChild(delBtn);
    container.appendChild(div);
  });
}

function renderTimeline() {
  const container = document.getElementById('timeline-list');
  container.innerHTML = '';
  timelineEvents.forEach((e, i) => {
    const div = document.createElement('div');
    div.innerHTML = `
      <input type="text" value="${e.date}" placeholder="Date" oninput="updateTimeline('${e.id}','date',this.value)">
      <input type="text" value="${e.text}" placeholder="Title" oninput="updateTimeline('${e.id}','text',this.value)">
      <textarea placeholder="Info" oninput="updateTimeline('${e.id}','info',this.value)">${e.info}</textarea>
    `;
    const delBtn = document.createElement('button');
    delBtn.textContent = "Delete Event";
    delBtn.onclick = async () => { await deleteDoc(doc(db,"timeline",e.id)); }
    div.appendChild(delBtn);
    div.appendChild(document.createElement('hr'));
    container.appendChild(div);
  });
}

// ===== Update Functions =====
async function updateTeamMember(teamId, idx, value) {
  const team = teamData.find(t => t.id === teamId);
  team.members[idx] = value;
  await setDoc(doc(db, "team", teamId), team);
}

async function updateTimeline(id, field, value) {
  const event = timelineEvents.find(e => e.id === id);
  event[field] = value;
  await setDoc(doc(db, "timeline", id), event);
}

// ===== Add New =====
async function addAboutParagraph() { await addDoc(aboutCol, { text: "" }); }
async function addTeam() { await addDoc(teamCol, { team:"New Team", role:"Lead", members:[""] }); }
async function addTimelineEvent() { await addDoc(timelineCol, { date:"", text:"", info:"" }); }

// ===== Real-time listeners =====
onSnapshot(aboutCol, snapshot => {
  aboutContent = [];
  snapshot.forEach(doc => aboutContent.push({id: doc.id, text: doc.data().text}));
  renderAbout();
});

onSnapshot(teamCol, snapshot => {
  teamData = [];
  snapshot.forEach(doc => teamData.push({id: doc.id, ...doc.data()}));
  renderTeam();
});

onSnapshot(timelineCol, snapshot => {
  timelineEvents = [];
  snapshot.forEach(doc => timelineEvents.push({id: doc.id, ...doc.data()}));
  renderTimeline();
});

</script>
</body>
</html>
