<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <title>Developer - Edit Site Content</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Extra polish to complement Tailwind */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #e0f2fe;      /* sky-100 */
      color: #0369a1;           /* sky-700 */
      padding: 4px 10px;
      border-radius: 9999px;
      margin: 4px 6px 0 0;
      border: 1px solid #bae6fd;/* sky-200 */
      font-size: 0.85rem;
      line-height: 1.2rem;
      white-space: nowrap;
    }
    .pill button {
      margin: 0 0 0 4px;
      padding: 2px 8px;
      line-height: 1;
      border: 1px solid rgba(2,132,199,0.25);
      border-radius: 9999px;
      color: #0369a1;
      background: white;
    }
    .pill select {
      margin: 0;
      padding: 2px 6px;
      border: 1px solid #93c5fd; /* sky-300 */
      border-radius: 8px;
      background: white;
      color: #0369a1;
    }
    .muted { color: #64748b; } /* slate-500 */
    .timeline-entry {
      background: white;
      border: 1px solid #e2e8f0; /* slate-200 */
      border-radius: 0.75rem;
      padding: 0.75rem;
      box-shadow: 0 1px 1px rgba(2, 6, 23, 0.04);
    }
    .timeline-entry:hover {
      box-shadow: 0 6px 16px rgba(2,132,199,0.12);
      border-color: #93c5fd; /* sky-300 */
      transform: translateY(-1px);
      transition: box-shadow 150ms, border-color 150ms, transform 150ms;
    }
    textarea { min-height: 120px; font-family: inherit; }

    /* Dark mode (system preference) */
    @media (prefers-color-scheme: dark) {
      html, body { color-scheme: dark; }
      body { color: #e5e7eb; } /* slate-200 */

      .muted { color: #94a3b8 !important; } /* slate-400 */

      .pill {
        background: #0c4a6e !important; /* sky-900-ish */
        color: #e0f2fe !important;      /* sky-100 */
        border-color: #075985 !important; /* sky-700 */
      }
      .pill button {
        background: #0b1220 !important;
        color: #e0f2fe !important;
        border-color: #075985 !important;
      }
      .pill select {
        background: #0b1220 !important;
        color: #e5e7eb !important;
        border-color: #0ea5e9 !important;
      }

      .timeline-entry {
        background: #0f172a !important; /* slate-900 */
        border-color: #1f2937 !important; /* slate-800 */
        box-shadow: 0 1px 1px rgba(2, 6, 23, 0.6);
      }
      .timeline-entry:hover {
        border-color: #0ea5e9 !important; /* sky-500 */
        box-shadow: 0 6px 16px rgba(14,165,233,0.18);
      }

      /* Inputs and selects */
      input[type="text"],
      input[type="password"],
      input[type="date"],
      input:not([type]),
      select,
      textarea {
        background: #0b1220 !important;  /* near slate-950 */
        color: #e5e7eb !important;
        border-color: #334155 !important; /* slate-600 */
      }
      input::placeholder { color: #94a3b8 !important; }

      /* Generic border buttons */
      button.border {
        border-color: #374151 !important; /* slate-700 */
        color: #e5e7eb !important;
      }
      button.border:hover {
        background: #1f2937 !important; /* slate-800 */
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 to-white dark:from-slate-900 dark:to-slate-950 font-sans text-slate-800 dark:text-slate-200">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-4">
    <div class="flex items-center gap-3">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-8 w-8"/>
      <div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-sky-800 dark:text-sky-300 leading-snug">Developer Editor</h1>
        <p class="text-sm text-sky-600 dark:text-sky-400">Edit site content and download or push the data file</p>
      </div>
    </div>
    <p class="muted mt-2">Pushing directly requires a GitHub Personal Access Token with repo write permissions. You can also download the file and commit via GitHub.</p>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-16 space-y-6">
    <!-- Site Content -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200 mb-3">Site Content</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="col-span-1">
          <label for="site-title" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Site Title</label>
          <input id="site-title" type="text" placeholder="Site title"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
        </div>
        <div class="col-span-1">
          <label for="about-heading" class="block text-sm font-medium text-slate-700 dark:text-slate-300">About Heading</label>
          <input id="about-heading" type="text" placeholder="About heading"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
        </div>
      </div>

      <div class="mt-4">
        <label for="about-content" class="block text-sm font-medium text-slate-700 dark:text-slate-300">About Content (HTML allowed)</label>
        <textarea id="about-content" placeholder="<p>About text...</p>"
                  class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500"></textarea>
      </div>
    </section>

    <!-- Timeline -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Timeline</h2>
        <button id="add-timeline"
                class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">+ Add Timeline Event</button>
      </div>
      <div id="timeline-list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <!-- Leadership -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Leadership</h2>

      <!-- Leads -->
      <div class="mt-3">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Leads</label>
        <div id="leads-list" class="mt-2"></div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
          <input id="new-lead" type="text" placeholder="Add lead name"
                 class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
          <select id="new-lead-team" aria-label="Lead team"
                  class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:focus:ring-sky-700"></select>
          <button id="add-lead"
                  class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add</button>
        </div>
      </div>

      <!-- Drivers -->
      <div class="mt-6">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Drivers</label>
        <div id="drivers-list" class="mt-2"></div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-[1fr_auto] gap-2">
          <input id="new-driver" type="text" placeholder="Add driver name"
                 class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200 dark:placeholder-slate-500">
          <button id="add-driver"
                  class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add</button>
        </div>
      </div>
    </section>

    <!-- Media Manager -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Media Manager</h2>
      <p class="muted mt-1">
        Upload images directly to this repo (via your PAT below) and set which images appear on the site.
        <span class="ml-1 text-[0.8rem] text-amber-600 dark:text-amber-400">Note: Uploading commits the image file, but the site.json reference isn’t saved until you click “Push to GitHub”.</span>
      </p>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Index Header Image URL</label>
          <div class="flex gap-2">
            <input id="media-indexHeader" type="text" placeholder="/assets/group.png" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
            <button id="btn-upload-indexHeader" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload & Set</button>
            <input id="file-indexHeader" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-indexHeader" alt="Preview" class="mt-2 max-h-36 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Index Team Photo URL</label>
          <div class="flex gap-2">
            <input id="media-indexPhoto" type="text" placeholder="/assets/Shark-Photo.png" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
            <button id="btn-upload-indexPhoto" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload & Set</button>
            <input id="file-indexPhoto" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-indexPhoto" alt="Preview" class="mt-2 max-h-36 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Sponsors Header Image URL</label>
          <div class="flex gap-2">
            <input id="media-sponsorsHeader" type="text" placeholder="/assets/group.png" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
            <button id="btn-upload-sponsorsHeader" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload & Set</button>
            <input id="file-sponsorsHeader" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-sponsorsHeader" alt="Preview" class="mt-2 max-h-36 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Upload Destination Directory</label>
          <input id="media-dest-dir" type="text" value="assets/uploads" class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
          <p class="text-xs muted">Relative to repo root. Default: assets/uploads</p>
        </div>
      </div>

      <div class="mt-6">
        <h3 class="text-md font-semibold text-slate-700 dark:text-slate-200 mb-2">Competition Moments Gallery</h3>

        <div class="flex flex-wrap items-center gap-2 mb-3">
          <input id="new-competition-url" type="text" placeholder="https://... or /assets/uploads/your-image.png" class="flex-1 rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
          <button id="add-competition-url" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">Add URL</button>
          <button id="btn-upload-competition" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload & Add</button>
          <input id="file-competition" type="file" accept="image/*" multiple class="hidden">
        </div>

        <div id="media-competition-list" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
      </div>

      <pre id="media-result" class="muted mt-3 whitespace-pre-wrap text-sm"></pre>
    </section>

    <!-- Sponsors Manager -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Sponsors Manager</h2>
      <p class="muted mt-1">
        Add sponsors shown on sponsors.html. Upload a logo, set the sponsor name (and optional link), reorder, or remove.
        <span class="ml-1 text-[0.8rem] text-amber-600 dark:text-amber-400">Note: Uploaded logo files are committed immediately, but changes to the sponsors list are saved when you click “Push to GitHub”.</span>
      </p>

      <!-- Add sponsor form -->
      <div class="mt-4 grid grid-cols-1 lg:grid-cols-[1fr_1fr] gap-4">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Sponsor Name</label>
          <input id="new-sponsor-name" type="text" placeholder="Sponsor name (e.g., Baxter)"
                 class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Optional Link URL</label>
          <input id="new-sponsor-link" type="text" placeholder="https://example.com (optional)"
                 class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Logo URL</label>
          <div class="flex gap-2">
            <input id="new-sponsor-logo" type="text" placeholder="/assets/uploads/logo.png or https://..."
                   class="w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
            <button id="btn-upload-sponsor-logo" class="border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-3">Upload Logo</button>
            <input id="file-sponsor-logo" type="file" accept="image/*" class="hidden">
          </div>
          <img id="preview-sponsor-logo" alt="Logo preview" class="mt-2 max-h-24 rounded-md border border-slate-200 dark:border-slate-700">
        </div>

        <div class="flex items-end">
          <button id="add-sponsor" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm w-full">
            + Add Sponsor
          </button>
        </div>
      </div>

      <!-- Existing sponsors list -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4" id="sponsors-list"></div>
    </section>

    <!-- Data Actions -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <h2 class="text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2">Data Actions</h2>
      <div class="flex flex-wrap gap-2">
        <button id="download-json" class="border border-slate-300 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800 px-4 py-2 rounded-md font-semibold shadow-sm">
          Download data/site.json
        </button>
        <button id="preview-json" class="border border-slate-300 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800 px-4 py-2 rounded-md font-semibold shadow-sm">
          Preview JSON
        </button>
      </div>
    </section>

    <!-- GitHub Push -->
    <section class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 ring-1 ring-slate-100 dark:bg-slate-900 dark:border-slate-800 dark:ring-slate-900/10">
      <div class="flex items-center gap-2">
        <h3 class="text-lg font-semibold text-slate-700 dark:text-slate-200">Optional: Push to GitHub</h3>
        <!-- Live save status badge -->
        <span id="save-status" class="ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300">
          All changes saved
        </span>
      </div>
      <p class="muted mt-1">Provide owner/repo/branch/path and a PAT with repo permissions to push directly.
        The token is only used in your browser.</p>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="gh-owner" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Owner</label>
          <input id="gh-owner" type="text" placeholder="owner" value="DarkShockGamer"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>
        <div>
          <label for="gh-repo" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Repo</label>
          <input id="gh-repo" type="text" placeholder="repo" value="DarkShockGamer.github.io"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>
        <div>
          <label for="gh-branch" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Branch</label>
          <input id="gh-branch" type="text" placeholder="branch" value="main"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>
        <div>
          <label for="gh-path" class="block text-sm font-medium text-slate-700 dark:text-slate-300">File path</label>
          <input id="gh-path" type="text" placeholder="path" value="data/site.json"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>
        <div class="md:col-span-2">
          <label for="gh-token" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Personal Access Token (PAT)</label>
          <input id="gh-token" type="password" placeholder="ghp_xxx"
                 class="mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mt-4">
        <button id="dry-run" class="border border-slate-300 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800 px-4 py-2 rounded-md font-semibold shadow-sm">
          Dry run (get SHA)
        </button>
        <button id="push-github" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm">
          Push to GitHub
        </button>
      </div>
      <pre id="gh-result" class="muted mt-3 whitespace-pre-wrap text-sm"></pre>
    </section>

    <footer class="text-center py-4 border-t border-slate-100 dark:border-slate-800 flex flex-col items-center gap-1">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-6 w-6" />
      <span class="text-sky-600 dark:text-sky-400 text-sm">© 2025 Trident Robotics — Developer Editor</span>
      <span class="text-xs text-sky-400">Internal content management • Edits saved to data/site.json</span>
    </footer>
  </main>

  <script>
    // ===== Base state and helpers =====
    function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }

    let siteData = {
      title: document.getElementById('site-title')?.value || 'Trident Robotics 4296',
      about: { heading: 'About Us', content: '<p>Edit...</p>' },
      timeline: [],
      leadership: {
        teams: [
          { team: "Design Team", role: "Lead", members: [] },
          { team: "Mechanical Team", role: "Lead", members: [] },
          { team: "Electrical Team", role: "Lead", members: [] },
          { team: "Programming Team", role: "Lead", members: [] },
          { team: "Drive Team", role: "Driver", members: [] }
        ],
        leads: [],
        drivers: []
      },
      media: {
        indexHeader: "/assets/group.png",
        indexPhoto: "/assets/Shark-Photo.png",
        sponsorsHeader: "/assets/group.png",
        competitionImages: ["/assets/Compitition-Photo1.png"]
      },
      sponsors: [
        { name: "Baxter", logo: "/assets/Baxter-Logo.png", url: "" },
        { name: "NASA", logo: "/assets/NASA-Logo.png", url: "" },
        { name: "Kubota", logo: "/assets/Kubota-Logo.png", url: "" },
        { name: "WW Displays Inc", logo: "/assets/WWDisplays.png", url: "" },
        { name: "Patel Family", logo: "/assets/PatelFamily.png", url: "" }
      ]
    };

    let isDirty = false;
    function updateSaveStatus() {
      const el = document.getElementById('save-status');
      if (!el) return;
      if (isDirty) {
        el.textContent = 'Unsaved changes';
        el.className = 'ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300';
      } else {
        el.textContent = 'All changes saved';
        el.className = 'ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300';
      }
    }
    function setDirty(reason) {
      isDirty = true;
      updateSaveStatus();
      if (reason) {
        const res = document.getElementById('media-result');
        if (res) res.textContent = reason + ' — Remember to click "Push to GitHub" to save site.json.';
      }
    }

    async function loadExisting() {
      try {
        const r = await fetch('/data/site.json?_=' + Date.now());
        if (r.ok) siteData = await r.json();
      } catch (e) { /* ignore */ }
      // Normalize leads
      if (siteData && siteData.leadership) {
        const leads = siteData.leadership.leads || [];
        siteData.leadership.leads = leads.map(l => {
          if (typeof l === 'string') return { name: l, team: '' };
          if (l && typeof l === 'object') return { name: l.name || '', team: l.team || '' };
          return { name: String(l || ''), team: '' };
        });
      }
      ensureMediaDefaults();
      ensureSponsorsDefaults();
      renderEditor();
      bindMediaManager();
      bindSponsorAddControls();
      renderSponsorsList();

      // Loaded from disk -> clean state
      isDirty = false;
      updateSaveStatus();
      const res = document.getElementById('media-result');
      if (res) res.textContent = '';
    }

    function ensureMediaDefaults() {
      siteData.media = siteData.media || {};
      siteData.media.indexHeader = siteData.media.indexHeader || '/assets/group.png';
      siteData.media.indexPhoto = siteData.media.indexPhoto || '/assets/Shark-Photo.png';
      siteData.media.sponsorsHeader = siteData.media.sponsorsHeader || '/assets/group.png';
      let imgs = siteData.media.competitionImages;
      if (!Array.isArray(imgs)) imgs = imgs ? [imgs] : [];
      if (!imgs.length) imgs = ['/assets/Compitition-Photo1.png'];
      siteData.media.competitionImages = imgs;
    }

    function ensureSponsorsDefaults() {
      if (!Array.isArray(siteData.sponsors)) {
        siteData.sponsors = [
          { name: "Baxter", logo: "/assets/Baxter-Logo.png", url: "" },
          { name: "NASA", logo: "/assets/NASA-Logo.png", url: "" },
          { name: "Kubota", logo: "/assets/Kubota-Logo.png", url: "" },
          { name: "WW Displays Inc", logo: "/assets/WWDisplays.png", url: "" },
          { name: "Patel Family", logo: "/assets/PatelFamily.png", url: "" }
        ];
      } else {
        // Coerce to expected shape
        siteData.sponsors = siteData.sponsors.map(s => ({
          name: (s && s.name) || '',
          logo: (s && s.logo) || '',
          url: (s && s.url) || ''
        }));
      }
    }

    function teamOptionsHtml(selectedTeam) {
      const teams = (siteData.leadership && siteData.leadership.teams) ? siteData.leadership.teams : [];
      const options = [''].concat(teams.map(t => t.team));
      return options.map(t => {
        const sel = (t === (selectedTeam || '')) ? ' selected' : '';
        const label = t || '— Select team —';
        return `<option value="${t.replace(/"/g, '&quot;')}"${sel}>${label}</option>`;
      }).join('');
    }

    function renderEditor(){
      // top-level fields
      document.getElementById('site-title').value = siteData.title || '';
      document.getElementById('about-heading').value = (siteData.about && siteData.about.heading) || '';
      document.getElementById('about-content').value = (siteData.about && siteData.about.content) || '';

      // Timeline
      const tl = document.getElementById('timeline-list'); tl.innerHTML = '';
      (siteData.timeline || []).forEach((ev, idx) => {
        const card = document.createElement('div'); card.className='timeline-entry';
        card.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <h3 class="text-base font-semibold text-slate-700 dark:text-slate-200">Event ${idx+1}</h3>
            <div class="flex gap-2">
              <button type="button" class="up border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-2 py-1 text-xs hover:bg-slate-50 dark:hover:bg-slate-800">↑</button>
              <button type="button" class="down border border-slate-300 dark:border-slate-700 dark:text-slate-200 rounded-md px-2 py-1 text-xs hover:bg-slate-50 dark:hover:bg-slate-800">↓</button>
              <button type="button" class="del border border-red-200 dark:border-red-900 rounded-md px-2 py-1 text-xs text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950">Delete</button>
            </div>
          </div>
          <div class="grid grid-cols-1 gap-2 mt-2">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">When</label>
              <input class="ev-date mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                     value="${(ev.date||ev.year||'').replace(/"/g, '&quot;')}">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Title</label>
              <input class="ev-title mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                     value="${(ev.title||'').replace(/"/g, '&quot;')}">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">Description (HTML)</label>
              <textarea class="ev-desc mt-1 w-full rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200">${ev.description||''}</textarea>
            </div>
          </div>
        `;
        tl.appendChild(card);

        // actions
        card.querySelector('.del').addEventListener('click',()=>{ siteData.timeline.splice(idx,1); setDirty('Timeline updated'); renderEditor(); });
        card.querySelector('.up').addEventListener('click',()=>{
          if(idx>0){
            const a=siteData.timeline[idx-1];
            siteData.timeline[idx-1]=siteData.timeline[idx];
            siteData.timeline[idx]=a;
            setDirty('Timeline updated');
            renderEditor();
          }
        });
        card.querySelector('.down').addEventListener('click',()=>{
          if(idx<siteData.timeline.length-1){
            const a=siteData.timeline[idx+1];
            siteData.timeline[idx+1]=siteData.timeline[idx];
            siteData.timeline[idx]=a;
            setDirty('Timeline updated');
            renderEditor();
          }
        });
        card.querySelector('.ev-date').addEventListener('input',(e)=> { siteData.timeline[idx].date = e.target.value; setDirty('Timeline updated'); });
        card.querySelector('.ev-title').addEventListener('input',(e)=> { siteData.timeline[idx].title = e.target.value; setDirty('Timeline updated'); });
        card.querySelector('.ev-desc').addEventListener('input',(e)=> { siteData.timeline[idx].description = e.target.value; setDirty('Timeline updated'); });
      });

      // Leads with team selection
      const leadsC = document.getElementById('leads-list'); leadsC.innerHTML = '';
      (siteData.leadership.leads || []).forEach((lead, i) => {
        const item = (typeof lead === 'string') ? { name: lead, team: '' } : (lead || { name: '', team: '' });
        const span = document.createElement('span'); span.className='pill';
        span.innerHTML = `
          <strong>${(item.name||'').replace(/</g,'&lt;')}</strong>
          <span class="text-slate-400">—</span>
          <select class="lead-team" aria-label="Lead team">${teamOptionsHtml(item.team)}</select>
          <button type="button" class="remove" aria-label="Remove lead">×</button>
        `;
        leadsC.appendChild(span);
        span.querySelector('.lead-team').addEventListener('change',(e)=>{
          siteData.leadership.leads[i] = { name: item.name, team: e.target.value };
          setDirty('Leadership updated');
        });
        span.querySelector('.remove').addEventListener('click',()=>{
          siteData.leadership.leads.splice(i,1);
          setDirty('Leadership updated');
          renderEditor();
        });
      });

      // Populate the "new lead team" select
      const newLeadTeam = document.getElementById('new-lead-team');
      newLeadTeam.innerHTML = teamOptionsHtml('');

      // Drivers (simple list of strings)
      const driversC = document.getElementById('drivers-list'); driversC.innerHTML = '';
      (siteData.leadership.drivers || []).forEach((n,i)=> {
        const span = document.createElement('span'); span.className='pill';
        span.textContent=n;
        const btn = document.createElement('button'); btn.textContent='×'; btn.addEventListener('click',()=>{ siteData.leadership.drivers.splice(i,1); setDirty('Leadership updated'); renderEditor(); });
        span.appendChild(btn); driversC.appendChild(span);
      });

      // Sync media previews
      const f1 = document.getElementById('media-indexHeader');
      const f2 = document.getElementById('media-indexPhoto');
      const f3 = document.getElementById('media-sponsorsHeader');
      if (f1) f1.value = siteData.media.indexHeader || '';
      if (f2) f2.value = siteData.media.indexPhoto || '';
      if (f3) f3.value = siteData.media.sponsorsHeader || '';
      const p1 = document.getElementById('preview-indexHeader'); if (p1) p1.src = siteData.media.indexHeader || '';
      const p2 = document.getElementById('preview-indexPhoto'); if (p2) p2.src = siteData.media.indexPhoto || '';
      const p3 = document.getElementById('preview-sponsorsHeader'); if (p3) p3.src = siteData.media.sponsorsHeader || '';
      renderCompetitionList();
    }

    // ===== Add handlers (top-level add buttons) =====
    document.getElementById('add-timeline').addEventListener('click', ()=>{
      siteData.timeline.push({id:uid(), date:new Date().toLocaleDateString(), title:'New event', description:''});
      setDirty('Timeline updated');
      renderEditor();
    });

    document.getElementById('add-lead').addEventListener('click', ()=>{
      const name = document.getElementById('new-lead').value.trim();
      const team = document.getElementById('new-lead-team').value.trim();
      if (name){
        siteData.leadership.leads.push({ name, team });
        document.getElementById('new-lead').value = '';
        document.getElementById('new-lead-team').value = '';
        setDirty('Leadership updated');
        renderEditor();
      }
    });

    document.getElementById('add-driver').addEventListener('click', ()=>{
      const v=document.getElementById('new-driver').value.trim();
      if(v){
        siteData.leadership.drivers.push(v);
        document.getElementById('new-driver').value='';
        setDirty('Leadership updated');
        renderEditor();
      }
    });

    // ===== Live updates => mark dirty =====
    document.getElementById('site-title').addEventListener('input',(e)=> { siteData.title = e.target.value; setDirty('Content changed'); });
    document.getElementById('about-heading').addEventListener('input',(e)=> { siteData.about.heading = e.target.value; setDirty('Content changed'); });
    document.getElementById('about-content').addEventListener('input',(e)=> { siteData.about.content = e.target.value; setDirty('Content changed'); });

    // ===== Download/preview =====
    document.getElementById('download-json').addEventListener('click', ()=>{
      const b = new Blob([JSON.stringify(siteData,null,2)], {type:'application/json'});
      const u = URL.createObjectURL(b);
      const a = document.createElement('a'); a.href = u; a.download = 'site.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(u);
    });
    document.getElementById('preview-json').addEventListener('click', ()=> alert(JSON.stringify(siteData,null,2)));

    // ===== GitHub push (text/json) =====
    async function getSha(owner, repo, path, branch, token){
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;
      const r = await fetch(url, { headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github+json' }});
      if (r.status === 404) return null;
      if (!r.ok) throw new Error(await r.text());
      const j = await r.json(); return j.sha;
    }
    async function pushFile(owner, repo, path, branch, token, content, message){
      const base64 = btoa(unescape(encodeURIComponent(content)));
      const sha = await getSha(owner, repo, path, branch, token);
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
      const body = { message: message||'Update site content via developer.html', content: base64, branch };
      if (sha) body.sha = sha;
      const r = await fetch(url, {
        method:'PUT',
        headers:{ Authorization: 'token ' + token, Accept:'application/vnd.github+json', 'Content-Type':'application/json' },
        body: JSON.stringify(body)
      });
      return await r.json();
    }

    document.getElementById('dry-run').addEventListener('click', async ()=>{
      const owner = document.getElementById('gh-owner').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const branch = document.getElementById('gh-branch').value.trim() || 'main';
      const path = document.getElementById('gh-path').value.trim() || 'data/site.json';
      const token = document.getElementById('gh-token').value.trim();
      if (!owner || !repo || !token) { document.getElementById('gh-result').textContent = 'owner/repo/token required'; return; }
      try {
        document.getElementById('gh-result').textContent = 'Checking...';
        const sha = await getSha(owner, repo, path, branch, token);
        document.getElementById('gh-result').textContent = sha ? ('Found existing file. SHA: ' + sha) : 'No existing file (will create new).';
      } catch (e) {
        document.getElementById('gh-result').textContent = 'Error: ' + e.message;
      }
    });

    document.getElementById('push-github').addEventListener('click', async ()=>{
      const owner = document.getElementById('gh-owner').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const branch = document.getElementById('gh-branch').value.trim() || 'main';
      const path = document.getElementById('gh-path').value.trim() || 'data/site.json';
      const token = document.getElementById('gh-token').value.trim();
      if (!owner || !repo || !token) { document.getElementById('gh-result').textContent = 'owner/repo/token required'; return; }
      try {
        // Ensure latest edits captured (including media & sponsors)
        siteData.title = document.getElementById('site-title').value;
        siteData.about.heading = document.getElementById('about-heading').value;
        siteData.about.content = document.getElementById('about-content').value;
        siteData.media.indexHeader = document.getElementById('media-indexHeader')?.value?.trim() || siteData.media.indexHeader;
        siteData.media.indexPhoto = document.getElementById('media-indexPhoto')?.value?.trim() || siteData.media.indexPhoto;
        siteData.media.sponsorsHeader = document.getElementById('media-sponsorsHeader')?.value?.trim() || siteData.media.sponsorsHeader;

        document.getElementById('gh-result').textContent = 'Pushing...';
        const res = await pushFile(owner, repo, path, branch, token, JSON.stringify(siteData,null,2), 'Update site data via developer.html');
        if (res && res.commit && res.commit.sha) {
          document.getElementById('gh-result').textContent = 'Success. Commit: ' + res.commit.sha;
          isDirty = false; updateSaveStatus();
          const msg = document.getElementById('media-result');
          if (msg) msg.textContent = 'site.json saved. Your image and sponsor changes are now live.';
        } else {
          document.getElementById('gh-result').textContent = 'Response: ' + JSON.stringify(res);
        }
      } catch (e) { document.getElementById('gh-result').textContent = 'Error: ' + e.message; }
    });

    // ===== Media Manager: upload binary files to repo =====
    function sanitizeFileName(name) {
      return name.replace(/[^a-zA-Z0-9._-]/g, '_');
    }
    function base64FromFile(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const bytes = new Uint8Array(reader.result);
            let binary = '';
            const chunk = 0x8000;
            for (let i = 0; i < bytes.length; i += chunk) {
              binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunk));
            }
            resolve(btoa(binary));
          } catch (e) { reject(e); }
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }
    async function pushBinaryFile(owner, repo, path, branch, token, base64, message) {
      const sha = await getSha(owner, repo, path, branch, token);
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
      const body = { message: message || 'Upload image via developer.html', content: base64, branch };
      if (sha) body.sha = sha;
      const r = await fetch(url, {
        method: 'PUT',
        headers: {
          Authorization: 'token ' + token,
          Accept: 'application/vnd.github+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j.message || JSON.stringify(j));
      return j;
    }
    async function uploadOneImage(file) {
      const owner = document.getElementById('gh-owner').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const branch = (document.getElementById('gh-branch').value.trim() || 'main');
      const token = document.getElementById('gh-token').value.trim();
      const destDir = (document.getElementById('media-dest-dir').value.trim() || 'assets/uploads').replace(/\/+$/,'');
      if (!owner || !repo || !token) throw new Error('owner/repo/token required (set in "Optional: Push to GitHub").');

      const safeName = `${Date.now()}-${sanitizeFileName(file.name)}`;
      const path = `${destDir}/${safeName}`.replace(/^\/+/,'');
      const b64 = await base64FromFile(file);
      const res = await pushBinaryFile(owner, repo, path, branch, token, b64, `Upload image ${safeName} via developer.html`);
      return `/${res.content.path}`; // site-relative URL
    }

    function bindImageField(fieldId, fileInputId, buttonId, previewId, getter, setter) {
      const field = document.getElementById(fieldId);
      const fileInput = document.getElementById(fileInputId);
      const button = document.getElementById(buttonId);
      const preview = document.getElementById(previewId);
      if (!field || !fileInput || !button || !preview) return;

      // initialize
      field.value = getter() || '';
      preview.src = getter() || '';

      field.addEventListener('input', () => {
        setter(field.value.trim());
        preview.src = field.value.trim() || '';
        setDirty('Media link changed');
      });

      button.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', async (e) => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        try {
          document.getElementById('media-result').textContent = 'Uploading...';
          const url = await uploadOneImage(f);
          setter(url);
          field.value = url;
          preview.src = url;
          setDirty('Image uploaded to repository ✓ (reference pending in site.json)');
          document.getElementById('media-result').textContent = `Uploaded: ${url}\nImage file is committed. Reference will be saved to site.json when you click "Push to GitHub".`;
        } catch (err) {
          document.getElementById('media-result').textContent = 'Error: ' + err.message;
        } finally {
          fileInput.value = '';
        }
      });
    }

    function renderCompetitionList() {
      const list = document.getElementById('media-competition-list');
      if (!list || !siteData.media) return;
      list.innerHTML = '';
      (siteData.media.competitionImages || []).forEach((url, idx) => {
        const card = document.createElement('div');
        card.className = 'rounded-lg border border-slate-200 dark:border-slate-800 overflow-hidden bg-white dark:bg-slate-900';
        card.innerHTML = `
          <img src="${url}" alt="Competition ${idx+1}" class="w-full aspect-[4/3] object-cover">
          <div class="p-2 flex items-center justify-between gap-2">
            <span class="text-xs truncate" title="${url}">${url}</span>
            <div class="flex gap-1">
              <button class="border border-slate-300 dark:border-slate-700 rounded px-2 text-xs" data-act="up">↑</button>
              <button class="border border-slate-300 dark:border-slate-700 rounded px-2 text-xs" data-act="down">↓</button>
              <button class="border border-red-300 dark:border-red-900 text-red-600 dark:text-red-400 rounded px-2 text-xs" data-act="del">✕</button>
            </div>
          </div>
        `;
        card.querySelector('[data-act="up"]').addEventListener('click', () => {
          if (idx > 0) {
            const a = siteData.media.competitionImages[idx-1];
            siteData.media.competitionImages[idx-1] = siteData.media.competitionImages[idx];
            siteData.media.competitionImages[idx] = a;
            setDirty('Competition gallery updated');
            renderCompetitionList();
          }
        });
        card.querySelector('[data-act="down"]').addEventListener('click', () => {
          if (idx < siteData.media.competitionImages.length - 1) {
            const a = siteData.media.competitionImages[idx+1];
            siteData.media.competitionImages[idx+1] = siteData.media.competitionImages[idx];
            siteData.media.competitionImages[idx] = a;
            setDirty('Competition gallery updated');
            renderCompetitionList();
          }
        });
        card.querySelector('[data-act="del"]').addEventListener('click', () => {
          siteData.media.competitionImages.splice(idx, 1);
          setDirty('Competition gallery updated');
          renderCompetitionList();
        });
        list.appendChild(card);
      });
    }

    function bindCompetitionControls() {
      const addBtn = document.getElementById('add-competition-url');
      const urlInput = document.getElementById('new-competition-url');
      const btn = document.getElementById('btn-upload-competition');
      const fileInput = document.getElementById('file-competition');

      if (addBtn && urlInput) {
        addBtn.addEventListener('click', () => {
          const v = urlInput.value.trim();
          if (!v) return;
          siteData.media.competitionImages.push(v);
          urlInput.value = '';
          setDirty('Competition gallery updated');
          renderCompetitionList();
        });
      }

      if (btn && fileInput) {
        btn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', async (e) => {
          const files = Array.from(e.target.files || []);
          if (!files.length) return;
          try {
            document.getElementById('media-result').textContent = 'Uploading...';
            for (const f of files) {
              const url = await uploadOneImage(f);
              siteData.media.competitionImages.push(url);
            }
            setDirty('Image(s) uploaded to repository ✓ (references pending in site.json)');
            document.getElementById('media-result').textContent = 'Uploaded ' + files.length + ' file(s).\nImages are committed. References will be saved when you click "Push to GitHub".';
            renderCompetitionList();
          } catch (err) {
            document.getElementById('media-result').textContent = 'Error: ' + err.message;
          } finally {
            fileInput.value = '';
          }
        });
      }
    }

    function bindMediaManager() {
      bindImageField(
        'media-indexHeader', 'file-indexHeader', 'btn-upload-indexHeader', 'preview-indexHeader',
        () => siteData.media.indexHeader,
        (v) => siteData.media.indexHeader = v
      );
      bindImageField(
        'media-indexPhoto', 'file-indexPhoto', 'btn-upload-indexPhoto', 'preview-indexPhoto',
        () => siteData.media.indexPhoto,
        (v) => siteData.media.indexPhoto = v
      );
      bindImageField(
        'media-sponsorsHeader', 'file-sponsorsHeader', 'btn-upload-sponsorsHeader', 'preview-sponsorsHeader',
        () => siteData.media.sponsorsHeader,
        (v) => siteData.media.sponsorsHeader = v
      );
      bindCompetitionControls();
      renderCompetitionList();
    }

    // ===== Sponsors Manager =====
    function bindSponsorAddControls() {
      const logoBtn = document.getElementById('btn-upload-sponsor-logo');
      const logoInput = document.getElementById('file-sponsor-logo');
      const logoUrlField = document.getElementById('new-sponsor-logo');
      const logoPreview = document.getElementById('preview-sponsor-logo');
      const addBtn = document.getElementById('add-sponsor');

      if (logoBtn && logoInput && logoUrlField && logoPreview) {
        logoBtn.addEventListener('click', () => logoInput.click());
        logoInput.addEventListener('change', async (e) => {
          const f = e.target.files && e.target.files[0];
          if (!f) return;
          try {
            document.getElementById('media-result').textContent = 'Uploading logo...';
            const url = await uploadOneImage(f);
            logoUrlField.value = url;
            logoPreview.src = url;
            setDirty('Sponsor logo uploaded ✓ (reference pending in site.json)');
            document.getElementById('media-result').textContent = `Uploaded logo: ${url}\nLogo file is committed. Add sponsor and push to save changes.`;
          } catch (err) {
            document.getElementById('media-result').textContent = 'Error: ' + err.message;
          } finally {
            logoInput.value = '';
          }
        });
        logoUrlField.addEventListener('input', () => {
          logoPreview.src = logoUrlField.value.trim() || '';
        });
      }

      if (addBtn) {
        addBtn.addEventListener('click', () => {
          const name = document.getElementById('new-sponsor-name').value.trim();
          const logo = document.getElementById('new-sponsor-logo').value.trim();
          const url = document.getElementById('new-sponsor-link').value.trim();
          if (!name || !logo) {
            alert('Please provide at least a sponsor name and a logo URL.');
            return;
          }
          siteData.sponsors.push({ name, logo, url });
          // clear inputs
          document.getElementById('new-sponsor-name').value = '';
          document.getElementById('new-sponsor-logo').value = '';
          document.getElementById('new-sponsor-link').value = '';
          const prev = document.getElementById('preview-sponsor-logo'); if (prev) prev.src = '';
          setDirty('Sponsors list updated');
          renderSponsorsList();
        });
      }
    }

    function renderSponsorsList() {
      const wrap = document.getElementById('sponsors-list');
      if (!wrap) return;
      wrap.innerHTML = '';
      (siteData.sponsors || []).forEach((s, idx) => {
        const card = document.createElement('div');
        card.className = 'rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 overflow-hidden shadow-sm';

        card.innerHTML = `
          <div class="p-3 flex items-start gap-3">
            <img src="${(s.logo||'').replace(/"/g,'&quot;')}" alt="${(s.name||'').replace(/"/g,'&quot;')}" class="h-16 w-24 object-contain rounded border border-slate-200 dark:border-slate-700 bg-white">
            <div class="flex-1 grid grid-cols-1 gap-2">
              <div>
                <label class="block text-xs text-slate-500">Name</label>
                <input data-k="name" class="w-full rounded-md border border-slate-300 px-2 py-1.5 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                       value="${(s.name||'').replace(/"/g,'&quot;')}">
              </div>
              <div>
                <label class="block text-xs text-slate-500">Link (optional)</label>
                <input data-k="url" class="w-full rounded-md border border-slate-300 px-2 py-1.5 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                       value="${(s.url||'').replace(/"/g,'&quot;')}" placeholder="https://example.com">
              </div>
              <div>
                <label class="block text-xs text-slate-500">Logo URL</label>
                <input data-k="logo" class="w-full rounded-md border border-slate-300 px-2 py-1.5 dark:bg-slate-950 dark:border-slate-700 dark:text-slate-200"
                       value="${(s.logo||'').replace(/"/g,'&quot;')}">
              </div>
            </div>
          </div>
          <div class="px-3 pb-3 flex items-center justify-end gap-2">
            <button class="border border-slate-300 dark:border-slate-700 rounded px-2 py-1 text-xs" data-act="up">↑</button>
            <button class="border border-slate-300 dark:border-slate-700 rounded px-2 py-1 text-xs" data-act="down">↓</button>
            <button class="border border-red-300 dark:border-red-900 text-red-600 dark:text-red-400 rounded px-2 py-1 text-xs" data-act="del">Delete</button>
          </div>
        `;

        // Bind inputs
        card.querySelectorAll('input[data-k]').forEach(inp => {
          inp.addEventListener('input', e => {
            const key = e.target.getAttribute('data-k');
            const val = e.target.value;
            siteData.sponsors[idx][key] = val;
            if (key === 'logo') {
              const img = card.querySelector('img');
              if (img) img.src = val;
            }
            setDirty('Sponsors list updated');
          });
        });

        // Actions
        card.querySelector('[data-act="up"]').addEventListener('click', () => {
          if (idx > 0) {
            const a = siteData.sponsors[idx-1];
            siteData.sponsors[idx-1] = siteData.sponsors[idx];
            siteData.sponsors[idx] = a;
            setDirty('Sponsors reordered');
            renderSponsorsList();
          }
        });
        card.querySelector('[data-act="down"]').addEventListener('click', () => {
          if (idx < siteData.sponsors.length - 1) {
            const a = siteData.sponsors[idx+1];
            siteData.sponsors[idx+1] = siteData.sponsors[idx];
            siteData.sponsors[idx] = a;
            setDirty('Sponsors reordered');
            renderSponsorsList();
          }
        });
        card.querySelector('[data-act="del"]').addEventListener('click', () => {
          siteData.sponsors.splice(idx, 1);
          setDirty('Sponsor removed');
          renderSponsorsList();
        });

        wrap.appendChild(card);
      });
    }

    // Start
    loadExisting();
  </script>
</body>
</html>
