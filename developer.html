<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trident Robotics Admin Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; background: #f0f2f5; padding: 2rem; }
h1 { color: #0a1f44; }
section { background: #fff; padding: 1rem 2rem; margin-bottom: 2rem; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
textarea, input[type="text"] { width: 100%; margin: 0.5rem 0; padding: 0.5rem; border-radius: 5px; border: 1px solid #ccc; font-family: monospace; }
button { padding: 0.5rem 1rem; margin: 0.5rem 0; background: #1f4d7a; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
button:hover { background: #4fa3d1; }
h3 { margin-top: 1rem; color: #1f4d7a; }
hr { border: none; border-top: 1px solid #eee; margin: 0.5rem 0; }
</style>
</head>
<body>

<h1>Trident Robotics Content Editor</h1>

<section id="about-editor">
  <h2>About Us Section</h2>
  <div id="about-list"></div>
  <button onclick="addAboutParagraph()">Add Paragraph</button>
</section>

<section id="team-editor">
  <h2>Team Leads</h2>
  <div id="team-list"></div>
  <button onclick="addTeam()">Add Team</button>
</section>

<section id="timeline-editor">
  <h2>Timeline Events</h2>
  <div id="timeline-list"></div>
  <button onclick="addTimelineEvent()">Add Event</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { 
  getFirestore, collection, doc, setDoc, addDoc, onSnapshot, deleteDoc 
} from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "AIzaSyC7k3xdqmsuYOEBBDbDfnrmuaebLaHFWZI",
  authDomain: "tridenttaskboard.firebaseapp.com",
  projectId: "tridenttaskboard",
  storageBucket: "tridenttaskboard.firebasestorage.app",
  messagingSenderId: "143400263387",
  appId: "1:143400263387:web:66ed521ae75af588e836fe",
  measurementId: "G-F12DDQCX87"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== Firestore collections =====
const aboutCol = collection(db, "about");
const teamCol = collection(db, "team");
const timelineCol = collection(db, "timeline");

// ===== Local state =====
let aboutContent = [];
let teamData = [];
let timelineEvents = [];

// ===== Render Functions =====
function renderAbout() {
  const container = document.getElementById('about-list');
  container.innerHTML = '';
  aboutContent.forEach((p) => {
    const wrapper = document.createElement('div');

    const textarea = document.createElement('textarea');
    textarea.value = p.text || "";
    textarea.addEventListener('input', async (e) => {
      aboutContent.find(x => x.id === p.id).text = e.target.value;
      await setDoc(doc(db, "about", p.id), { text: e.target.value });
    });

    const delBtn = document.createElement('button');
    delBtn.textContent = "Delete Paragraph";
    delBtn.addEventListener('click', async () => {
      await deleteDoc(doc(db, "about", p.id));
    });

    wrapper.appendChild(textarea);
    wrapper.appendChild(delBtn);
    container.appendChild(wrapper);
  });
}

function renderTeam() {
  const container = document.getElementById('team-list');
  container.innerHTML = '';

  teamData.forEach((t) => {
    const div = document.createElement('div');
    const title = document.createElement('h3');
    title.textContent = `${t.team} (${t.role})`;
    div.appendChild(title);

    t.members.forEach((m, j) => {
      const input = document.createElement('input');
      input.type = 'text';
      input.value = m;
      input.placeholder = 'Member';
      input.addEventListener('input', async (e) => {
        const team = teamData.find(x => x.id === t.id);
        team.members[j] = e.target.value;
        await setDoc(doc(db, "team", t.id), team);
      });
      div.appendChild(input);
    });

    const delBtn = document.createElement('button');
    delBtn.textContent = "Delete Team";
    delBtn.addEventListener('click', async () => {
      await deleteDoc(doc(db, "team", t.id));
    });

    div.appendChild(delBtn);
    container.appendChild(div);
  });
}

function renderTimeline() {
  const container = document.getElementById('timeline-list');
  container.innerHTML = '';

  timelineEvents.forEach((e) => {
    const div = document.createElement('div');

    const dateInput = document.createElement('input');
    dateInput.type = 'text';
    dateInput.value = e.date;
    dateInput.placeholder = 'Date';
    dateInput.addEventListener('input', async (ev) => {
      e.date = ev.target.value;
      await setDoc(doc(db, "timeline", e.id), e);
    });

    const textInput = document.createElement('input');
    textInput.type = 'text';
    textInput.value = e.text;
    textInput.placeholder = 'Title';
    textInput.addEventListener('input', async (ev) => {
      e.text = ev.target.value;
      await setDoc(doc(db, "timeline", e.id), e);
    });

    const infoArea = document.createElement('textarea');
    infoArea.value = e.info || "";
    infoArea.placeholder = 'Info';
    infoArea.addEventListener('input', async (ev) => {
      e.info = ev.target.value;
      await setDoc(doc(db, "timeline", e.id), e);
    });

    const delBtn = document.createElement('button');
    delBtn.textContent = "Delete Event";
    delBtn.addEventListener('click', async () => {
      await deleteDoc(doc(db, "timeline", e.id));
    });

    div.appendChild(dateInput);
    div.appendChild(textInput);
    div.appendChild(infoArea);
    div.appendChild(delBtn);
    div.appendChild(document.createElement('hr'));
    container.appendChild(div);
  });
}

// ===== Add New =====
async function addAboutParagraph() { await addDoc(aboutCol, { text: "" }); }
async function addTeam() { await addDoc(teamCol, { team: "New Team", role: "Lead", members: [""] }); }
async function addTimelineEvent() { await addDoc(timelineCol, { date: "", text: "", info: "" }); }

// ===== Real-time listeners =====
onSnapshot(aboutCol, snapshot => {
  aboutContent = [];
  snapshot.forEach(docSnap => aboutContent.push({ id: docSnap.id, ...docSnap.data() }));
  renderAbout();
});

onSnapshot(teamCol, snapshot => {
  teamData = [];
  snapshot.forEach(docSnap => teamData.push({ id: docSnap.id, ...docSnap.data() }));
  renderTeam();
});

onSnapshot(timelineCol, snapshot => {
  timelineEvents = [];
  snapshot.forEach(docSnap => timelineEvents.push({ id: docSnap.id, ...docSnap.data() }));
  renderTimeline();
});

// ===== Attach top-level button listeners =====
document.querySelector('#about-editor button').addEventListener('click', addAboutParagraph);
document.querySelector('#team-editor button').addEventListener('click', addTeam);
document.querySelector('#timeline-editor button').addEventListener('click', addTimelineEvent);

</script>
</body>
</html>
