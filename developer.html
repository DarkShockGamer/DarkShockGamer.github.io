<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trident Robotics — Content Manager</title>
  <link rel="icon" type="image/png" href="/assets/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(to bottom, #f0f9ff, white); font-family: system-ui, sans-serif; }
    .dragging { opacity: 0.5; transform: scale(1.05); }
  </style>
</head>
<body class="min-h-screen p-6">

<header class="max-w-6xl mx-auto mb-6">
  <h1 class="text-3xl font-extrabold text-sky-800 mb-1">Trident Robotics — Content Manager</h1>
  <p class="text-sm text-sky-600 mb-3">Business Team Editor for Live Website Text</p>
  <input id="filterInput" placeholder="Search sections..." class="border border-sky-200 px-3 py-2 rounded-lg shadow-sm text-sm w-full sm:w-72" />
</header>

<main class="max-w-6xl mx-auto">
  <div id="contentList" class="grid gap-4"></div>
</main>

<footer class="mt-12 text-center py-4 border-t border-sky-100 flex flex-col items-center gap-1">
  <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-6 w-6" />
  <span class="text-sky-600 text-sm">© 2025 Trident Robotics — Content Manager</span>
  <span class="text-xs text-sky-400">Internal editing dashboard • Linked to Firestore</span>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, getDocs, setDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

// ====== Your Firebase Config ======
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const list = document.getElementById("contentList");
const filterInput = document.getElementById("filterInput");

// ====== Load Firestore Content ======
async function loadContent() {
  const snapshot = await getDocs(collection(db, "site_content"));
  return snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
}

// ====== Save Entry ======
async function saveEntry(entry) {
  await setDoc(doc(db, "site_content", entry.id), entry);
}

// ====== Delete Entry ======
async function deleteEntry(id) {
  await deleteDoc(doc(db, "site_content", id));
}

// ====== Render List ======
async function renderList() {
  const filter = filterInput.value.toLowerCase();
  const entries = (await loadContent()).filter(e =>
    !filter || e.title.toLowerCase().includes(filter) || e.id.toLowerCase().includes(filter)
  );
  list.innerHTML = "";
  entries.forEach(e => list.appendChild(createEntryEl(e)));
}

// ====== Create Editable Card ======
function createEntryEl(entry) {
  const card = document.createElement("div");
  card.className = "bg-white border border-sky-100 rounded-xl p-4 shadow-sm flex flex-col gap-2";
  card.innerHTML = `
    <div class="flex justify-between items-start">
      <div>
        <h3 class="font-semibold text-sky-800">${entry.title}</h3>
        <p class="text-xs text-sky-500">${entry.id}</p>
      </div>
      <div class="flex gap-2">
        <button class="px-2 py-1 text-xs border rounded-md edit-btn">Edit</button>
        <button class="px-2 py-1 text-xs border border-red-200 text-red-600 del-btn">Delete</button>
      </div>
    </div>
    <p class="text-sm text-gray-700 whitespace-pre-line">${entry.content || "(empty)"}</p>
  `;

  card.querySelector(".edit-btn").onclick = () => openEditModal(entry);
  card.querySelector(".del-btn").onclick = async () => {
    if (!confirm(`Delete "${entry.title}"?`)) return;
    await deleteEntry(entry.id);
    renderList();
  };

  return card;
}

// ====== Edit Modal ======
function openEditModal(entry) {
  const modal = document.createElement("div");
  modal.className = "fixed inset-0 bg-black/30 flex items-center justify-center z-50";
  modal.innerHTML = `
    <div class="bg-white p-6 rounded-xl shadow-xl w-96 space-y-3">
      <h3 class="text-lg font-semibold text-sky-700">${entry.title}</h3>
      <textarea id="editContent" rows="6" class="w-full border border-sky-200 rounded-md px-3 py-2">${entry.content || ""}</textarea>
      <div class="flex justify-end gap-2">
        <button id="saveEdit" class="px-3 py-1 bg-sky-600 text-white rounded-md text-sm">Save</button>
        <button id="cancelEdit" class="px-3 py-1 border rounded-md text-sm">Cancel</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  modal.querySelector("#cancelEdit").onclick = () => modal.remove();
  modal.querySelector("#saveEdit").onclick = async () => {
    entry.content = modal.querySelector("#editContent").value;
    await saveEntry(entry);
    modal.remove();
    renderList();
  };
}

filterInput.oninput = renderList;
renderList();
</script>

</body>
</html>
