<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/assets/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/assets/css/adaptive-themes.css">
  <!-- Pre-paint theme application to prevent FOUC -->
  <script>
    (function() {
      // Migration map for old adaptive themes
      const migrationMap = {
        'sunrise': 'light',
        'daylight': 'light',
        'sunset': 'dark',
        'midnight': 'dark'
      };
      
      // Valid new adaptive themes
      const validAdaptiveThemes = ['light', 'dark', 'high-contrast-light', 'high-contrast-dark'];
      
      // Check for adaptive theme first
      let adaptiveTheme = localStorage.getItem('site-adaptive-theme');
      
      // Migrate old theme if found
      if (adaptiveTheme && migrationMap[adaptiveTheme]) {
        adaptiveTheme = migrationMap[adaptiveTheme];
        localStorage.setItem('site-adaptive-theme', adaptiveTheme);
      }
      
      // Remove all existing theme classes to prevent conflicts
      const html = document.documentElement;
      html.classList.remove('theme-light', 'theme-dark', 'theme-high-contrast',
                            'theme-high-contrast-light', 'theme-high-contrast-dark',
                            'theme-sunrise', 'theme-daylight', 'theme-sunset', 'theme-midnight');
      
      if (adaptiveTheme && validAdaptiveThemes.includes(adaptiveTheme)) {
        html.classList.add('theme-' + adaptiveTheme);
      } else {
        // If no valid adaptive theme, default to light
        adaptiveTheme = 'light';
        localStorage.setItem('site-adaptive-theme', adaptiveTheme);
        html.classList.add('theme-light');
      }
    })();
  </script>
  <title>Settings ‚Äî Trident Robotics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #f0f9ff 60%, #e0e7ef 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    @media (prefers-color-scheme: dark) {
      html, body { color-scheme: dark; }
      body { background: linear-gradient(to bottom, #192132 60%, #0b1220 100%); color: #e5e7eb; }
    }
    .panel { background: white; border: 1px solid #e2e8f0; border-radius: 1rem; box-shadow: 0 1px 2px rgba(2, 6, 23, 0.05); }
    @media (prefers-color-scheme: dark) {
      .panel { background: #0f172a; border-color: #1f2937; box-shadow: 0 1px 2px rgba(2, 6, 23, 0.30); }
    }
    .tabs { 
      display: flex; gap: 2px; background: #f1f5f9; border-radius: 0.5rem; padding: 4px; 
      overflow-x: auto; -webkit-overflow-scrolling: touch; position: relative;
    }
    .tab-btn {
      flex: 1 1 auto; padding: 0.5rem 1rem; border-radius: 0.5rem; background: none; border: none;
      font-weight: 600; color: #64748b; transition: color 180ms;
      cursor: pointer; white-space: nowrap; min-width: max-content; position: relative; z-index: 1;
    }
    .tab-btn[aria-selected="true"] {
      color: white;
    }
    .tab-indicator {
      position: absolute;
      top: 4px;
      left: 4px;
      height: calc(100% - 8px);
      border-radius: 0.5rem;
      background: linear-gradient(90deg, #38bdf8 60%, #818cf8 100%);
      box-shadow: 0 2px 8px rgba(56,189,248,0.09);
      transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1), width 200ms cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      z-index: 0;
    }
    @media (prefers-color-scheme: dark) {
      .tabs { background: #1e293b; }
      .tab-btn { color: #94a3b8; }
    }
    .tab-panel {
      transition: opacity 320ms cubic-bezier(.45,1.5,.65,1), transform 320ms cubic-bezier(.45,1.5,.65,1);
      opacity: 0;
      transform: translateX(24px) scale(.98);
      position: absolute; width: 100%; left: 0; top: 0; z-index: 0;
      pointer-events: none;
      background: inherit;
    }
    .tab-panel.active {
      opacity: 1;
      transform: translateX(0) scale(1);
      pointer-events: auto;
      z-index: 1;
      position: relative;
    }
    .toggle { width: 44px; height: 24px; border-radius: 9999px; background: #e0e7ef; position: relative; cursor: pointer; transition: background 220ms cubic-bezier(.6,1.7,.2,1); border: 1.5px solid #93c5fd; box-shadow: 0 1px 3px rgba(59,130,246,0.08);}
    .toggle.on { background: linear-gradient(90deg, #38bdf8 60%, #818cf8 100%); border-color: #818cf8; }
    .toggle-knob { position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; border-radius: 50%; background: white; box-shadow: 0 2px 6px rgba(59,130,246,0.09); transition: left 240ms cubic-bezier(.7,1.7,.2,1);}
    .toggle.on .toggle-knob { left: 22px; background: #818cf8; }
    .save-btn { background: linear-gradient(90deg, #38bdf8 60%, #818cf8 100%); color: white; font-weight: 600; border: none; border-radius: 0.5rem; padding: 0.5rem 1.5rem; transition: background 180ms, box-shadow 180ms; box-shadow: 0 2px 8px rgba(56,189,248,0.09);}
    .save-btn:active { background: linear-gradient(90deg, #818cf8 0%, #38bdf8 80%);}
    .cancel-btn { background: none; border: 1px solid #e2e8f0; color: #64748b; font-weight: 600; border-radius: 0.5rem; padding: 0.5rem 1.5rem; margin-left: 0.5rem;}
    @media (prefers-color-scheme: dark) {
      .cancel-btn { border-color: #374151; color: #94a3b8;}
    }
    .fadein { animation: fadein 700ms cubic-bezier(.4,2.5,.5,1.1); }
    @keyframes fadein { from { opacity: 0; transform: translateY(24px);} to { opacity: 1; transform: none;} }
    /* Responsive body padding for very small screens */
    @media (max-width: 414px) {
      body { padding: 1rem; }
    }
    /* --- Floating Gears Animation --- */
    #gear-bg {
      pointer-events: none;
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      overflow: visible;
    }
    .gear {
      filter: drop-shadow(0 2px 8px rgba(56,189,248,0.18));
      opacity: 0.25;
      will-change: transform;
      transition: opacity 0.4s;
    }
    @media (prefers-color-scheme: dark) {
      .gear { opacity: 0.20; }
    }

    /* Toasts: Slide-in + Sound-ready */
    .toast-stack {
      position: fixed;
      right: 1rem;
      top: 1rem;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.75rem;
      border-radius: 0.5rem;
      z-index: 1003;
    }
    .toast {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.75rem;
      border-radius: 0.5rem;
      min-width: 240px;
      background: white;
      border: 1px solid #e2e8f0;
      transform: translateX(16px);
      opacity: 0;
      transition: all 200ms ease;
      box-shadow: 0 10px 24px rgba(2,132,199,0.08);
      will-change: opacity, transform;
    }
    .toast.show { transform: translateX(0); opacity: 1; }
    .toast.success { border-color: #bbf7d0; background: #f0fdf4; color: #065f46; }
    .toast.info    { border-color: #bae6fd; background: #eff6ff; color: #075985; }
    .toast.warn    { border-color: #fde68a; background: #fffbea; color: #92400e; }
    .toast.error   { border-color: #fecaca; background: #fef2f2; color: #7f1d1d; }
    @media (prefers-color-scheme: dark) {
      .toast { background: #0f172a; border-color: #1f2937; color: #e5e7eb; box-shadow: 0 10px 24px rgba(14,165,233,.18); }
      .toast.success { border-color: #064e3b; background: #052e2b; color: #bbf7d0; }
      .toast.info    { border-color: #0c4a6e; background: #052335; color: #bae6fd; }
      .toast.warn    { border-color: #78350f; background: #2f1f05; color: #fde68a; }
      .toast.error   { border-color: #7f1d1d; background: #2b0b0b; color: #fecaca; }
    }
    
    /* --- Theme Overrides --- */
    /* Light Theme */
    html.theme-light body {
      background: linear-gradient(to bottom, #f0f9ff 60%, #e0e7ef 100%);
      color: #1e293b;
    }
    html.theme-light .panel {
      background: white;
      border-color: #e2e8f0;
      box-shadow: 0 1px 2px rgba(2, 6, 23, 0.05);
    }
    html.theme-light .tabs {
      background: #f1f5f9;
    }
    html.theme-light .tab-btn {
      color: #64748b;
    }
    html.theme-light .cancel-btn {
      border-color: #e2e8f0;
      color: #64748b;
    }
    html.theme-light input, html.theme-light select {
      background: #f8fafc !important;
      border-color: #cbd5e1 !important;
      color: #0f172a !important;
    }

    /* Dark Theme */
    html.theme-dark body {
      background: linear-gradient(to bottom, #192132 60%, #0b1220 100%);
      color: #e5e7eb;
    }
    html.theme-dark .panel {
      background: #0f172a;
      border-color: #1f2937;
      box-shadow: 0 1px 2px rgba(2, 6, 23, 0.30);
    }
    html.theme-dark .tabs {
      background: #1e293b;
    }
    html.theme-dark .tab-btn {
      color: #94a3b8;
    }
    html.theme-dark .cancel-btn {
      border-color: #374151;
      color: #94a3b8;
    }
    html.theme-dark input, html.theme-dark select {
      background: #1e293b !important;
      border-color: #374151 !important;
      color: #e5e7eb !important;
    }

    /* High Contrast Theme */
    html.theme-high-contrast body {
      background: #000000;
      color: #ffffff;
    }
    html.theme-high-contrast .panel {
      background: #1a1a1a;
      border: 2px solid #ffffff;
      box-shadow: none;
    }
    html.theme-high-contrast .tabs {
      background: #2a2a2a;
      border: 1px solid #ffffff;
    }
    html.theme-high-contrast .tab-btn {
      color: #ffffff;
      border: 1px solid transparent;
    }
    html.theme-high-contrast .tab-btn[aria-selected="true"] {
      background: #ffffff;
      color: #000000;
      border: 2px solid #ffff00;
    }
    html.theme-high-contrast .cancel-btn {
      border: 2px solid #ffffff;
      color: #ffffff;
    }
    html.theme-high-contrast .save-btn {
      background: #ffffff;
      color: #000000;
      border: 2px solid #ffff00;
    }
    html.theme-high-contrast input, html.theme-high-contrast select {
      background: #000000 !important;
      border: 2px solid #ffffff !important;
      color: #ffffff !important;
    }
    html.theme-high-contrast .toggle {
      border: 2px solid #ffffff;
    }
    html.theme-high-contrast .toggle.on {
      background: #ffff00;
      border-color: #ffffff;
    }
    html.theme-high-contrast .toggle-knob {
      background: #ffffff;
    }
    html.theme-high-contrast .toggle.on .toggle-knob {
      background: #000000;
    }

    /* --- New Adaptive Theme Variants (Light/Dark/High-Contrast) --- */
    /* Themes are now defined in adaptive-themes.css - these overrides are for settings page specifics */

    /* --- UI Enhancements: Cards, Chips, Glassy Backgrounds --- */
    .setting-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 16px rgba(56, 189, 248, 0.06);
      transition: all 280ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    .setting-card:hover {
      box-shadow: 0 8px 24px rgba(56, 189, 248, 0.12);
      border-color: rgba(56, 189, 248, 0.3);
    }
    @media (prefers-color-scheme: dark) {
      .setting-card {
        background: rgba(15, 23, 42, 0.85);
        border-color: rgba(31, 41, 55, 0.8);
        box-shadow: 0 4px 16px rgba(14, 165, 233, 0.12);
      }
      .setting-card:hover {
        box-shadow: 0 8px 24px rgba(14, 165, 233, 0.18);
        border-color: rgba(56, 189, 248, 0.3);
      }
    }
    html.theme-light .setting-card {
      background: rgba(255, 255, 255, 0.85);
      border-color: rgba(226, 232, 240, 0.8);
    }
    html.theme-dark .setting-card {
      background: rgba(15, 23, 42, 0.85);
      border-color: rgba(31, 41, 55, 0.8);
    }
    html.theme-high-contrast .setting-card,
    html.theme-high-contrast-light .setting-card {
      background: #ffffff;
      border: 2px solid #000000;
      backdrop-filter: none;
    }
    html.theme-high-contrast-dark .setting-card {
      background: #000000;
      border: 2px solid #ffffff;
      backdrop-filter: none;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.15), rgba(129, 140, 248, 0.15));
      color: #0369a1;
      border: 1px solid rgba(56, 189, 248, 0.2);
    }
    @media (prefers-color-scheme: dark) {
      .chip {
        background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(129, 140, 248, 0.2));
        color: #7dd3fc;
        border-color: rgba(56, 189, 248, 0.3);
      }
    }
    html.theme-light .chip {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.15), rgba(129, 140, 248, 0.15));
      color: #0369a1;
    }
    html.theme-dark .chip {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(129, 140, 248, 0.2));
      color: #7dd3fc;
    }
    html.theme-high-contrast .chip,
    html.theme-high-contrast-light .chip {
      background: #059669;
      color: #ffffff;
      border: 2px solid #000000;
    }
    html.theme-high-contrast-dark .chip {
      background: #10b981;
      color: #000000;
      border: 2px solid #ffffff;
    }

    /* --- Adaptive Theme Selector (Segmented Control) --- */
    .theme-selector-container {
      margin-top: 1rem;
    }
    .theme-selector {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      background: #f1f5f9;
      border-radius: 0.75rem;
      padding: 0.5rem;
    }
    @media (prefers-color-scheme: dark) {
      .theme-selector {
        background: #1e293b;
      }
    }
    html.theme-dark .theme-selector {
      background: #1e293b;
    }
    html.theme-high-contrast-light .theme-selector {
      background: #e5e5e5;
      border: 2px solid #000000;
    }
    html.theme-high-contrast-dark .theme-selector {
      background: #1a1a1a;
      border: 2px solid #ffffff;
    }
    
    .theme-option {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      border: none;
      background: none;
      font-weight: 600;
      color: #64748b;
      transition: all 180ms cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      text-align: center;
      font-size: 0.875rem;
    }
    .theme-option:hover {
      background: rgba(56, 189, 248, 0.1);
      color: #38bdf8;
    }
    /* Light and Dark themes get blue-indigo gradient */
    .theme-option[data-theme="light"].active,
    .theme-option[data-theme="dark"].active {
      background: linear-gradient(90deg, #38bdf8 60%, #818cf8 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(56, 189, 248, 0.15);
    }
    /* High Contrast themes get blue-green gradient */
    .theme-option[data-theme="high-contrast-light"].active,
    .theme-option[data-theme="high-contrast-dark"].active {
      background: linear-gradient(90deg, #38bdf8 60%, #10b981 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(56, 189, 248, 0.15);
    }
    @media (prefers-color-scheme: dark) {
      .theme-option {
        color: #94a3b8;
      }
      .theme-option:hover {
        background: rgba(56, 189, 248, 0.15);
        color: #7dd3fc;
      }
    }
    html.theme-dark .theme-option {
      color: #94a3b8;
    }
    html.theme-dark .theme-option:hover {
      background: rgba(56, 189, 248, 0.15);
      color: #7dd3fc;
    }
    html.theme-high-contrast-light .theme-option {
      color: #000000;
      border: 2px solid transparent;
    }
    html.theme-high-contrast-light .theme-option:hover {
      background: #d4d4d4;
      border-color: #000000;
    }
    html.theme-high-contrast-light .theme-option[data-theme="light"].active,
    html.theme-high-contrast-light .theme-option[data-theme="dark"].active {
      background: #0284c7;
      color: #ffffff;
      border: 3px solid #000000;
      box-shadow: none;
    }
    html.theme-high-contrast-light .theme-option[data-theme="high-contrast-light"].active,
    html.theme-high-contrast-light .theme-option[data-theme="high-contrast-dark"].active {
      background: #16a34a;
      color: #ffffff;
      border: 3px solid #000000;
      box-shadow: none;
    }
    html.theme-high-contrast-dark .theme-option {
      color: #ffffff;
      border: 2px solid transparent;
    }
    html.theme-high-contrast-dark .theme-option:hover {
      background: #2a2a2a;
      border-color: #ffffff;
    }
    html.theme-high-contrast-dark .theme-option[data-theme="light"].active,
    html.theme-high-contrast-dark .theme-option[data-theme="dark"].active {
      background: #0284c7;
      color: #000000;
      border: 3px solid #ffffff;
      box-shadow: none;
    }
    html.theme-high-contrast-dark .theme-option[data-theme="high-contrast-light"].active,
    html.theme-high-contrast-dark .theme-option[data-theme="high-contrast-dark"].active {
      background: #22c55e;
      color: #000000;
      border: 3px solid #ffffff;
      box-shadow: none;
    }

    /* --- Deprecated: Old Adaptive Theme Slider (kept for reference) --- */
    .theme-slider-container {
      margin-top: 1rem;
    }
    .theme-slider-wrapper {
      position: relative;
      padding: 1rem 0;
    }
    .theme-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 12px;
      border-radius: 6px;
      background: linear-gradient(90deg, 
        #fbbf24 0%, 
        #38bdf8 33%, 
        #f97316 66%, 
        #1e293b 100%);
      outline: none;
      cursor: pointer;
      position: relative;
      box-shadow: 0 2px 8px rgba(56, 189, 248, 0.15);
      transition: box-shadow 200ms;
    }
    .theme-slider:hover {
      box-shadow: 0 4px 12px rgba(56, 189, 248, 0.25);
    }
    .theme-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: white;
      border: 3px solid #38bdf8;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    .theme-slider::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(56, 189, 248, 0.4);
    }
    .theme-slider::-moz-range-thumb {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: white;
      border: 3px solid #38bdf8;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    .theme-slider::-moz-range-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(56, 189, 248, 0.4);
    }
    .theme-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      padding: 0 0.5rem;
    }
    .theme-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: #64748b;
      text-align: center;
      flex: 1;
      transition: color 200ms, transform 200ms;
    }
    .theme-label.active {
      color: #38bdf8;
      transform: scale(1.1);
    }
    @media (prefers-color-scheme: dark) {
      .theme-label {
        color: #94a3b8;
      }
      .theme-label.active {
        color: #7dd3fc;
      }
      .theme-slider::-webkit-slider-thumb {
        background: #e5e7eb;
      }
      .theme-slider::-moz-range-thumb {
        background: #e5e7eb;
      }
    }
    html.theme-dark .theme-label {
      color: #94a3b8;
    }
    html.theme-dark .theme-label.active {
      color: #7dd3fc;
    }
    html.theme-high-contrast .theme-slider {
      background: linear-gradient(90deg, #ffff00 0%, #ffffff 33%, #ff00ff 66%, #00ffff 100%);
      border: 2px solid #ffffff;
    }
    html.theme-high-contrast .theme-slider::-webkit-slider-thumb {
      background: #ffffff;
      border: 3px solid #ffff00;
    }
    html.theme-high-contrast .theme-slider::-moz-range-thumb {
      background: #ffffff;
      border: 3px solid #ffff00;
    }
    html.theme-high-contrast .theme-label {
      color: #ffffff;
    }
    html.theme-high-contrast .theme-label.active {
      color: #ffff00;
    }
    html.theme-sunrise .theme-label {
      color: #92400e;
    }
    html.theme-sunrise .theme-label.active {
      color: #f59e0b;
    }
    html.theme-daylight .theme-label {
      color: #1e40af;
    }
    html.theme-daylight .theme-label.active {
      color: #3b82f6;
    }
    html.theme-sunset .theme-label {
      color: #fdba74;
    }
    html.theme-sunset .theme-label.active {
      color: #fb923c;
    }
    html.theme-midnight .theme-label {
      color: #94a3b8;
    }
    html.theme-midnight .theme-label.active {
      color: #cbd5e1;
    }



    /* Setting label improvements */
    .setting-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #1e293b;
    }
    @media (prefers-color-scheme: dark) {
      .setting-label {
        color: #e5e7eb;
      }
    }
    html.theme-light .setting-label {
      color: #1e293b;
    }
    html.theme-dark .setting-label {
      color: #e5e7eb;
    }
    html.theme-high-contrast .setting-label,
    html.theme-high-contrast-light .setting-label {
      color: #000000;
      font-weight: 700;
    }
    html.theme-high-contrast-dark .setting-label {
      color: #ffffff;
      font-weight: 700;
    }

    .setting-description {
      font-size: 0.875rem;
      color: #64748b;
      margin-top: 0.25rem;
    }
    @media (prefers-color-scheme: dark) {
      .setting-description {
        color: #94a3b8;
      }
    }
    html.theme-dark .setting-description {
      color: #94a3b8;
    }
    html.theme-high-contrast .setting-description,
    html.theme-high-contrast-light .setting-description {
      color: #000000;
      font-weight: 600;
    }
    html.theme-high-contrast-dark .setting-description {
      color: #ffffff;
      font-weight: 600;
    }
  </style>
</head>
<body class="min-h-screen p-6">
  <!-- Animated floating gears SVG background -->
  <svg id="gear-bg"></svg>
  <header class="max-w-3xl mx-auto mb-6 px-2 relative z-10">
    <div class="flex items-center gap-3">
      <img src="/assets/logo.png" alt="Trident Robotics Logo" class="h-8 w-8">
      <div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-sky-800 leading-snug dark:text-sky-300">Settings</h1>
        <p class="text-sm text-sky-600 dark:text-sky-400">Manage your Trident Robotics account preferences</p>
      </div>
    </div>
  </header>
  <main class="max-w-3xl mx-auto space-y-6 fadein relative z-10">
    <!-- Tabs Bar -->
    <nav class="tabs mb-2" role="tablist" aria-label="Settings Sections">
      <div class="tab-indicator"></div>
      <button class="tab-btn" id="tabBtn1" aria-controls="tabPanel1" aria-selected="true" role="tab" tabindex="0">Account</button>
      <button class="tab-btn" id="tabBtn2" aria-controls="tabPanel2" aria-selected="false" role="tab" tabindex="-1">Notifications</button>
      <button class="tab-btn" id="tabBtn3" aria-controls="tabPanel3" aria-selected="false" role="tab" tabindex="-1">Appearance</button>
      <button class="tab-btn" id="tabBtn4" aria-controls="tabPanel4" aria-selected="false" role="tab" tabindex="-1">Privacy &amp; Security</button>
    </nav>
    <div style="position:relative; min-height:320px;">
      <!-- Account -->
      <form id="tabPanel1" class="tab-panel active panel p-6 space-y-6" role="tabpanel" aria-labelledby="tabBtn1" autocomplete="off">
        <div class="setting-card">
          <div class="setting-label">
            <span>üìß</span>
            <label for="accountEmail">Email</label>
            <span class="chip">Read-only</span>
          </div>
          <input id="accountEmail" name="email" type="email" readonly class="w-full p-2 rounded border border-slate-300 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-200" placeholder="you@email.com" />
          <p class="setting-description">Your email is managed through Google Sign-In</p>
        </div>
        <div class="setting-card">
          <div class="setting-label">
            <span>üë§</span>
            <label for="accountName">Full Name</label>
          </div>
          <input id="accountName" name="fullname" type="text" class="w-full p-2 rounded border border-slate-300 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-200" placeholder="Your Name" />
          <p class="setting-description">Your display name on the platform</p>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="save-btn btn-primary">Save</button>
          <button type="reset" class="cancel-btn">Cancel</button>
        </div>
      </form>
      <!-- Notifications -->
      <form id="tabPanel2" class="tab-panel panel p-6 space-y-6" role="tabpanel" aria-labelledby="tabBtn2" autocomplete="off">
        <div class="setting-card">
          <div class="setting-label">
            <span>üîî</span>
            <span>Site Notifications</span>
          </div>
          <div class="flex items-center gap-3">
            <div id="toggleReminders" class="toggle on" tabindex="0" role="switch" aria-checked="true">
              <div class="toggle-knob"></div>
            </div>
            <span id="labelReminders" class="text-sm text-slate-700 dark:text-slate-200">On</span>
          </div>
          <p class="setting-description">Receive browser notifications for calendar event reminders</p>
        </div>
        <div class="setting-card">
          <div class="setting-label">
            <span>üîä</span>
            <label for="soundSelect">Sound on Notification</label>
          </div>
          <select id="soundSelect" class="w-full rounded border border-slate-300 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-200">
            <option>Chime</option>
            <option>Ping</option>
            <option>Pop</option>
            <option>Off</option>
          </select>
          <p class="setting-description">Choose the sound that plays with notifications</p>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="save-btn btn-primary">Save</button>
          <button type="reset" class="cancel-btn">Cancel</button>
        </div>
      </form>
      <!-- Appearance -->
      <form id="tabPanel3" class="tab-panel panel p-6 space-y-6" role="tabpanel" aria-labelledby="tabBtn3" autocomplete="off">
        <div class="setting-card">
          <div class="setting-label">
            <span>üé®</span>
            <span>Adaptive Theme</span>
          </div>
          <p class="setting-description" style="margin-bottom: 1rem;">Choose your visual experience with modern theme options</p>
          <div class="theme-selector-container">
            <div class="theme-selector">
              <button type="button" class="theme-option" data-theme="light">
                ‚òÄÔ∏è Light
              </button>
              <button type="button" class="theme-option" data-theme="dark">
                üåô Dark
              </button>
              <button type="button" class="theme-option" data-theme="high-contrast-light">
                üîÜ High Contrast Light
              </button>
              <button type="button" class="theme-option" data-theme="high-contrast-dark">
                üåë High Contrast Dark
              </button>
            </div>
          </div>
        </div>
        <div class="setting-card">
          <div class="setting-label">
            <span>üé¨</span>
            <span>Reduce Motion</span>
          </div>
          <div class="flex items-center gap-3">
            <div id="toggleReduceMotion" class="toggle" tabindex="0" role="switch" aria-checked="false">
              <div class="toggle-knob"></div>
            </div>
            <span id="labelReduceMotion" class="text-sm text-slate-700 dark:text-slate-200">Off</span>
          </div>
          <p class="setting-description">Minimize animations for better accessibility</p>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="save-btn btn-primary">Save</button>
          <button type="reset" class="cancel-btn">Cancel</button>
        </div>
      </form>
      <!-- Privacy & Security -->
      <form id="tabPanel4" class="tab-panel panel p-6 space-y-6" role="tabpanel" aria-labelledby="tabBtn4" autocomplete="off">
        <div class="setting-card">
          <div class="setting-label">
            <span>üîí</span>
            <span>Allow Data Collection</span>
            <span class="chip">Default: On</span>
          </div>
          <div class="flex items-center gap-3">
            <div id="toggleDataCollection" class="toggle on" tabindex="0" role="switch" aria-checked="true">
              <div class="toggle-knob"></div>
            </div>
            <span id="labelDataCollection" class="text-sm text-slate-700 dark:text-slate-200">On</span>
          </div>
          <p class="setting-description">Allow collection of usage data to improve your experience. Disabling this will clear all stored user information including Google login.</p>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="save-btn btn-primary">Save</button>
          <button type="reset" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </main>
  <div id="toastStack" class="toast-stack" aria-live="polite" aria-atomic="true"></div>
  <script>
    // --- Floating Gears Background Animation ---
    // Generates multiple SVG gears with random movement/rotation
    const gearColors = [
      "#38bdf8", "#818cf8", "#64748b", "#facc15", "#0ea5e9"
    ];
    const darkGearColors = [
      "#818cf8", "#38bdf8", "#64748b", "#facc15", "#0ea5e9"
    ];
    const bg = document.getElementById('gear-bg');
    function createGear(cx, cy, r, teeth, fill, id) {
      // Generate gear path
      let path = "";
      for (let i = 0; i < teeth; i++) {
        const a = ((2 * Math.PI) / teeth) * i;
        const outer = r * 1.14, inner = r * 0.86;
        const x1 = cx + outer * Math.cos(a), y1 = cy + outer * Math.sin(a);
        const x2 = cx + r * Math.cos(a + Math.PI / teeth), y2 = cy + r * Math.sin(a + Math.PI / teeth);
        path += `${i === 0 ? "M" : "L"}${x1},${y1}L${x2},${y2}`;
      }
      path += "Z";
      return `<g id="gear-${id}"><circle cx="${cx}" cy="${cy}" r="${r*0.65}" fill="${fill}" /><path d="${path}" fill="${fill}" /></g>`;
    }
    function randomBetween(a, b) {
      return a + Math.random() * (b - a);
    }
    function renderGears() {
      let w = window.innerWidth, h = window.innerHeight;
      let gears = [];
      // Choose a color set based on theme
      const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const colors = isDark ? darkGearColors : gearColors;
      for (let i = 0; i < 7; i++) {
        let cx = randomBetween(0, w), cy = randomBetween(0, h);
        let r = randomBetween(38, 80);
        let t = Math.floor(randomBetween(8, 16));
        let color = colors[i % colors.length];
        gears.push(createGear(cx, cy, r, t, color, i));
      }
      bg.innerHTML = gears.join('');
      // Animate
      Array.from(bg.children).forEach((gear, idx) => {
        gear.classList.add("gear");
        animateGear(gear, idx);
      });
    }
    function animateGear(gear, idx) {
      const w = window.innerWidth, h = window.innerHeight;
      let angle = randomBetween(0, 360);
      let speed = randomBetween(12, 30) * (Math.random() < 0.5 ? 1 : -1); // deg/sec
      let x = randomBetween(0, w), y = randomBetween(0, h);
      let size = randomBetween(0.8, 1.2);
      function step(ts) {
        angle += speed * 0.016; // ~60fps
        x += Math.sin((angle+idx*60)/60) * 0.1;
        y += Math.cos((angle+idx*80)/80) * 0.09;
        if (x < -120) x = w+120; if (x > w+120) x = -120;
        if (y < -120) y = h+120; if (y > h+120) y = -120;
        gear.setAttribute('transform', `translate(${x},${y}) scale(${size}) rotate(${angle})`);
        gear.style.opacity = (0.12 + Math.abs(Math.sin(angle/80))*0.18).toFixed(2);
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }
    window.addEventListener('resize', renderGears);
    renderGears();

    // --- Sound Engine from ui-lab.html ---
    const Sound = (() => {
      const state = {
        ctx: null,
        master: null,
        enabled: true,
        prefersReduced: window.matchMedia('(prefers-reduced-motion: reduce)').matches
      };
      function ensureCtx() {
        if (!state.ctx) {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const master = ctx.createGain();
          master.gain.value = 0.6;
          master.connect(ctx.destination);
          state.ctx = ctx;
          state.master = master;
          // Resume on first user gesture if needed
          const resume = () => { if (ctx.state === 'suspended') ctx.resume(); document.removeEventListener('pointerdown', resume, true); };
          document.addEventListener('pointerdown', resume, true);
        }
      }
      function setEnabled(on) {
        state.enabled = on;
        if (state.master) state.master.gain.value = on ? 0.6 : 0.0;
      }
      function tone({ freq=440, type='sine', duration=0.12, attack=0.005, decay=0.08, gain=0.3, detune=0 }) {
        if (!state.enabled) return;
        ensureCtx();
        const t0 = state.ctx.currentTime;
        const osc = state.ctx.createOscillator();
        const g = state.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, t0);
        if (detune) osc.detune.setValueAtTime(detune, t0);
        g.gain.setValueAtTime(0, t0);
        g.gain.linearRampToValueAtTime(gain, t0 + attack);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + attack + decay);
        osc.connect(g).connect(state.master);
        osc.start(t0);
        osc.stop(t0 + Math.max(duration, attack + decay));
      }
      function click() { tone({ freq: 240, type: 'triangle', duration: 0.08, attack: 0.002, decay: 0.06, gain: 0.22 }); }
      function success() { tone({ freq: 660, type: 'sine', attack: 0.004, decay: 0.10, gain: 0.25 }); setTimeout(() => tone({ freq: 880, type: 'sine', attack: 0.004, decay: 0.12, gain: 0.23 }), 90);}
      function warn() { tone({ freq: 320, type: 'square', attack: 0.003, decay: 0.15, gain: 0.2 }); }
      function error() { tone({ freq: 220, type: 'square', attack: 0.002, decay: 0.2, gain: 0.25 }); setTimeout(() => tone({ freq: 180, type: 'square', attack: 0.002, decay: 0.22, gain: 0.22 }), 90);}
      function info() { tone({ freq: 520, type: 'triangle', attack: 0.004, decay: 0.12, gain: 0.22 }); }
      function tab() { tone({ freq: 700, type: 'triangle', attack: 0.004, decay: 0.11, gain: 0.19 }); }
      function toggle() { tone({ freq: 380, type: 'square', attack: 0.002, decay: 0.10, gain: 0.18 }); }
      return { setEnabled, click, success, warn, error, info, tab, toggle };
    })();

    // Tabs (animated with indicator, motion-safe)
    const tabBtns = [document.getElementById('tabBtn1'), document.getElementById('tabBtn2'), document.getElementById('tabBtn3'), document.getElementById('tabBtn4')];
    const tabPanels = [document.getElementById('tabPanel1'), document.getElementById('tabPanel2'), document.getElementById('tabPanel3'), document.getElementById('tabPanel4')];
    const tabIndicator = document.querySelector('.tab-indicator');
    
    // Function to update the indicator position
    function updateTabIndicator(index) {
      const activeBtn = tabBtns[index];
      if (activeBtn && tabIndicator) {
        const containerRect = activeBtn.parentElement.getBoundingClientRect();
        const btnRect = activeBtn.getBoundingClientRect();
        const left = btnRect.left - containerRect.left;
        const width = btnRect.width;
        
        tabIndicator.style.transform = `translateX(${left}px)`;
        tabIndicator.style.width = `${width}px`;
      }
    }
    
    // Restore active tab from localStorage on page load
    const savedTab = localStorage.getItem('settings-active-tab');
    let initialTab = 0;
    if (savedTab) {
      const tabIndex = parseInt(savedTab, 10);
      if (tabIndex >= 0 && tabIndex < tabBtns.length) {
        initialTab = tabIndex;
      }
    }
    
    // Initialize with saved tab
    if (initialTab > 0) {
      tabBtns.forEach((b, i) => {
        b.setAttribute('aria-selected', i === initialTab);
        b.tabIndex = i === initialTab ? 0 : -1;
      });
      tabPanels.forEach((panel, i) => {
        panel.classList.toggle('active', i === initialTab);
      });
    }
    
    // Initialize indicator on correct tab
    updateTabIndicator(initialTab);
    
    // Update indicator on window resize
    window.addEventListener('resize', () => {
      const activeIdx = tabBtns.findIndex(btn => btn.getAttribute('aria-selected') === 'true');
      if (activeIdx !== -1) updateTabIndicator(activeIdx);
    });
    
    tabBtns.forEach((btn, idx) => {
      btn.addEventListener('click', () => {
        tabBtns.forEach((b,i) => {
          b.setAttribute('aria-selected', i === idx);
          b.tabIndex = i === idx ? 0 : -1;
        });
        tabPanels.forEach((panel,i) => {
          panel.classList.toggle('active', i === idx);
        });
        updateTabIndicator(idx);
        Sound.tab();
        
        // Save current tab to localStorage
        localStorage.setItem('settings-active-tab', idx.toString());
      });
      btn.addEventListener('keydown', function(e) {
        if (e.key === "ArrowLeft" || e.key === "ArrowRight") {
          let dir = e.key === "ArrowLeft" ? -1 : 1;
          let next = (idx + dir + tabBtns.length) % tabBtns.length;
          // Update ARIA attributes
          tabBtns.forEach((b,i) => {
            b.setAttribute('aria-selected', i === next);
            b.tabIndex = i === next ? 0 : -1;
          });
          tabPanels.forEach((panel,i) => {
            panel.classList.toggle('active', i === next);
          });
          updateTabIndicator(next);
          Sound.tab();
          tabBtns[next].focus();
          
          // Save current tab to localStorage
          localStorage.setItem('settings-active-tab', next.toString());
        }
      });
    });

    // Toggle switches are now managed by settings.js
    // Only need to setup the sound for original functionality preservation
    function setupToggleSound(id) {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('click', () => Sound.toggle(), { passive: true });
      }
    }
    setupToggleSound('toggleReminders');
    setupToggleSound('toggleReduceMotion');
    setupToggleSound('toggleDataCollection');

    // --- Adaptive Theme Selector Logic ---
    const themeOptions = document.querySelectorAll('.theme-option');
    
    // Valid adaptive theme values
    const validAdaptiveThemes = ['light', 'dark', 'high-contrast-light', 'high-contrast-dark'];
    
    // Track current selected theme
    let selectedTheme = null;
    
    // Initialize theme selector from current theme
    function initThemeSelector() {
      // Read from localStorage directly using the correct key
      const savedAdaptive = localStorage.getItem('site-adaptive-theme') || 'light';
      
      // Use saved theme if valid, otherwise default to 'light'
      const currentTheme = validAdaptiveThemes.includes(savedAdaptive) ? savedAdaptive : 'light';
      
      // Set selected theme
      selectedTheme = currentTheme;
      
      // Update UI to reflect current theme (don't re-apply as it's already applied)
      updateThemeUI(currentTheme, false);
    }
    
    // Update theme UI and optionally apply theme
    function updateThemeUI(themeName, applyTheme = false) {
      // Update active state on buttons
      themeOptions.forEach(option => {
        const isActive = option.dataset.theme === themeName;
        option.classList.toggle('active', isActive);
      });
      
      // Update selected theme
      selectedTheme = themeName;
      
      // Apply theme if requested
      if (applyTheme) {
        // Apply theme class immediately
        const html = document.documentElement;
        html.classList.remove('theme-light', 'theme-dark', 'theme-high-contrast-light', 'theme-high-contrast-dark');
        html.classList.add('theme-' + themeName);
        
        // Save to localStorage
        localStorage.setItem('site-adaptive-theme', themeName);
        
        // Play sound
        if (window.Sound) {
          Sound.toggle();
        }
      }
    }
    
    // Handle theme option clicks
    themeOptions.forEach(option => {
      option.addEventListener('click', function() {
        const themeName = this.dataset.theme;
        updateThemeUI(themeName, true);
      });
    });
    
    // Get currently selected theme
    function getSelectedTheme() {
      return selectedTheme;
    }
    
    // Expose to settings.js
    window.getSelectedTheme = getSelectedTheme;
    
    // Initialize on load
    initThemeSelector();

  </script>
  <script src="/assets/js/toast.js" defer></script>
  <script>
    // Pre-populate email before settings.js runs
    // This ensures email is available in localStorage["signedInEmail"] for settings.js
    (function() {
      try {
        let email = null;
        
        // 1. Try to get email from window.signedInEmail (if set by auth flow)
        if (window.signedInEmail) {
          email = window.signedInEmail;
        }
        
        // 2. If not found, try to decode from Google credential JWT
        if (!email) {
          // Try both "google.credential" and "g_idp.credential" keys
          const credentialKeys = ["google.credential", "g_idp.credential"];
          
          for (const key of credentialKeys) {
            const googleCred = localStorage.getItem(key);
            if (googleCred && typeof jwt_decode === 'function') {
              try {
                // Handle both raw JWT string and JSON with credential property
                let token = googleCred;
                try {
                  const parsed = JSON.parse(googleCred);
                  if (parsed.credential) {
                    token = parsed.credential;
                  }
                } catch (e) {
                  // Not JSON, assume it's a raw JWT string
                }
                
                const decoded = jwt_decode(token);
                if (decoded.email) {
                  email = decoded.email;
                  break; // Found a valid email, stop searching
                }
              } catch (e) {
                // Invalid JWT or decoding error - try next key
                console.debug(`Could not decode ${key}:`, e.message);
              }
            }
          }
        }
        
        // 3. If email found, persist it to localStorage and set window.signedInEmail
        if (email) {
          localStorage.setItem("signedInEmail", email);
          window.signedInEmail = email;
          
          // 4. Pre-populate the email input field if it exists
          const emailInput = document.getElementById("accountEmail");
          if (emailInput) {
            emailInput.value = email;
          }
        }
      } catch (error) {
        // Fail silently - don't break the page
        console.debug("Error in email pre-population script:", error);
      }
    })();
  </script>
  <script src="/assets/js/theme.js"></script>
  <script src="/assets/js/settings.js"></script>
</body>
</html>
